<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
  <HEAD>
    <TITLE>File Formats</TITLE>
    <META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
    <style type="text/css"> <!-- BODY { font-family:"Arial" }
  TD { font-size:16 }
      .style1
      {
        width: 304px;
      }
      .style5
      {
        width: 445px;
      }
      .style6
      {
        width: 304px;
        font-weight: bold;
      }
      .style7
      {
        width: 114px;
        text-align: center;
      }
      .style8
      {
        width: 85px;
      }
      .style9
      {
        width: 343px;
      }
      .style10
      {
        width: 117px;
      }
      .style11
      {
        width: 343px;
        font-weight: bold;
      }
      .style12
      {
        font-size: larger;
        font-weight: bold;
      }
      .style13
      {
        width: 304px;
        height: 24px;
      }
      .style14
      {
        width: 445px;
        height: 24px;
      }
  --></style>
  </HEAD>
  <BODY BGCOLOR="#ffffff" TEXT="#000000">
    <basefont size="2">
      <P><A NAME="about_formats"></A><span class="style12">File
          Formats and Other Documentation</span></P>
      <P>
        <a href="#metadata">Image Metadata Files</a><br>
        <a href="#navigator">Navigator Files</a><br>
        <a href="#importing">Importing Externally Defined Navigator
          Items</a><br>
        <a href="#calfile">Settings and Calibration File Entries</a><br>
        <a href="#otherNotes">Other Notes</a><br>
      </p>
    <P><a name="metadata"></a><b>Image Metadata Files</b></P>
      <P>SerialEM stores metadata about images in text files in the IMOD &quot;autodoc&quot; format.&nbsp;
        This format consists of keyword-value pairs organized into blocks called
        sections.&nbsp; These sections can be of different types with different kinds of
        data in them, although SerialEM&#39;s files use essentially only one kind of
        section.&nbsp; A section begins with a bracketed key-value pair:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [sectionType = name]<br />
        where the section &quot;name&quot; or value will typically be unique but is not required
        to be so by the IMOD autodoc reader.&nbsp; Lines below a section header of the
        form<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; key = value<br />
        provide data associated with that section.&nbsp; In addition, key-value pairs
        can occur at the beginning of the file, before any section header, and these are
        referred to as global values.</P>
    <P>Although all values are stored as text strings in the autodoc file, software
      that expects information of a particular kind will often convert these strings
      to or from one or more floating point or integer values.&nbsp; The autodoc
      module in the IMOD library libcfshr contains functions for storing or retrieving
      one, two, three, or many floating point or integer values in specified sections
      of the file.&nbsp; The autodoc format was chosen for SerialEM because of the
      ready availability of this library, the convenience of using such functions, and
      compatibility with the autodoc-reading capability in IMOD.&nbsp; IMOD also has a 
      simple Python module, autodoc.py, with a function to take a set of autodoc lines 
      and produce a top-level dictionary of the different types of sections, keyed by 
      &#39;sectionType&#39;, with each entry containing an array of dictionaries, one for each 
      section.&nbsp; Other functions will return a list of integer or floating point 
      values from the value in a key-value pair.</P>
    <P>There are two kinds of image-associated autodoc files produced by SerialEM: </P>
    <P>1) The &quot;.mdoc&quot; file provides data about an MRC file and has the same name as
      the image file, with the additional extension &quot;.mdoc&quot;.&nbsp; In these files, the
      section type is &quot;ZValue&quot; and the name for each section is the Z value of the
      image in the file, numbered from 0.</P>
    <P>2) The &quot;.idoc&quot; file provides information that allows a series of single-image
      TIFF files to be treated interchangeably with MRC files.&nbsp; The section type
      here is &quot;Image&quot; and the name for each section is the name of the TIFF file.</P>
    <P>Global data replicate some of the information that is in an MRC file header.&nbsp;
      In addition, the titles for an MRC file are stored in section headers of the
      type &quot;T&quot;.</P>
    <P>It is important to realize that no steps in IMOD tilt series processing rely on 
      information directly from an .mdoc file or require the presence of one.&nbsp; An 
      .mdoc file is used for dose weighting, but only if the user specifies that as 
      the source of dose information.&nbsp; It can be used with Alignframes to create 
      a tilt series from frame files.&nbsp; Extracttilts and Extractpieces will fall 
      back to looking for an .mdoc file if tilt angle or piece list values, 
      respectively, are not in the image file header.</P>
    <P>&nbsp;The IMOD library used by SerialEM uses the same internal autodoc
      structure to access the metadata in HDF files.&nbsp; It is thus simple to
      extract all of these metadata information into a text file in the autodoc
      format, with a command like:</P>
    <P>&nbsp;&nbsp;&nbsp; extracttilts -attr filename.hdf&nbsp; filename.hdf.mdoc&nbsp;</P>
      <TABLE cols="2" BORDER style="Z-INDEX: 0">
        <TBODY>
          <TR VALIGN="top">
            <TD class="style6" colspan="2">Global Data</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DataMode</TD>
            <TD class="style5">MRC file mode</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">ImageSize</TD>
            <TD class="style5">X and Y size of images</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">Montage</TD>
            <TD class="style5">1 if the file is a montage</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">ImageSeries</TD>
            <TD class="style5">1 for an .idoc file describing a series of single-image files</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">ImageFile</TD>
            <TD class="style5">In a .mdoc file, contains the name of the image file</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">PixelSpacing</TD>
            <TD class="style5">Pixel spacing in Angstroms that would be in MRC header (or in
              1/Angstroms for diffraction images)</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style6" colspan="2">Section Data</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">TiltAngle</TD>
            <TD class="style5">Tilt angle in degrees</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">PieceCoordinates</TD>
            <TD class="style5">Pixel coordinates in X and Y and section Z value for montage
              piece</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">StagePosition</TD>
            <TD class="style5">X and Y stage position in microns</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">NominalStageXY</TD>
            <TD class="style5">Stage position that a piece would be take at without image 
              shift for a hybrid montage using image shift in blocks</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">StageZ</TD>
            <TD class="style5">Z stage position in microns</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">Magnification</TD>
            <TD class="style5">&quot;Film&quot; magnification value</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">CameraLength</TD>
            <TD class="style5">Camera length in mm for image in diffraction mode</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">MagIndex</TD>
            <TD class="style5">Magnification index</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">Intensity</TD>
            <TD class="style5">Raw intensity value between 0 and 1</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">SuperMontCoords</TD>
            <TD class="style5">X and Y pixel coordinates of frame in a supermontage</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">PixelSpacing</TD>
            <TD class="style5">Pixel spacing in Angstroms for individual image (or in
              1/Angstroms for diffraction image)</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">RefinedPixelSpacing</TD>
            <TD class="style5">Pixel spacing based on the pixel size entered for the 
              magnification with a &#39;RefinedPixelSize&#39; property</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">ExposureDose</TD>
            <TD class="style5">Dose on specimen during camera exposure time in electrons/sq. A, 
              excluding pre-exposure time</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DoseRate</TD>
            <TD class="style5">Dose rate to the camera, in electrons per physical pixel per second</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">SpotSize</TD>
            <TD class="style5">Microscope spot size</TD>
          </TR>
         <TR VALIGN="top">
            <TD class="style1">ProbeMode</TD>
            <TD class="style5">For Thermo/FEI scopes, 1 for microprobe or 0 for nanoprobe</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">Defocus</TD>
            <TD class="style5">Relative defocus readout from microscope (microns)</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">TargetDefocus</TD>
            <TD class="style5">Current target for autofocus (microns)</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">ImageShift</TD>
            <TD class="style5">X and Y image shift in basic units (close to microns for Thermo/FEI, much larger than microns for JEOL)</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">RotationAngle</TD>
            <TD class="style5">Rotation of image from having the tilt axis along its X axis (CCW +).&nbsp; 
              This corresponds to the definition of the approximate rotation angles reported 
              by Thermo/FEI scripting.&nbsp; It is different from the &#39;Tilt axis angle&#39; in the second title 
              of the file header and .mdoc, which follows the IMOD convention of tilt axis 
              rotation relative to the Y axis of the image. Thus, the latter will be 90 
              degrees less than the RotationAngle in a system with no axis inversions.</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">ExposureTime</TD>
            <TD class="style5">Image exposure time</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">Binning</TD>
            <TD class="style5">Image binning on the camera</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">UsingCDS</TD>
            <TD class="style5">1 if image was taken with CDS mode on</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">CameraIndex</TD>
            <TD class="style5">Index of the CameraProperties section for the camera used</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DividedBy2</TD>
            <TD class="style5">1 if image was divided by 2</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">RotationAndFlip</TD>
            <TD class="style5">RotationAndFlip property of K2 or K3 camera</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">LowDoseConSet</TD>
            <TD class="style5">Control set index plus 1 if image taken in Low Dose, or negative
                of index if not in Low Dose (index 0-6 for View, Focus, Trial, Record, Preview,
                Search, Mont-map; 7 for tracking, 8 for montage)</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">MinMaxMean</TD>
            <TD class="style5">Minimum, maximum, and mean value for this image</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">PriorRecordDose</TD>
            <TD class="style5">For an image in a tilt series taken in Low Dose mode, the
              cumulative dose in the Record area prior to this image, including Record and
              Preview images and View images taken in tasks</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">XedgeDxy</TD>
            <TD class="style5">Edge displacement in X and Y for montage piece to the right of
              this piece</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">YedgeDxy</TD>
            <TD class="style5">Edge displacement in X and Y for piece above this piece</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">XedgeDxyVS</TD>
            <TD class="style5">Edge displacement for piece to right, computed with very sloppy
              option</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">YedgeDxyVS</TD>
            <TD class="style5">Edge displacement for piece above, computed with very sloppy
              option</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">XedgeMaxSD</TD>
            <TD class="style5">95th percentile value of local SD in area correlated to find 
              shift of piece to the right.</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">YedgeMaxSD</TD>
            <TD class="style5">95th percentile value of local SD in area correlated to find 
              shift of piece above.</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">XedgeMaxSDVS</TD>
            <TD class="style5">95th percentile value of local SD in area correlated with very 
              sloppy parameters to find shift of piece to the right.</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">YedgeMaxSDVS</TD>
            <TD class="style5">&95th percentile value of local SD in area correlated with very 
              sloppy parameters to find shift of piece above.</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">StageOffsets</TD>
            <TD class="style5">When aligning montage pieces with image shift, this is the
              effective stage position (actual position plus the stage equivalent to the image
              shift adjustment) minus the nominal stage position of the piece.</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">AlignedPieceCoords</TD>
            <TD class="style5">Piece coordinates adjusted by the solved shifts for each piece
              when pieces are aligned in overview with &#39;Very sloppy&#39; option off.</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">AlignedPieceCoordsVS</TD>
            <TD class="style5">Piece coordinates adjusted by the solved shifts for each piece
              when pieces are aligned in overview with &#39;Very sloppy&#39; option on.</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">SubFramePath</TD>
            <TD class="style5">Directory or file in which subframes of exposure were stored</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">NumSubFrames</TD>
            <TD class="style5">Number of subframes stored</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">FrameDosesAndNumbers</TD>
            <TD class="style5">Dose per frame in electrons per square Angstrom followed by
              number of frames at that dose; variable-sized frame sums will have multiple
              pairs of such values</TD>
          </TR>
           <TR VALIGN="top">
            <TD class="style1">DateTime</TD>
            <TD class="style5">Time and date of image acquisition; the format of the date is 
              dd-Mon-yy regardless of locale.&nbsp; The year was changed to yyyy in SerialEM
              4.1, 7/15/22.
            </TD>
          </TR>
           <TR VALIGN="top">
            <TD class="style1">TimeStamp</TD>
            <TD class="style5">Time of image acquisition in integer seconds since Jan. 1, 
              2020.</TD>
          </TR>
           <TR VALIGN="top">
            <TD class="style1">NavigatorLabel</TD>
            <TD class="style5">Label of Navigator item, added if Acquire at Items is being run
              and a tilt series is not</TD>
          </TR>
           <TR VALIGN="top">
            <TD class="style13">FilterSlitAndLoss</TD>
            <TD class="style14">Energy filter slit width and energy loss if slit is in, 0 0
              otherwise</TD>
          </TR>
           <TR VALIGN="top">
            <TD class="style1">ChannelName</TD>
            <TD class="style5">Detector name for a STEM image</TD>
          </TR>
           <TR VALIGN="top">
            <TD class="style1">MultishotHoleAndPosition</TD>
            <TD class="style5">Hole identifier and position within hole when
                taking multiple record images; peripheral positions are numbered from 1 and the
                center is numbered 0.&nbsp; For a regular pattern, hole identifiers are a
              pair of numbers relative to the center of the pattern; for a custom pattern,
               they are simply numbers starting at 1.</TD>
          </TR>
           <TR VALIGN="top">
            <TD class="style1">CameraPixelSize</TD>
            <TD class="style5">For diffraction image, the size of the image pixel on the
              camera in microns, namely the physical chip pixel size times the binning.</TD>
          </TR>
           <TR VALIGN="top">
            <TD class="style1">Voltage</TD>
            <TD class="style5">High voltage in kV for diffraction image.</TD>
          </TR>
           <TR VALIGN="top">
            <TD class="style1">FlashCounter</TD>
            <TD class="style5">Cumulative counter of number of FEG flashes done by SerialEM.</TD>
          </TR>
           <TR VALIGN="top">
            <TD class="style1">FEGCurrent</TD>
            <TD class="style5">The FEG beam current in nanoamps, which is read from the scope every 5 minutes.</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style6" colspan="2">Direct Electron Specific Section Data</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DE12-ServerSoftwareVersion</TD>
            <TD class="style5">Server software version</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DE12-PreexposureTime(s)</TD>
            <TD class="style5">Pre-exposure time</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DE12-TotalNumberOfFrames</TD>
            <TD class="style5">Total number of frames in acquisition</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DE12-FramesPerSecond</TD>
            <TD class="style5">Frame rate in frames per second</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DE12-CameraPosition</TD>
            <TD class="style5">Whether camera was retracted or inserted</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DE12-ProtectionCoverMode</TD>
            <TD class="style5">Whether protection cover is kept open or open and closed for
              this shot</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DE12-ProtectionCoverOpenDelay(ms)</TD>
            <TD class="style5">Delay after opening prtection cover</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DE12-TemperatureDetector(C)</TD>
            <TD class="style5">Detector temperature</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DE12-FaradayPlatePeakReading(pA/cm2)</TD>
            <TD class="style5">Current reading from Faraday plate during exposure</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DE12-SensorModuleSerialNumber</TD>
            <TD class="style5">Serial number of sensor</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DE12-SensorReadoutDelay(ms)</TD>
            <TD class="style5">Delay before starting to read out sensor during exposure</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DE12-IgnoredFramesInSummedImage</TD>
            <TD class="style5">Number of frames ignored in a summed image</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style6" colspan="2">Additional Data in MontSection</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">FullMontSize</TD>
            <TD class="style5">Full size of montage in X and Y if all pieces
            are present</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">BufISXY</TD>
            <TD class="style5">Image shift associated with overview buffer</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">ProbeMode</TD>
            <TD class="style5">1 for microporbe, 0 for nanoprobe</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">MoveStage</TD>
            <TD class="style5">1 if for a stage montage</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">ConSetUsed</TD>
            <TD class="style5">Control set used for the montage (0 = View, 3 =
            Record, 5 = Search, 6 = MontMap</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">MontBacklash</TD>
            <TD class="style5">The nominal backlash for this montage, or 0 0
            if using an anchor at the center</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">ValidBacklash</TD>
            <TD class="style5">The nominal backlash for this montage, or 0 0
            if using an anchor at the center or doing a zigzag pattern</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">DriftSettling</TD>
            <TD class="style5">Drift settling in control set used</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">CameraModes</TD>
            <TD class="style5">Shutter mode and read mode</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">FocusOffset</TD>
            <TD class="style5">Focus offset for low dose View or Search,
            assigned to map item DefocusOffset if a map is made</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">NetViewShifts</TD>
            <TD class="style5">Image shift offsets for low dose View or Search</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">ViewBeamShifts</TD>
            <TD class="style5">Beam shift offsets for low dose View or Search</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">ViewBeamTilts</TD>
            <TD class="style5">Incremental beam tilts for low dose View or Search</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">ViewDefocus</TD>
            <TD class="style5">Focus offset for low dose View or Search,
            assigned to image buffer when reading in</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">Alpha</TD>
            <TD class="style5">Alpha value on JEOL</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">FilterState</TD>
            <TD class="style5">0/1 if slit is out/in, and slit width</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">AdjustedOverlaps</TD>
            <TD class="style5">Overlap between pieces when using multiple Record routine and 
              overlap is increased by tilt-foreshortening</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">XEdgeExpectedShifts</TD>
            <TD class="style5">Expected shift in X and Y in overlap zones between pieces in X 
              direction when using multiple Record routine</TD>
          </TR>
          <TR VALIGN="top">
            <TD class="style1">YEdgeExpectedShifts</TD>
            <TD class="style5">Expected shift in X and Y in overlap zones between pieces in Y 
              direction when using multiple Record routine</TD>
          </TR>
    </TBODY></TABLE>
    <p>
        &nbsp;</p>
    <p>
      If an &quot;.idoc&quot; file is being constructed for a set of TIFF files, the essential
      elements are the &quot;DataMode&quot;, &quot;ImageSize&quot;, and &quot;ImageSeries&quot; entries, as well as
      a section header for each image.&nbsp; The global &quot;PixelSpacing&quot; may be helpful
      in some contexts.&nbsp; For a montage, the &quot;Montage&quot; entry must be present with
      the value 1, and there must be a &quot;PieceCoordinates&quot; entry in each section.&nbsp;
      The X and Y values must fall on a regularly spaced grid, so that the coordinates
      can be analyzed to deduce the spacing and overlap between pieces unambiguously.&nbsp;
      Not all pieces in a rectangle need to be present, and there need not be pieces
      at 0.&nbsp; Pixel coordinates are in a right-handed system despite the
      ubiquitous inversion of images in Y.</p>
    <p>
      If the alignment between montage pieces is known, this information can be placed
      in both the XedgeDxy/YedgeDxy and the XedgeDxyVS/YedgeDxyVS entries, so that the
      alignment can be used by SerialEM regardless of whether the Very Sloppy option
      is checked.&nbsp; The entries are the amount that an &quot;upper&quot; piece, i.e., one to
      the right (for X) or above (for Y), is displaced from being aligned in the
      overlap zone.&nbsp; This is the negative of the amount that the upper piece
      needs to be shifted to align the two pieces in the overlap zone.&nbsp; The program uses
      the IMOD library routine findPieceShifts to solve for the best shifts to be
      applied to each piece to bring all of them into best alignment.&nbsp; There is a
      fixed (but easily raised) limit to the size of montage for which this solution will be found, based
      on the nominal number of pieces in X and Y rather than the actual number.
    </p>
    <p>
      <a name="navigator"></a><b>Navigator Files</b></p>
    <p>
      In SerialEM 3.6, the Navigator output was switched from one tab-delimited line
      per item to an autodoc format, with an option to output as XML instead.&nbsp;
      XML or autodoc files can be read back in, as well as the tab-delimited files
      from earlier versions.&nbsp; There are two lines of global data,<br />
&nbsp; AdocVersion = x.xx<br />
&nbsp; LastSavedAs = x\y.nav<br />
      where the second is the full absolute path and name of the file as it was last
      saved.&nbsp; Then every item is in a section of type 'Item' and with its label string as the
      value.&nbsp; The following table lists all of the keys that can occur in a
      section, the kind of value that is expected, and whether it is required, or if
      it is not required, what default value is set.</p>

    <P>
<TABLE cols="5" BORDER style="Z-INDEX: 0">
  <TBODY>
    <TR VALIGN="top">
      <TD><b>Key</b></TD>
      <TD class="style10"><b>Type of value</b></TD>
      <TD class="style7"><b>Default value, or Required</b></TD>
      <TD class="style8"><b>CMapDrawItem member(s)</b></TD>
      <TD class="style11">Description</TD>
    </TR>
    <TR VALIGN="top">
      <TD>Color</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">Req</TD>
      <TD class="style8">mColor</TD>
      <TD class="style9">Color index (0-5)</TD>
    </TR>
    <TR VALIGN="top">
      <TD>StageXYZ</TD>
      <TD class="style10">Three Floats</TD>
      <TD class="style7">Req&nbsp; (unless external)</TD>
      <TD class="style8">mStageX/Y/Z</TD>
      <TD class="style9">Stage position adjusted for current mag</TD>
    </TR>
    <TR VALIGN="top">
      <TD>NumPts</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">Req</TD>
      <TD class="style8">mNumPoints</TD>
      <TD class="style9">Number of points</TD>
    </TR>
    <TR VALIGN="top">
      <TD>Corner</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mCorner</TD>
      <TD class="style9">Flag for corner point</TD>
    </TR>
    <TR VALIGN="top">
      <TD>Draw</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">1</TD>
      <TD class="style8">mDraw</TD>
      <TD class="style9">Flag to draw</TD>
    </TR>
    <TR VALIGN="top">
      <TD>RegPt</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mRegPoint</TD>
      <TD class="style9">Registration point number</TD>
    </TR>
    <TR VALIGN="top">
      <TD>Regis</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">Req</TD>
      <TD class="style8">mRegistration</TD>
      <TD class="style9">Registration at which item exists</TD>
    </TR>
    <TR VALIGN="top">
      <TD>Type</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">Req</TD>
      <TD class="style8">mType</TD>
      <TD class="style9">Type: 0-2 for point, polygon, map</TD>
    </TR>
    <TR VALIGN="top">
      <TD>Note</TD>
      <TD class="style10">String</TD>
      <TD class="style7">blank</TD>
      <TD class="style8">mNote</TD>
      <TD class="style9">Note string</TD>
    </TR>
    <TR VALIGN="top">
      <TD>GroupID</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mGroupID</TD>
      <TD class="style9">ID of group thatitem belongs to</TD>
    </TR>
    <TR VALIGN="top">
      <TD>PolyID</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mPolygonID</TD>
      <TD class="style9">ID of polygon used to define supermontage</TD>
    </TR>
   <TR VALIGN="top">
      <TD>FitToPolygonID</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mFitToPolygonID</TD>
      <TD class="style9">ID of polygon that this montage map was fit to</TD>
    </TR>
    <TR VALIGN="top">
      <TD>Imported</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mImported</TD>
      <TD class="style9">Indicator of an imported map or point drawn on one</TD>
    </TR>
    <TR VALIGN="top">
      <TD>RegisteredToID</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mRegisteredToID</TD>
      <TD class="style9">For an imported map, ID of map that it was registered to for
        transforming</TD>
    </TR>
    <TR VALIGN="top">
      <TD>SuperMontXY</TD>
      <TD class="style10">Two Integers</TD>
      <TD class="style7">-1,-1</TD>
      <TD class="style8">SuperMontX/Y</TD>
      <TD class="style9">Camera coordinate of a montage in supermontage</TD>
    </TR>
    <TR VALIGN="top">
      <TD>OrigReg</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">Regis</TD>
      <TD class="style8">mOriginalReg</TD>
      <TD class="style9">Original registration (default is Registration)</TD>
    </TR>
    <TR VALIGN="top">
      <TD>DrawnID</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mDrawnOnMapID</TD>
      <TD class="style9">ID of map point/polygon was drawn on</TD>
    </TR>
    <TR VALIGN="top">
      <TD>Flags</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mFlags</TD>
      <TD class="style9">Bit flags: bit 1 on if item was drawn on an FFT</TD>
    </TR>
    <TR VALIGN="top">
      <TD>BklshXY</TD>
      <TD class="style10">Two Floats</TD>
      <TD class="style7">0,0</TD>
      <TD class="style8">mBacklashX/Y</TD>
      <TD class="style9">Backlash when a montage was taken or associated with item</TD>
    </TR>
    <TR VALIGN="top">
      <TD>SamePosId</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mAtSamePosID</TD>
      <TD class="style9">Items with this matching were taken at same raw stage position</TD>
    </TR>
    <TR VALIGN="top">
      <TD>RawStageXY</TD>
      <TD class="style10">Two Floats</TD>
      <TD class="style7">-10000,-10000</TD>
      <TD class="style8">mRawStageX/Y</TD>
      <TD class="style9">Raw stage position before adjustments</TD>
    </TR>
    <TR VALIGN="top">
      <TD>Acquire</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mAcquire</TD>
      <TD class="style9">Flag for acquiring</TD>
    </TR>
    <TR VALIGN="top">
      <TD>PieceOn</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">-1</TD>
      <TD class="style8">mPieceDrawnOn</TD>
      <TD class="style9">Index of montage piece item was drawn on (piece_#_in_X *
        #_of_pieces_in_Y + piece_#_in_Y), or index of nearest piece if item is on a
        missing piece, in which case XYinPc will not be written to file.</TD>
    </TR>
    <TR VALIGN="top">
      <TD>XYinPc</TD>
      <TD class="style10">Two Floats</TD>
      <TD class="style7">-1,-1</TD>
      <TD class="style8">mX/YinPiece</TD>
      <TD class="style9">X,Y coordinates in the montage piece, in right-handed pixels of
        stored montage</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapFile</TD>
      <TD class="style10">String</TD>
      <TD class="style7">Req if Map</TD>
      <TD class="style8">mMapFile</TD>
      <TD class="style9">Full or relative path of map file (see
        <a href="menu_navigator.htm#hid_load_nav_file">Read &amp; Open</a>)</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapID</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">Req if Map</TD>
      <TD class="style8">mMapID</TD>
      <TD class="style9">Unique ID (all items get one, not just maps)</TD>
    </TR>
    <TR VALIGN="top">
      <TD>FocusAxisPos</TD>
      <TD class="style10">Float</TD>
      <TD class="style7">-1.e8</TD>
      <TD class="style8">mFocusAxisPos</TD>
      <TD class="style9">Stored position of Focus area on inter-area axis</TD>
    </TR>
    <TR VALIGN="top">
      <TD>LDAxisAngle</TD>
      <TD class="style10">Two Integers</TD>
      <TD class="style7">0,0</TD>
      <TD class="style8">mRotateFocusAxis, mFocusAxisAngle</TD>
      <TD class="style9">First value: 1 to rotate inter-area axis from tilt axis, 0 not
          to; second value: angle of rotation</TD>
    </TR>
    <TR VALIGN="top">
      <TD>FocusOffsets</TD>
      <TD class="style10">Two Integers</TD>
      <TD class="style7">0,0</TD>
      <TD class="style8">mFocusX/Yoffset</TD>
      <TD class="style9">Offset of focus subarea in X and Y in unbinned pixels (Y
          inverted)</TD>
    </TR>
    <TR VALIGN="top">
      <TD>HoleArray</TD>
      <TD class="style10">Two Integers</TD>
      <TD class="style7">0,0</TD>
      <TD class="style8">mNumX/Yholes</TD>
      <TD class="style9"># of positions in X and Y for multiple Record</TD>
    </TR>
    <TR VALIGN="top">
      <TD>SkipHoles</TD>
      <TD class="style10">List of integers</TD>
      <TD class="style7">none</TD>
      <TD class="style8">mSkipHolePos</TD>
      <TD class="style9">Pairs of X,Y indexes for positions to skip from&nbsp; that
        array specified in HoleArray.&nbsp; Positions are numbered from 0 at lower-left
        in stage coordinates&nbsp; </TD>
    </TR>
    <TR VALIGN="top">
      <TD>HoleISXspacing</TD>
      <TD class="style10">Three Floats</TD>
      <TD class="style7">0,0,0</TD>
      <TD class="style8">mXHoleISSpacing</TD>
      <TD class="style9">X component of vectors from hole finding converted to image 
        shift for use with multiple Records</TD>
    </TR>
    <TR VALIGN="top">
      <TD>HoleISYspacing</TD>
      <TD class="style10">Three Floats</TD>
      <TD class="style7">0,0,0</TD>
      <TD class="style8">mYHoleISSpacing</TD>
      <TD class="style9">Y component of hole vectors converted to image shift</TD>
    </TR>
    <TR VALIGN="top">
      <TD>TSstartEndAngles</TD>
      <TD class="style10">Two Floats</TD>
      <TD class="style7">-1.e8,-1.e8</TD>
      <TD class="style8">mTSstartAngle, mTSendAngle</TD>
      <TD class="style9">Starting and ending angles of range for&nbsp; tilt series item</TD>
    </TR>
    <TR VALIGN="top">
      <TD>TSbidirAngle</TD>
      <TD class="style10">Float</TD>
      <TD class="style7">-1.e8</TD>
      <TD class="style8">mTSbidirAngle</TD>
      <TD class="style9">Bidirectional starting angle for tilt series item</TD>
    </TR>
    <TR VALIGN="top">
      <TD>TargetDefocus</TD>
      <TD class="style10">Float</TD>
      <TD class="style7">-1.e8</TD>
      <TD class="style8">mTargetDefocus</TD>
      <TD class="style9">Target defocus for Acquire or tilt series item</TD>
    </TR>
    <TR VALIGN="top">
      <TD>FileToOpen</TD>
      <TD class="style10">String</TD>
      <TD class="style7">none</TD>
      <TD class="style8">mFileToOpen</TD>
      <TD class="style9">Name of file to open for Acquire or tilt series item</TD>
    </TR>
    <TR VALIGN="top">
      <TD>TSParamIndex</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">-1</TD>
      <TD class="style8">mTSParamIndex</TD>
      <TD class="style9">Index of into parameter array for tilt series</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MontParamIndex</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">-1</TD>
      <TD class="style8">mMontParamIndex</TD>
      <TD class="style9">Index into array of parameters for montages to open</TD>
    </TR>
    <TR VALIGN="top">
      <TD>FilePropIndex</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">-1</TD>
      <TD class="style8">mFilePropIndex</TD>
      <TD class="style9">Index into array of file options for file to open</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapMontage</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">Req if Map</TD>
      <TD class="style8">mMapMontage</TD>
      <TD class="style9">Flag that map is a montage</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapSection</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">Req if Map</TD>
      <TD class="style8">mMapSection</TD>
      <TD class="style9">Section number in file</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapBinning</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">Req if Map</TD>
      <TD class="style8">mMapBinning</TD>
      <TD class="style9">Binning at which map was taken, or of initial overview map image
        for montage</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapMagInd</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">Req if Map</TD>
      <TD class="style8">mMapMagInd</TD>
      <TD class="style9">Magnification index of map, or of non-map image a point or
        polygon was drawn on </TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapCamera</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">Req if Map</TD>
      <TD class="style8">mMapCamera</TD>
      <TD class="style9">Camera index</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapScaleMat</TD>
      <TD class="style10">Four Floats</TD>
      <TD class="style7">Req if Map</TD>
      <TD class="style8">mMapScaleMat</TD>
      <TD class="style9">Stage to pixel scale matrix for drawing, based on pixels of
        initial map image.&nbsp; For montage, needs to be adjusted by ratio of currently
        loaded map width/height to initial map width/height</TD>
    </TR>
    <TR VALIGN="top">
      <TD>GridMapXform</TD>
      <TD class="style10">Six Floats</TD>
      <TD class="style7">none</TD>
      <TD class="style8">mGridMapXform</TD>
      <TD class="style9">Transformation matrix and shift found by the last run of the routine 
        to realign a reloaded grid that transformed items</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapWidthHeight</TD>
      <TD class="style10">Two Integers</TD>
      <TD class="style7">Req if Map</TD>
      <TD class="style8">mMapWidth/Height</TD>
      <TD class="style9">Size of initial map image at which scale matrix was defined</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapMinMaxScale</TD>
      <TD class="style10">Two Floats</TD>
      <TD class="style7">0,0</TD>
      <TD class="style8">mMapMin/MaxScale</TD>
      <TD class="style9">Min and max scale values of image when map was defined</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapFramesXY</TD>
      <TD class="style10">Two Integers</TD>
      <TD class="style7">0,0</TD>
      <TD class="style8">mMapFramesX/Y</TD>
      <TD class="style9">Number of montage frames when acquired</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MontBinning</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mMontBinning</TD>
      <TD class="style9">Actual binning of montage used to make the map</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapExposure</TD>
      <TD class="style10">Float</TD>
      <TD class="style7">0.</TD>
      <TD class="style8">mMapExposure</TD>
      <TD class="style9">Exposure time for original map images</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapSettling</TD>
      <TD class="style10">Float</TD>
      <TD class="style7">0.</TD>
      <TD class="style8">mMapSettling</TD>
      <TD class="style9">Drift settling</TD>
    </TR>
    <TR VALIGN="top">
      <TD>ShutterMode</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">-1</TD>
      <TD class="style8">mShutterMode</TD>
      <TD class="style9">Shutter mode</TD>
    </TR>
    <TR VALIGN="top">
      <TD>K2ReadMode</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mK2ReadMode</TD>
      <TD class="style9">Read mode for K2/K3 camera</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapSpotSize</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mMapSpotSize</TD>
      <TD class="style9">Spot size at which map was taken</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapIntensity</TD>
      <TD class="style10">Double</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mMapIntensity</TD>
      <TD class="style9">Intensity at which map was taken</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapSlitIn</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mMapSlitIn</TD>
      <TD class="style9">Filter slit state when map was taken</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapSlitWidth</TD>
      <TD class="style10">Float</TD>
      <TD class="style7">-1.</TD>
      <TD class="style8">mMapSlitWidth</TD>
      <TD class="style9">Filter slit width when map was taken</TD>
    </TR>
    <TR VALIGN="top">
      <TD>RotOnLoad</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mRotOnLoad</TD>
      <TD class="style9">Flag to rotate when load</TD>
    </TR>
    <TR VALIGN="top">
      <TD>RealignedID</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mRealignedID</TD>
      <TD class="style9">ID of lower mag map with nearby realign error</TD>
    </TR>
    <TR VALIGN="top">
      <TD>RealignErrXY</TD>
      <TD class="style10">Two Floats</TD>
      <TD class="style7">0,0</TD>
      <TD class="style8">mRealignErrX/Y </TD>
      <TD class="style9">Final stage error of that realign operation</TD>
    </TR>
    <TR VALIGN="top">
      <TD>LocalErrXY</TD>
      <TD class="style10">Two Floats</TD>
      <TD class="style7">0,0</TD>
      <TD class="style8">mLocalRealiErrX/Y</TD>
      <TD class="style9">Error in second round of realign operation</TD>
    </TR>
    <TR VALIGN="top">
      <TD>RealignReg</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mRealignReg</TD>
      <TD class="style9">Original registration of that realign</TD>
    </TR>
    <TR VALIGN="top">
      <TD>ImageType</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mImageType</TD>
      <TD class="style9">Map file type 0-3 for MRC, IMOD, TIFF, IDOC</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MontUseStage</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">-1</TD>
      <TD class="style8">mMontUseStage</TD>
      <TD class="style9">1 if montage was taken with stage, 0 if not, -1 if unknown</TD>
    </TR>
    <TR VALIGN="top">
      <TD>DefocusOffset</TD>
      <TD class="style10">Float</TD>
      <TD class="style7">0.</TD>
      <TD class="style8">mDefocusOffset</TD>
      <TD class="style9">Defocus offset for map based on View images</TD>
    </TR>
    <TR VALIGN="top">
      <TD>K2ReadMode</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">0</TD>
      <TD class="style8">mK2ReadMode</TD>
      <TD class="style9">Read mode for K2/K3 camera</TD>
    </TR>
    <TR VALIGN="top">
      <TD>NetViewShiftXY</TD>
      <TD class="style10">Two Floats</TD>
      <TD class="style7">0,0</TD>
      <TD class="style8">mNetViewShiftX/Y</TD>
      <TD class="style9">Net IS offset for a View image map</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapAlpha</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">-999</TD>
      <TD class="style8">mMapAlpha</TD>
      <TD class="style9">JEOL alpha value</TD>
    </TR>
    <TR VALIGN="top">
      <TD>ViewBeamShiftXY</TD>
      <TD class="style10">Two Floats</TD>
      <TD class="style7">0,0</TD>
      <TD class="style8">mViewBeamShiftX/Y</TD>
      <TD class="style9">Incremental beam shift to apply for a View map</TD>
    </TR>
    <TR VALIGN="top">
      <TD>ViewBeamTiltXY</TD>
      <TD class="style10">Two Floats</TD>
      <TD class="style7">0,0</TD>
      <TD class="style8">mViewBeamTiltX/Y</TD>
      <TD class="style9">Incremental beam tilt to apply for a View map</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapProbeMode</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">-1</TD>
      <TD class="style8">mMapProbeMode</TD>
      <TD class="style9">Probe mode (0 for nano, 1 for micro)</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapLDConSet</TD>
      <TD class="style10">Integer</TD>
      <TD class="style7">-1</TD>
      <TD class="style8">mMapLowDoseConSet</TD>
      <TD class="style9">Set # (0-4) used for map taken in low dose</TD>
    </TR>
    <TR VALIGN="top">
      <TD>MapTiltAngle</TD>
      <TD class="style10">Float</TD>
      <TD class="style7">-10000.</TD>
      <TD class="style8">mMapTiltAngle</TD>
      <TD class="style9">Tilt angle at which map was taken</TD>
    </TR>
    <TR VALIGN="top">
      <TD>PtsX</TD>
      <TD class="style10">NumPts Floats</TD>
      <TD class="style7">Req</TD>
      <TD class="style8">mPtX</TD>
      <TD class="style9">X stage cordinates of points</TD>
    </TR>
    <TR VALIGN="top">
      <TD>PtsY</TD>
      <TD class="style10">NumPts Floats</TD>
      <TD class="style7">Req</TD>
      <TD class="style8">mPtY</TD>
      <TD class="style9">Y stage cordinates of points</TD>
    </TR>
    <TR VALIGN="top">
      <TD>UserValueN</TD>
      <TD class="style10">String</TD>
      <TD class="style7">none</TD>
      <TD class="style8">mUserValueMap</TD>
      <TD class="style9">Arbitrary value set by script; N is # (currently1-8)</TD>
    </TR>
       <TR VALIGN="top">
      <TD colspan = "5"><B>TSParam</B>   - a section containing tilt series parameters.&nbsp; See
        TiltSeriesParam.h in the source code for a description of each item.</TD>
    </TR>
       <TR VALIGN="top">
      <TD colspan = "5"><B>MontParam</B>   - a section containg montage parameters.&nbsp; See
        MontageParam.h in the source code for a description of each item.</TD>
    </TR>
       <TR VALIGN="top">
      <TD colspan = "5"><B>FileOptions</B>   - a section containing properties for opening a file.&nbsp; See
        FileOptions.h in the source code in case this has descriptions.</TD>
    </TR>
       <TR VALIGN="top">
      <TD colspan = "5"><strong>StateParam</strong> - a section containing an imaging state, which has a 
        State entry matching the StateParameters line in settings,
        <br />
        and may have a LowDose entry matching LowDoseParameters in settings; see <a href="#calfile">Settings and Calibration File Entries</a>.</TD>
    </TR>
</TBODY></TABLE>
    </P>
    <P><a name="importing"></a><b>Importing Externally Defined Navigator Items</b></P>
    <P>It is possible to add items to a Navigator file whose positions are specified
      by image coordinates in a map and have SerialEM do the conversion to stage
      coordinates.&nbsp; Instead of the StageXYZ entry, the item can have one of these
      entries:</P>
    <ul>
      <li>CoordsInMap - Pixel coordinate in the map image, which can be either a
        single-frame image or a montage with pieces at their regularly spaced, nominal
        piece coordinates.&nbsp; If entire rows or columns were skipped on the bottom or 
        left side of a montage, coordinates starting at (0,0) in an analyzed image must 
        be offset by the nominal piece coordinates of the first column and row included 
        in the montage.&nbsp; The same offset should be applied for the following two 
        entries.</li>
      <li>CoordsInAliMont - Pixel coordinates in a montage map where the pieces are
        aligned without the Very Sloppy option, i.e., placed at the coordinates
        specified by AlignedPieceCoords in the .mdoc file. </li>
      <li>CoordsInAliMontVS - Pixel coordinates in a montage map where the pieces are
        aligned with the Very Sloppy option, i.e., placed at the coordinates specified
        by AlignedPieceCoordsVS.</li>
      <li>CoordsInPiece - Pixels coordinates within one piece of a montage, which must
        be specified with a PieceOn entry.&nbsp; Pieces are numbered from 0 by their
        positions in a complete array; i.e., piece index = piece_#_in_X *
        #_of_pieces_in_Y + piece_#_in_Y, all numbered from 0.&nbsp; The number of pieces 
        in Y must be the value when the montage was first defined, including all skipped 
        rows.&nbsp; This value is available in the Navigator MapFramesXY entry and in 
        the FullMontSize entry in any MontSection of the montage metadata.&nbsp; 
        Similarly, the piece number must be the value it would have if skipped rows or 
        columns were included.</li>
    </ul>
    <P>The following points apply to externally defined items:</P>
    <ul>
      <li>Only one of the four entries or StageXYZ may be entered for an item.</li>
      <li>Each entry takes 3 numbers, the third being a stage Z coordinate, which will
        be used without modification.</li>
      <li>Items must have a DrawnID entry specifying a map that appears before the
        external item in the Navigator file, or is already in the Navigator table
        merging in a file containing only externally defined items.</li>
      <li>Pixel coordinates are right handed, with 0,0 at the lower left of the map.</li>
      <li>Montage overview images are always displayed with the size in X rounded up to
        a multiple of 4.</li>
      <li>With CoordsInAliMont or CoordsInAliMontVS, the map file must have an mdoc file
        with AlignedPieceCoords or AlignedPieceCoordsVS entries, respectively.</li>
      <li>Either points or polygons may be entered externally.</li>
      <li>Coordinates of the points, given by PtsX and PtsY, must also be pixel
        coordinates and will be converted in the same way as the main item stage
        position is.</li>
      <li>Point coordinates in PtsX and PtsY are optional for a point item having a
        NumPts entry of 0; if missing, they will be made identical to the main stage
        coordinates.</li>
      <li>In addition to the entries mentioned already, every item must have a Color,
        Regis, and Type entry.</li>
      <li>If an externally defined item does not have a MapID, a unique ID will be
        assigned.&nbsp; If you do assign IDs, it is important to make sure that they
        will not duplicate those of map items.&nbsp; The easiest way to do this is to
        assign IDs under 100000, since the program now generates IDs of &gt;= 100000.</li>
      <li>Group IDs will not be assigned if they are missing.</li>
    </ul>
    <p>
      Detailed error reporting is available for items that have been read in
      successfully from the Navigator file.&nbsp; A summary of the types of errors
      when processing the items is given in the log, and if Debug Output is set to
      &#39;n&#39;, then the type of error will be reported for each item, identified by its
      label.&nbsp; However, there is no detail when the item is initially rejected
      either because it lacked a required entry or because there was an error (such as
      too few values on a line) reading data from the autodoc.</p>
    <p>
      <a name="calfile"></a><b>Settings and Calibration File Entries</b></p>
    <p>
      This section is for lengthy entries to the
      settings or calibration file that sometimes need to
      be interpreted.&nbsp; Entries will be added upon need or request.&nbsp; All
      alpha values are numbered from 0, not 1.</p>
    <p>
      <strong><em>Settings file entries:</em></strong></p>
    <p>
        <em>LowDoseParameters</em>:
      <br /> There are three sets of parameters, for TEM, EFTEM, and STEM.
      <br />
&nbsp;&nbsp; low dose set number 0 to 4 for V F T R S, or negative of state number
      (numbered from 1)<br />
&nbsp;&nbsp; mag index or negative of camera length index<br />
&nbsp;&nbsp; spot size<br />
&nbsp;&nbsp; intensity<br />
&nbsp;&nbsp; axis offset in microns<br />
&nbsp;&nbsp; 0-2 for regular/EFTEM/STEM or 0 for state<br />
&nbsp;&nbsp; filter slit in<br />
&nbsp;&nbsp; filter slit width<br />
&nbsp;&nbsp; energy loss<br />
&nbsp;&nbsp; zero loss flag<br />
&nbsp;&nbsp; beam X offset<br />
&nbsp;&nbsp; beam Y offset<br />
&nbsp;&nbsp; alpha on JEOL, -999 otherwise<br />
&nbsp;&nbsp; diffraction focus<br />
&nbsp;&nbsp; beam tilt X<br />
&nbsp;&nbsp; beam tilt Y<br />
&nbsp;&nbsp; probe mode<br />
&nbsp;&nbsp; dark field mode flag<br />
&nbsp;&nbsp; dark field tilt X</p>
&nbsp;&nbsp; dark field tilt Y</p>
      <p>
          <em>StateParameters</em>:<br />
&nbsp;&nbsp; 0 for non-low dose, -area # - 1 for low dose, 1 for old LD Record<br />
&nbsp;&nbsp; camera index<br />
&nbsp;&nbsp; mag index<br />
&nbsp;&nbsp; spot size<br />
&nbsp;&nbsp; intensity<br />
&nbsp;&nbsp; filter slit in<br />
&nbsp;&nbsp; filter energy loss<br />
&nbsp;&nbsp; filter slit width<br />
&nbsp;&nbsp; zero loss flag<br />
&nbsp;&nbsp; binning<br />
&nbsp;&nbsp; frame size in X<br />
&nbsp;&nbsp; frame size in Y<br />
&nbsp;&nbsp; exposure time<br />
&nbsp;&nbsp; drift settling<br />
&nbsp;&nbsp; shuttering<br />
&nbsp;&nbsp; read mode<br />
&nbsp;&nbsp; probe mode<br />
&nbsp;&nbsp; dose fractionation<br />
&nbsp;&nbsp; save frames<br />
&nbsp;&nbsp; processing/normalization<br />
&nbsp;&nbsp; align frames<br />
&nbsp;&nbsp; 1 to use framealign, 2 to align in IMOD<br />
&nbsp;&nbsp; frame alignment parameter set index<br />
&nbsp;&nbsp; View read mode<br />
&nbsp;&nbsp; Focus read mode<br />
&nbsp;&nbsp; Trial read mode<br />
&nbsp;&nbsp; Preview read mode<br />
&nbsp;&nbsp; focus axis position<br />
&nbsp;&nbsp; alpha on JEOL, -999 otherwise<br />
&nbsp;&nbsp; defocus target<br />
&nbsp;&nbsp; low dose focus offset<br />
&nbsp;&nbsp; low dose shift offset X<br />
&nbsp;&nbsp; low dose shift offset Y<br />
&nbsp;&nbsp; flag that it is Mont-map<br />

      </p>
    <p>
          <em>AutocenterParams:</em></p>
    <p>
          &nbsp;&nbsp;
          camera<br>
      &nbsp;
      mag index<br>
      &nbsp;
      spot size<br>&nbsp; intensity<br>
          &nbsp;
          binning<br>&nbsp; exposure<br>
      &nbsp; 1 to
      use centroid<br>
          &nbsp;
          probe mode<br>
      &nbsp; 1 to
      shift beam for centering<br>
      &nbsp;
      beam shift in microns<br>
          &nbsp;
          added X beam shift<br>
      &nbsp;
      added Y beam shift<p>
          <em>MultishotParams:</em><p>
&nbsp;&nbsp; Beam diameter for display<br />
&nbsp;&nbsp; Distance to off-center shots in main ring<br />
&nbsp;&nbsp; Number of shots in main ring<br />
&nbsp;&nbsp; Do center shot: -1 before, 0 none, 1 after<br />
&nbsp;&nbsp; Early return: 1 for last only, 2 for all, 3 for full sum on first<br />
&nbsp;&nbsp; Number of frames in early return<br />
&nbsp;&nbsp; Whether to save Record shot<br />
&nbsp;&nbsp; Additional delay after image shift<br />
&nbsp;&nbsp; Whether to use illuminated area for drawing diameter<br />
&nbsp;&nbsp; Whether to adjust beam tilt if possible<br />
&nbsp;&nbsp; 1 to do pattern in hole, 2 to do multi-hole, 3 to do both<br />
&nbsp;&nbsp; Use the list of custom holes<br />
&nbsp;&nbsp; Factor by which to increase regular IS delay between holes<br />
&nbsp;&nbsp; X component of image shift vector in 'X' direction<br />
&nbsp;&nbsp; Y component of image shift vector in 'X' direction<br />
&nbsp;&nbsp; X component of image shift vector in 'Y' direction<br />
&nbsp;&nbsp; Y component of image shift vector in 'Y' direction<br />
&nbsp;&nbsp; Number of holes in 'X' direction<br />
&nbsp;&nbsp; Number of holes in 'Y' direction<br />
&nbsp;&nbsp; Mag at which regular pattern hole positions are measured<br />
&nbsp;&nbsp; Mag at which custom holes are defined<br />
&nbsp;&nbsp; Take cross pattern when it is 3x3<br />
&nbsp;&nbsp; Do a second ring of shots<br />
&nbsp;&nbsp; Number of shots in second ring<br />
&nbsp;&nbsp; Distance to off-center shots in second ring<br />
&nbsp;&nbsp; Tilt angle at which regular pattern was defined<br />
&nbsp;&nbsp; Tilt angle at which custom holes were defined<br />
&nbsp;&nbsp; Angle found in hole finder associated with regular array<br />
          &nbsp;<p>
          <em><strong>Calibration file entries:</strong></em><p>
        <em>StandardLMFocus</em>: This entry contains the recorded standard focus in LM or
         the eucentric focus is nonLM.<br />
&nbsp;&nbsp; Magnification index<br />
&nbsp;&nbsp; Focus value in microprobe, -999 if none<br />
&nbsp;&nbsp; Focus value in nanoprobe, -999 if none<br />
&nbsp;&nbsp; Magnification<br />
      Focus values are either absolute values between 0 and 1, or on JEOL, a large
      value that encodes coarse and fine focus components</p>
    <p>
        <em>FocusCalibration</em>:<br />
&nbsp;&nbsp;
      mag index<br />
&nbsp;&nbsp; camera number<br />
&nbsp;&nbsp; Slope in X<br />
&nbsp;&nbsp; Slope in Y<br />
&nbsp;&nbsp; beam tilt<br />
&nbsp;&nbsp; number of points<br />
&nbsp;&nbsp; direction index<br />
&nbsp;&nbsp; probe mode<br />
&nbsp;&nbsp; alpha<br />
&nbsp;&nbsp; magnification</p>
      <p>
          <em>SpotIntensities:</em>&nbsp; There may be two tables if either nanoprobe or
          microprobe has two calibrations, one below crossover and
          one above crossover.&nbsp; However, a table can have one condition done below
          crossover and the other above.&nbsp; It all gets sorted out into separate tables
          internally.&nbsp; Each row contains:<br />
&nbsp;&nbsp; Spot size<br />
&nbsp;&nbsp; Microprobe intensity ratio, intensity at which acquired, and crossover intensity<br />
&nbsp;&nbsp; Nanoprobe intensity ratio, intensity at which acquired, and crossover intensity</p>
      <p>
          where a ratio of 0 indicates no measurement for that spot size.</p>
    <p>
          <em>BeamShiftCalibration</em>: This calibration is a 2x2 transformation matrix from image shift to
      beam shift at the given magnification:<br />
&nbsp;&nbsp; mag index<br />
&nbsp;&nbsp; X change in beam shift per X change in image shift<br />
&nbsp;&nbsp; X change in beam shift per Y change in image shift<br />
&nbsp;&nbsp; Y change in beam shift per X change in image shift<br />
&nbsp;&nbsp; Y change in beam shift per Y change in image shift<br />
&nbsp;&nbsp; alpha<br />
&nbsp;&nbsp; probe mode<br />
&nbsp;&nbsp; 1 to retain the calibration when a new one is done in the same mag range and
          beam conditions, 0 not to<br />
&nbsp;&nbsp; magnification</p>
    </p>
      <p>
          <em>HighFocusMagCal and HighFocusISCal:</em><br />
&nbsp;&nbsp; spot size<br />
&nbsp;&nbsp; probe mode<br />
&nbsp;&nbsp; defocus<br />
&nbsp;&nbsp; intensity<br />
&nbsp;&nbsp; mag change<br />
&nbsp;&nbsp;&nbsp;rotation<br />
&nbsp;&nbsp; crossover<br />
&nbsp;&nbsp; aperture size<br />
&nbsp;&nbsp; Mag index  (0 for mag cals)</p>

    <p>
          <I>ComaVsISCal:</I><br />
&nbsp;&nbsp; Mag index<br>
&nbsp;&nbsp; spot size<br />
&nbsp;&nbsp; probe mode<br />
&nbsp;&nbsp; alpha<br />
&nbsp;&nbsp; aperture size<br />
&nbsp;&nbsp; intensity<br />
&nbsp;&nbsp; X change in beam tilt needed per X change in image shift<br />
&nbsp;&nbsp; X change in beam tilt needed per Y change in image shift<br />
&nbsp;&nbsp; Y change in beam tilt needed per X change in image shift<br />
&nbsp;&nbsp; Y change in beam tilt needed per Y change in image shift<br />
&nbsp;&nbsp; X change in astigmatism needed per X change in image shift<br />
&nbsp;&nbsp; X change in astigmatism needed per Y change in image shift<br />
&nbsp;&nbsp; Y change in astigmatism needed per X change in image shift<br />
&nbsp;&nbsp; Y change in astigmatism needed per Y change in image shift<br />
    </p>
      <p>
          <em>Stage Calibration and 2x2 transformation matrices </em></p>
      <p>
          The stage calibration consists of 4 matrix terms, and like all such
          2x2 transformation matrices,
          they are expressed as a change in output X value per change in X input value (xpx),
           change in X per change in Y (xpy), change in Y per change in X (ypyx), and change
           in Y per change in Y (ypy).&nbsp; They are written to file in this order.
          &nbsp; In this case the input value is the change in stage position in microns,
          and the output value is the negative of the amount that the image shifts in
          unbinned pixels, or the position of the new centered coordinate in the image
          relative to the original center.&nbsp; This negative value is unfortunate in that
           it inverts the typical stage coordinate system relative to the underlying
          &quot;specimen&quot; coordinate system that has its X along the tilt axis.</p>
      <p>
          The StageCalibration line has<br />
          &nbsp;&nbsp;
          Mag index<br />
          &nbsp;&nbsp;
          Camera number<br />
          &nbsp;&nbsp;
          xpx<br />
          &nbsp;&nbsp;
          xpy<br />
          &nbsp;&nbsp;
          ypx<br />
          &nbsp;&nbsp;
          ypy<br />
          &nbsp;&nbsp;
          Absolute focus at which calibration taken (compound of coarse and fine values for JEOL)<br />
&nbsp;&nbsp; Magnification</p>
      <a name="otherNotes"></a><p><strong>Other Notes</strong></p>
      <p><em>Image Rotation</em></p>
      <p>The 'specimen' coordinate system is a right-handed system with its X axis along
          the positive tilt axis.&nbsp; (Looking toward the origin along the positive tilt
          axis, a positive tilt rotates the stage counterclockwise).&nbsp; Image rotation
          is defined as the amount that the camera image has rotated CCW from the image at
          the specimen plane, i.e., the angle (CCW positive) from the positive X axis of
          the image to the positive tilt axis in the image.</p>
      <p>If there is only one camera and there is no RotationAndPixel line with a
          calibrated absolute rotation, the rotation at one magnification is estimated
          from a fallback value, the sum of that mag's rotation value in the
          MagnificationTable, the GlobalExtraRotation, and the ExtraRotation for that
          camera.&nbsp; If there are relative rotations in the table, the fallback is assigned
          to one mag as the absolute rotation, and this allows a rotation to be derived
          for the others.&nbsp; This is an ambiguous situation because there is no way to know
          just which mag that fallback angle should apply to.&nbsp;</p>
      <p>Once there is a calibrated absolute angle, the MagnificationTable rotation,
          GlobalExtraRotation, and ExtraRotation become irrelevant for all the mags that
          are listed in the RotationAndPixel table and linked by relative rotations to a
          mag with an absolute rotation.&nbsp; The relative rotation for a mag equals the
          rotation angle of that mag minus the rotation of the next lower mag; this
          relationship allows a rotation angle to be propagated outward from the mag with
          the calibrated absolute angle. If any of these mags have an image shift
          calibration, other mags in the same mag range that have an image shift
          calibration can also be assigned a rotation by assuming that image shift is
          invariant at the specimen within that mag range.&nbsp; On a Thermo/FEI scope, the mag
          ranges are LM and nonLM; on a JEOL using image shift deflections there are other
          boundaries across which rotation cannot be transferred; on a JEOL scope using
          PLA, rotation cannot be transferred at all. The MagnificationTable rotations
          retain a fallback role for other mags that have not been assigned a rotation by
          one of these mechanisms; the rotation for such a mag is derived from the nearest
          mag with an assigned rotation by adding the difference between the
          MagnificationTable rotation of the mag in question and that of the nearby mag.</p>
      <p>The situation is even more complicated when there is more than one camera at the
          same level, i.e., more than one non-energy filter camera or more than one energy filter camera, and
          one lacks a calibrated absolute angle.&nbsp; The program will use image shift
          calibrations if possible to get an absolute angle from another camera.&nbsp; All
          of the assignments described here are listed when the program is started with
          DebugOutput set to 'c'.&nbsp; See also ShiftManager::PropagateRotations().&nbsp; </p>
      <p>The image rotation value is intimately related to the stage calibration.&nbsp;
          For a Thermo/FEI scope or JEOL scope without omega filter, an image rotation of 0 produces
           this pattern of image movement</p>
<!--- Pay no attention to the Design display showing the first line off by one.  It's OK in a browser --->
<pre>
  ^  image movement for positive Y stage move
  |
  |
  |
  |
  --------->   image movement for positive X stage move
</pre>
          The image rotation angle is the amount by which the axes of image movement are
       rotated counterclockwise relative to this pattern.&nbsp;
      The image rotation (and the tilt axis angle) should equal&nbsp; atan2(-ypx,
      -xpx) (from the X axis rotation) or atan2(-ypy, -xpy) - 90 ( from the Y axis
      rotation); the program averages these two estimates when it reports the rotation
      angle with a stage calibration.&nbsp;More common angles for Thermo/FEI scopes 
    (except Krios) are near 90 degrees and the pattern of movement is
<pre>
           ^  image movement for positive X stage move
           |
           |
           |
           |
  <---------   image movement for positive Y stage move
</pre>
    <p>
      A typical stage calibration will have values like: -54&nbsp;&nbsp; 261&nbsp;&nbsp; 
      -262&nbsp;&nbsp; -55, which indicates that an X movement produces predominantly 
      a negative Y change in camera coordinate, while a Y movement produces a positive 
      change in X coordinate.&nbsp; This is inverted from the diagram because a 
      positive shift of the image corresponds to a negative change in the 
      (right-handed) camera coordinates 
      of the centered point.&nbsp; Similarly, a Krios or a JEOL F200 has an axis angle 
      near 180 with a pattern
<pre>
  <---------   image movement for positive X stage move
           |
           |
           |
           |
           V  image movement for positive Y stage move
</pre>

    and a typical calibration of 490&nbsp;&nbsp; 44&nbsp;&nbsp; -67&nbsp;&nbsp; 464.</p>
            <p>
    For a JEOL with omega filter with the tilt axis near horizontal (.e.g, 2200FS), the pattern is this:
<pre>
  --------->   image movement for positive X stage move
  |
  |
  |
  |
  V  image movement for positive Y stage move
</pre>
      The X axis is inverted and this requires the property InvertStageXAxis to be
      set.&nbsp; In this case the image rotation is estimated from atan2(ypx, xpx) and
      atan2(-ypy, -xpy) - 90.&nbsp; These estimates are simply reported and never used
      directly by the program; they must be placed into the RotationAndPixel&nbsp;
      lines to have any effect.&nbsp; A typical stage calibration would be -799&nbsp;&nbsp; 
    -109&nbsp;&nbsp; -104&nbsp;&nbsp; 823 (again, because of the inversion between direction of movement 
    and sign of the matrix), and the program would report an angle around 180 from 
    stage calibration once the InvertStageXAxis property is set.</p>
  </BODY>
</HTML>
