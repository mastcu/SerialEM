
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
  <HEAD>
    <TITLE>Setting Up SerialEM</TITLE>
    <META content="text/html; charset=Windows-1252" http-equiv="Content-Type">
    <style type="text/css"> <!-- BODY { font-family:"Arial" }
  TD { font-size:16 }
    .style1
      {
        width: 86%;
        height: 187px;
      }
      .style2
      {
        width: 303px;
      }
      .style3
      {
        width: 896px;
      }
      .style4
      {
        width: 366px;
        font-weight: bold;
      }
      .style5
      {
        width: 167px;
      }
      .style6
      {
        width: 167px;
        font-weight: bold;
      }
      .style7
      {
        width: 242px;
      }
      .style8
      {
        width: 242px;
        font-weight: bold;
      }
      .style9
      {
        text-align: center;
      }
      .style10
      {
        width: 366px;
      }
      .style11
      {
        width: 100%;
      }
      .style12
      {
        height: 22px;
      }
      .style13
      {
        width: 303px;
        height: 24px;
      }
      .style14
      {
        width: 896px;
        height: 24px;
      }
      .auto-style1 {
        width: 303px;
        height: 22px;
      }
      .auto-style2 {
        width: 896px;
        height: 22px;
      }
    --></style>
  </HEAD>
  <BODY bgColor="#ffffff" text="#000000">
    <basefont size="2">
      <P><A name="setting_up_serialem"></A><B><FONT size="3">Setting Up SerialEM</FONT></B></P>
      <P><A href="#setup_install">Program Installation</A>
        <BR>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#packagesContents">The Basic Packages
          and their Contents</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#addedPackages">Additional Packages for GPU
          and Python Support, and for Displaying General and Ctfplotter Graphs</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pluginVersions">Versions of
          the DigitalMicrograph Plugin and Compatibility with Leginon</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#runningInstaller">Running the
          Installer.</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#upgradingNew">Upgrading to a
          New Version.</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#runAsAdmin">Permissions and
          Running as Administrator.</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#gettingIP">Determining IP
          Addresses on a Shared Network</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#environmentVar">Defining an
          Environment Variable.</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#shortcutsArgs">Shortcuts,
          Command Line Arguments, and Administrator mode.</a>
        <br>
        <A href="#setup_minimal">A Minimal Setup Procedure</A>
        <BR>
        <A href="#setup_generic">Starting with a Generic Properties File</A>
        <BR>
        <A href="#FEI_Socket">Connecting with a Thermo/FEI Microscope through Plugin and
        Server</A>
        <BR>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#needNetwork">Yes, You Need a
          Network Connection between the Computers</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pluginServer">Setting Up the
          Plugin and Server</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#movingTo64">Moving an Existing
          Installation from a Thermo/FEI Computer to a 64-bit Computer</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#upgradePlugServer">Upgrading
          to the New Plugin and Server from SerialEM 3.4.</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#run64bitFEI">Running 64-bit SerialEM on a 64-bit Thermo/FEI Computer</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#upgradingK2toK3">Upgrading from a K2 to a K3 camera</a>
        <br>
        <A href="#setup_camera">Initial Camera Setup</A>
        <BR>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cameraOrientation">Camera
          Configuration for Image Orientation</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#generalCamParams">General
          camera related parameters</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#forTietz">For a Tietz
          camera</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#connectDMsocket">To connect to
        DigitalMicrograph through a socket interface</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#K2details">For a K2 camera in
          particular</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#OneViewDetails">To set up a OneView or Rio camera
             to save frames</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DEdetails">For a Direct
          Electron direct detection camera</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#FalconDetails">For a Falcon 2 camera that can save
        intermediate frames, under original scripting interface</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Falcon2NewDetails">For a Falcon 2 camera under the new advanced scripting interface</a>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Falcon3Details">For a Falcon 3 or 4 camera</a>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Ceta2Details">For a Ceta 2 camera (Ceta with speed enhancement option)</a>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#FalconGPU">To use a GPU for aligning Falcon or Ceta 2 frames in SerialEM</a>
      <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#JeolCamera">For accessing
         a JEOL camera or STEM signals</a>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#RemoteTietz">For accessing
         a Tietz camera remotely</a>
        <br>
        <a href="#badSizes">Bad dialog sizes or bad program and font sizes</a>
        <br>
        <A href="#setup_hitachi">Initial Actions and Other Special Features for Hitachi HT7700/HT7800</A>
        <BR>
        <A href="#setup_magtable">Checking the Magnification Table and Calibrating Neutral IS Values</A>
        <BR>
        <A href="#setup_gain_factors">Measuring Relative Gain Factors for Eagle, Tietz CMOS,
        or other Cameras</A>
        <BR>
        <A href="#setup_timing">Tuning Timing of Gatan Camera with Two Shutters</A>
        <BR>
        <A href="#setup_tietz_timing">Measuring Timing of Non-Gatan Camera or Gatan
        Camera with One Shutter</A>
        <BR>
        <A href="#setup_tietz_binning">Setting up Tietz or Eagle Camera Binning Offsets</A>
        <BR>
        <A href="#setup_standard_focus">Assessing Standard Focus for Low Mag Mode</A>
        <BR>
        <A href="#setup_focuscal">Focus Calibration</A>
        <BR>
        <A href="#setup_pixelsize">Calibrating Image Shift and Pixel Size</A> <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#isPreliminaries">Other preliminaries</a><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#isMacro">A script for image
        shift and pixel size calibrations</a><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#isProcedure">The procedure</a><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#isBoundaries">Assessing and setting image shift boundaries</a><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#isAlignImages">Measuring
        further relative rotations and pixel sizes by aligning images</a><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#absRotAngle">Absolute rotation angle</a>
        <BR>
        <A href="#setup_scopecal">Other Microscope Calibrations</A>
        <br />
        <A href="#z_by_g_setup">Extended Autofocus and Non-reciprocity Calibration 
      for Using Eucentricity by Focus</A>
        <BR>
        <A href="#setup_xray">Setting Up X Ray Removal from Dark References</A>
        <BR>
        <A href="#setup_camera_gain">Measuring Camera Gain</A>
        <BR>
        <A href="#setup_stretches">Stage and Imaging Stretch</A>
        <BR>
        <A href="#setup_gifcal">Energy Filter Calibrations</A>
        <BR>
        <A href="#setup_gifprop">Energy Filter Properties</A>
        <BR>
        <A href="#STEM_setup">Setting Up STEM</A>
        <BR>
        <A href="#setup_final">Final Tasks</A>
        <BR>
        <A href="#separate_kv">Setting Up for a Separate Voltage</A><br />
        <a href="#nanoprobe">Setting Up to Use Nanoprobe TEM on Thermo/FEI Scopes </a>&nbsp;<BR>
        <a href="#apertures">Controlling Apertures on Thermo/FEI Scopes </a>&nbsp;<BR>
        <a href="#alpha_beamshift">Alpha and Beam Shift Calibration Issues on JEOL scopes </a>&nbsp;<BR>
        <a href="#using_gpu">Setting Up to Use a GPU for Frame Alignment</a>&nbsp;<BR>
        <a href="#adding_nvidia">Adding an NVIDIA card to a K2/K3 Computer</a>&nbsp;<BR>
        <A href="#using_film_setup">Using Film</A><BR>
        <A href="#package_files">Files in a SerialEM Install Package</A></P>
      <P><A name="setup_install"></A><B>Program Installation</B></P>
    <P><a name="packagesContents"><i><B>The Basic Packages and their Contents</B></i></a>.&nbsp;
      The files needed to run SerialEM consist of executable programs and libraries,
      which are distributed in a package SerialEM_4-x-x.exe, and configuration and
      data files, some of which are obtained from a 'framework' package.&nbsp; The
      program itself should be installed in a folder C:\Program Files\SerialEM; this
      is the location where the package unpacks by default. The configuration and data
      files are also placed in this folder under Windows 2000 and XP, but under
      Windows 7 and Server 2008 they need to be placed in a folder
      C:\ProgramData\SerialEM instead. For the latter systems, if you received a
      custom framework file, it should be set up to unpack in C:\ProgramData, but if
      not, you should change 'Program Files' to 'ProgramData' before unzipping. </P>
    <P>The SerialEM_4-x-x.exe package will create a subfolder SerialEM_4-x-x under
      C:\Program Files\SerialEM.&nbsp; See&nbsp;
        <A href="#package_files">Files in a SerialEM Install Package</A> for a
      description of the package contents.</P>
    <P>There are two distinct kinds of plugins in the package.&nbsp; One is the plugin to
      DigitalMicrograph, which runs when DM loads it from one of its Plugins folders.&nbsp;
      The other is the collection of microscope and camera plugins to SerialEM.&nbsp;
      SerialEM tries to load any file whose name ends in 'Plugin.dll' from the same
      folder as the executable.
      </P>
    <li>The files that come from a framework extract to either C:\Program Files\SerialEM
 (Windows XP) or C:\ProgramData\SerialEM (Windows 7 and later) and include:<br />
       SerialEMproperties.txt - the Properties file, read by SerialEM, edited by hand<BR>
       SerialEMcalibrations.txt - an empty calibrations file, read and written by SerialEM<BR>
       SEMsystemSettings.txt - a default settings file for users that do not have settings yet<BR>
	SerialEM.lnk - a shortcut to start SerialEM with the right settings, once setup is complete<BR>
	UserSettings - a folder that can contain several subfolders, each providing
 a set of default settings for SerialEM for different users/applications<BR>
	UserSettings\Setup - a folder for SerialEM default settings for installation and calibration<BR>
	UserSettings\Setup\Setup SerialEM.lnk - a shortcut to start SerialEM with
 using the default settings for installation and calibration (can be copied
 anywhere)<BR>
	UserSettings\Setup\SerialEMsettings.txt - a settings file for installation and calibration
        <BR>
      <P>If you did not get a 'framework' package already customized for your scope, the
        Properties file in the SerialEM folder is incomplete and
        should be edited to incorporate camera and magnification information, as
        indicated in <A href="#setup_generic">Starting with a Generic Properties File</A>.&nbsp;
        See this section also for instructions on modifications needed under Windows 7/Server
        2008
        and with GMS 2.x.</P>
      <p><a name="addedPackages"><I><B>Additional Packages for Windows XP, GPU
          and Python Support, and for Displaying  General and Ctfplotter Graphs</B></I></a>.&nbsp;
    Depending on your situation, you may need one or more other packages.</P>
      <ul>
        <li>SerialEM will run directly on a scope computer running Windows XP SP3 and may 
          also work under SP1 or SP2, but to do so requires a Visual Studio 2015 
          Redistributables package no newer than the one provided on the SerialEM download 
          site (<em>not</em> 
          the latest available such package).&nbsp; You will need to install SerialEM on a 
          separate computer if it does not work on XP SP1 or SP2, or if the scope is 
          Windows 2000.</li>
        <li>If
      you are running a K2 or K3 camera and SerialEM is either running on a different
      computer or is a 32-bit version on the K2/3 computer, then you need a
      Shrmemframe package specific to your version of GMS.&nbsp; Simply run this
      package on the K2/3 computer and it will place the needed files in
      C:\ProgramData\Gatan\Plugins. </li>
        <li>To do frame alignment with a GPU for any camera,
      you will need a FrameGPU package.&nbsp;  See <a href="#using_gpu">Setting Up to
      Use a GPU for Frame Alignment</a>.</li>
        <li>To use Python with SerialEM, you will need a PythonModules package; this is now installed
          along with SerialEM, but to access commands newer than the current installation package, an 
          up-to-date module can be obtained from a Testing directory on the download site.&nbsp; See
          <a href="about_scripts.htm#pythonInstall">Installation Options</a> in the 
          scripting guide.</li>
        <li>SerialEM can display graphs with the Genhstplt program in IMOD.&nbsp; It can do CTF 
          fitting with the Ctfplotter program, which performs better than the built-in 
          Ctffind module on tilted images, especially when finding astigmatism.&nbsp; The install package
          has a non-graphical build of Ctfplotter, but if you wish to display Ctfplotter graphs, a regular 
          build is needed.&nbsp; A 
          full IMOD installation can be done to provide these Genhstplt and the full build of Ctfplotter, but an easier and 
          more lightweight option is to use a standalone 3dmod package, which simply 
          unpacks in 'C:\Program Files\3dmod' by default, but can be unzipped elsewhere if necessary.&nbsp; 
          To use both of these programs, you need an installation of IMOD 4.12.47 or higher (available from the 
          <a href = "https://bio3d.colorado.edu/imod/download.html">IMOD download page</a>), or a standalone
          3dmod package based on this version or higher, available at
            <a href = "https://bio3d.colorado.edu/ftp/Windows3dmod/">https://bio3d.colorado.edu/ftp/Windows3dmod/</a>.
          For just graphing, you can use an older installation of IMOD, but it will take 
          an extra second to display a graph.<br />
            In order for SerialEM to run these programs, the directory containing the 
          executables must be either on the system path, in one of three standard 
          locations, or provided with
             the 'CtfplotterPath' property.&nbsp; Specifically, if 'CtfplotterPath' is not set, the program
             will check for 'IMOD\bin' and '3dmod' on the system path, and if it finds one 
          of these locations, it assumes that
            is sufficient and will try to run the program with no path specified.&nbsp; If not, 
          it then checks for 'C:\Program Files\3dmod', 'C:\Program Files\IMOD\bin', and 
          'C:\Cygwin\usr\local\IMOD\bin', using the first one that it finds 
            as the path (although it rejects 'C:\Program Files\3dmod' if it does not contain 'genhstplt.exe'). 
          If the programs are in a non-standard location and not on the path, you need to 
          set the property 'CtfplotterPath' with the path to the executables.<br />`
        </li>
      </ul>
    <P><a name="pluginVersions"><i><b>Versions of the DigitalMicrograph Plugin and Compatibility with Leginon</b></i></a>.&nbsp;
      The version number on the SEMCCD plugin does not need to match the GMS version
      exactly; the versions provided in the package are compatible with the full range
      of GMS versions.&nbsp; Specifically, the 32-bit version built with GMS 2.30
      works with GMS 2.31 and 2.32; the 64-bit version built with GMS 2.31 works with
      GMS 2.32 and GMS 3.0 - 3.2</P>
    <P>Leginon uses the SerialEM plugin for communicating with K2/K3 cameras.&nbsp;
      However, it is generally compatible with any plugins
      distributed in SerialEM 3.7 or 3.8, because it does not rely on the newest
      features in these plugins.&nbsp; New versions of the plugin are always backwards
      compatible; i.e., they will work with older versions of connecting software
      (SerialEM or Leginon) that are unaware of new features.&nbsp; SerialEM, however,
      does use all the new features in newer plugins, so it will expect to find the
      plugin version that it is distributed with.&nbsp; Thus, if both SerialEM and
      Leginon are on the system, there should only be one version of the plugin, and
      it should be the version distributed with SerialEM.&nbsp; The SerialEM installer
      will remove any existing plugins from </P>
      <P style="Z-INDEX: 0">
        <a name="runningInstaller"><i><b>Running the Installer.</b></i></a>&nbsp;
        For initial installation or upgrading to a new version, simply click on
        'INSTALL.bat' in the SerialEM_4-x-x subfolder.&nbsp; In Windows 7/10/Server 2008/2012 you
        will need to right click and select 'Run as Administrator'.&nbsp; If you have a
        Gatan camera, make sure that DigitalMicrograph is not running.&nbsp; The
        installer does the following: </P>
    <ol>
      <li>
        <P style="Z-INDEX: 0">
          It will clean up DLL's and help files from previous versions then copy an
          appropriate subset of the files into the upper folder (SerialEM).&nbsp; In
          Windows 2000, the individual Microsoft DLL's will be copied instead of their
          folders.&nbsp;
        </P>
      </li>
      <li>
        <P style="Z-INDEX: 0">
          On a Thermo/FEI scope, you will be asked if you want to install the module for doing
          dynamic focus in STEM.&nbsp; If so, it will copy FocusRamper.exe up and register
          it.</P>
      </li>
      <li>
        <P style="Z-INDEX: 0">
          The installer will try to deduce what kind of microscope it is running on, and
          copy the appropriate plugin file to the upper folder.&nbsp; If there is no
          evidence of what kind of scope is being run, you will be asked if you want to
          install a plugin for a Thermo/FEI scope or a Hitachi scope.&nbsp; If there is no
          apparent microscope installation, but a plugin file is already present in the
          upper folder, then it will copy the new version of that plugin up.</P>
      </li>
      <li>
        <P style="Z-INDEX: 0">
          The Tietz plugin is copied up
          if the SerialEM properties file contains an entry for a Tietz camera or if the
          properties are not found; the DE camera plugin and interface DLL are handled
          similarly; and a plugin for running JEOL cameras
          is copied if it is already present.</P>
      </li>
      <li>
        <P style="Z-INDEX: 0">
          The module for frame alignment in the GPU, FrameGPU.dll, is updated if it is
          present in either the SerialEM directory or C:\ProgramData\Gatan\Plugins</P>
      </li>
      <li>
        <P style="Z-INDEX: 0">
          If you have a Gatan camera, the installer will detect whether you have GMS 1.x
          or a 32-bit or 64-bit version of GMS 2.x or 3.x, and copy just the needed DLL's and
          register-GMSx.bat file.&nbsp; It will tell you which version it found and
          remind you that DigitalMicrograph should not be running. Make sure it detected
          the right version.&nbsp;         </P>
      </li>
      <li>
        <P style="Z-INDEX: 0">
          After you hit a key, it will copy the DM plugin to the Gatan Plugins
          folder&nbsp;(C:\Program Files\Gatan\DigitalMicrograph\Plugins in GMS 1.x, C:\Program
          Files\Gatan\Plugins for GMS 2 32-bit, and C:\ProgramData\Gatan\Plugins for GMS 2-3
          64-bit) and register the DLL's; this should result in 2 or 3 message boxes saying
           that registration succeeded.&nbsp; For 64-bit versions, it will also copy or update
          components needed for alignment of K2/K3 frames through the CPU or GPU.</P>
      </li>
      <li>
        <P style="Z-INDEX: 0">
          At the end, if it thinks you are accessing a Thermo/FEI
          or Hitachi scope remotely, it will tell
          you to copy FEI-SEMserver.exe or
            ShMemSEMserver.exe to the scope computer.&nbsp; The first time that
          you install, you will definitely need to do this.&nbsp; </P>
      </li>
    </ol>
        <P style="Z-INDEX: 0">
          <a name="backup"><i><b>Backing up your SerialEM installation.</b></i></a>&nbsp;
		      To backup your SerialEM installation on Windows 7 and later, copy
		      C:\ProgramData\SerialEM to a safe location, a backup of C:\Program
		      Files\SerialEM is not required if the installation was performed as
		      described here. On Windows XP, copy the files
		      SerialEMcalibrations.txt, SerialEMproperties.txt,
		      SEMflybackTimes.txt (on systems with STEM), SEMsystemSettings.txt,
		      SEMshortTermCal.txt from C:\Program Files\SerialEM, also include all
		      user settings.
          </P>
        <P style="Z-INDEX: 0">
          <a name="upgradingNew"><i><b>Upgrading to a New Version.</b></i></a>&nbsp;
          What the installer will <i>NOT</i> do is update the plugin to DigitalMicrograph
          on a remote computer, or the server on a remote Thermo/FEI microscope, so you may need
          to do this manually.&nbsp; SerialEM will determine
          the versions of these components and inform you if they need to be updated.&nbsp;
          Thus, the most convenient approach is simply to start SerialEM after installing
          a new version and copy whatever file it tells you needs upgrading.&nbsp; When running DM remotely,
          this entails copying the appropriate plugin to the remote computer and renaming
          it as needed, as described below in the section on <i>
          <a href="#connectDMsocket">To connect to
        DigitalMicrograph through a socket interface</a>.&nbsp; </i>When running a Thermo/FEI
          scope remotely, a new version of FEI-SEMserver.exe or FEI-SEMserver-Win2K.exe would be copied to the scope
          computer.</P>
    <P style="Z-INDEX: 0">
          Existing properties, calibrations, and settings files are always compatible when
          upgrading; there is no need to recalibrate the program.</P>
    <P><a name="runAsAdmin"><i><b>Permissions and Running as Administrator.</b></i></a>&nbsp; Make sure that all files in the program folder (C:\Program Files\SerialEM) are
        readable by users.&nbsp; Make sure that users can write to the configuration and
        data file folder, which is the default location for the gain references to be
        placed. In Windows 7/Server 2008, be sure to do this before starting the program.&nbsp;
        Right click on C:\ProgramData\SerialEM, select Properties, then select the
      Security tab if it exists.&nbsp; Select the appropriate user group, press
      'Edit', and turn on 'Full Control'.&nbsp; If there is no Security tab, select the Sharing
        tab, press Advanced Sharing, turn on 'Share this folder', press 'Permissions',
        then 'Add' the appropriate user group (or select 'Everyone') and turn on 'Full
        Control'.</P>
    <P>In Windows 7/Server 2008/Server 2012 with GMS 2.x or 3.x, it may be necessary to run SerialEM as
      Administrator.&nbsp; One reason this can happen is that the COM connection 
      between SerialEM and DigitalMicrograph works only if both are run as 
      non-administrator or both as administrator. If there is an initial error connecting to the SerialEMCCD
      plugin, try right-clicking on the SerialEM shortcut and selecting &quot;Run as
      Administrator&quot;.&nbsp; If this is successful, you can set up any shortcut to run
      the program this way; right-click the shortcut, select Properties, select the
      &quot;Compatibility&quot; tab, and check &quot;Run as Administrator&quot;.&nbsp; 
      However, running this way may make it hard to open files written by SerialEM, 
      and is generally inadvisable from a security standpoint.&nbsp; A better 
      alternative to this requirement is to connect with a socket interface (see 
      below) instead of the security-laden COM interface (or to not run 
      DigitalMicrograph as administrator, if that is the issue.)</P>
    <P>When connecting with a JEOL scope on Windows 7, running as Administrator was
      always needed until recently.&nbsp; When SerialEM has to be run as Administrator, if DigitalMicrograph is not also run as
      Administrator, SerialEM will probably fail to connect to it.&nbsp; The
      alternatives here are to run DM as Administrator or, preferably, to connect with the socket
      interface. </P>
    <p>
        <a name="gettingIP"><i><b>Determining IP addresses on a shared network</b></i></a>.&nbsp; When the SerialEM
        setup requires communication between two computers, it may not be
        straightforward to find out the IP address that is needed.&nbsp; A general
        procedure is to open a Command Prompt window on each computer and run
        &#39;ipconfig&#39;.&nbsp; Look at the first three numbers in each IP address.&nbsp;
        There should be one pair of addresses where those three numbers match between
        the computers (often 192.168.0 or 192.168.1).&nbsp; You can then test the
        communication in each direction with the command &#39;ping&#39; followed by the IP
        address of the other computer.</p>
    <P><a name="environmentVar"><i><b>Defining an Environment Variable.</b></i></a>&nbsp; In several situations, you may
      have to define a system environment variable to provide information for one of
      the components that SerialEM connects to.&nbsp; The procedure is:</P>
      <ul>
        <li>On Windows XP, right click on My Computer (on desktop or in an explorer
            window) and select Properties.&nbsp; Select the &#39;Advanced&#39; tab.</li>
        <li>Or, on Windows 7, right click on Computer in an explorer window and select
            Properties.&nbsp; Select Advanced System Settings on the upper left.</li>
        <li>Press the &#39;Environment variables&#39; button.</li>
        <li>Under &#39;System variables&#39;, press &#39;New&#39; and enter the specified
          name of the variable in the name
            box and the specified value in the value box.&nbsp; Press OK, Close, etc.</li>
    </ul>
      <P><a name="shortcutsArgs"><i><b>Shortcuts, Command Line Arguments, and Administrator mode.</b></i></a>&nbsp;
        When users log in to their own accounts, users should start SerialEM by means of a shortcut on their desktops. After
        creating the shortcut, always edit its properties to start in a folder belonging
        to the particular user. That way, each user will have their own settings file,
        separate from the one that inevitably ends up in the SerialEM folder because
        someone starts SerialEM by clicking on the program itself.&nbsp; </P>
    <P>When users all share one account, they can have separate settings if there is a
      shortcut for each user, which can be placed either on the desktop or in a folder
      on the desktop.&nbsp; The framework files that we distribute provide a
      structure for holding settings files and shortcuts for each user in a folder
      'UserSettings' under C:\Program Files\SerialEM (Windows XP) or C:\ProgramData\SerialEM (Windows 7).&nbsp;
      To make files and shortcuts for a new user:</P>
    <ol>
      <li>Create a folder with the user's name under 'UserSettings'.</li>
      <li>Copy the contents of another user's folder into the new folder.</li>
      <li>Right click on the SerialEM shortcut in the new folder, select Properties, and
        change the 'Start in' entry from the previous user's name to the new one.</li>
      <li>For more convenient access, right click and drag the shortcut to the desktop or
        a common folder to copy it there, and rename the shortcut so it is
        distinguishable.</li>
    </ol>
    <P>Another option is to make settings files with different names, and set up a
      different shortcut for each user using the &#39;/Settings=&#39; command line argument
      described below.&nbsp; However, since users may want to save multiple settings
      files, it is probably better to have a folder for each user.</P>
      <P><b>Do not run the SerialEM.exe in the package subfolder, or make a shortcut to
      that copy of the program.</b>&nbsp; If you do, the program will load all the
      plugins in that folder.&nbsp;Then it will complain about multiple microscope
      plugins and refuse to run.</P>
    <P>If you set up
        separate properties and calibrations for running at a different voltage, those
        files can be accessed by running with a separate shortcut.&nbsp; As of SerialEM
        3.3.1, this is done by having the shortcut include an argument specifying the
        subfolder where the files are located (see
        <A href="#separate_kv">Setting Up for a Separate Voltage</A>).</P>
    <P>Four other entries besides a subfolder are allowed as command line arguments on
      the target line of a shortcut.&nbsp; They can be in any order, as long as they
      appear <i>before</i> a final subfolder for the location of system files, if any.&nbsp;
      They are:&nbsp; </P>
    <ul>
      <li>&#39;/DUMMY&#39;, which makes the program
      start up without any camera or microscope connection and allows this instance of
      the program to run at the same time as a connected instance of SerialEM.&nbsp;
        There must still be properties for at least one camera in the properties file,
        and an ActiveCameraList with at least one camera in it.</li>
      <li>&#39;/Settings=&#39;, followed by the name of a settings file in the &#39;Start in&#39; folder
        of the shortcut, will make the program try to load that file instead of
        SerialEMsettings.txt.&nbsp; <em>No spaces are allowed in this file name or
        between the = and the file name</em>.&nbsp; This feature allows you to set up
        multiple shortcuts to access different, individually named settings files
        without having to either have a separate folder for each or start with a
        standard file then load another settings file.</li>
      <li>&#39;/NoCam&#39;, followed by one or more numbers of cameras that should be dropped
        from the active camera list.&nbsp; For example, &#39;/NoCam:2&#39; or &#39;/NoCam:1,3&#39; would
        drop camera 2 or cameras 1 and 3.&nbsp; There must be no space between &#39;/NoCam&#39;
        and the numbers.&nbsp; This entry allows a shortcut to be used when a camera is
        temporarily unavailable or to prevent some users from accessing particular
        cameras.&nbsp; You cannot remove all active cameras from the list.</li>
      <li>&#39;/PlugDir=&#39;, followed by the full path to an alternative directory to be
        searched for plugins.&nbsp; Double qoutes must be used around the path if it
        contains spaces; otherwise quotes are optional. Without such an argument, the
        program will try to load as plugins any files matching &#39;*Plugin*.dll&#39; in the
        folder where the SerialEM executable is, then try to load all &#39;.dll&#39; files in
        the folder indicated by the property &#39;PluginPath&#39;, which is &#39;C:\Program
        Files\SerialEM\Plugins&#39; by default.&nbsp; With this argument, the program will
        load &#39;.dll&#39; files only in the indicated folder and not from the executable
        folder or the &#39;PluginPath&#39; folder.&nbsp; This argument is useful for running a
        test version of a microscope plugin; however, on some systems, you may have to
        copy the Microsoft.VC90.CRT and Microsoft.VC90.MFC folders into the folder with
        the test plugin.</li>
      <li>Any one of these entries can be &#39;commented out&#39; by placing a &#39;#&#39; after the 
        &#39;/&#39;, i.e., &#39;/#NoCam:1&#39; will be ignored.&nbsp; This feature makes it easy to 
        leave out or add back an argument, if that has to be done frequently.</li>
    </ul>
      <P>Note that a user's settings file contains an entry for the system path. A user
        can change this to point to a different location where the program will seek the
        Properties and Calibration files. This provides two possibilities: that the
        configuration files can be installed in a folder other than the default one; and
        that a different set of properties and calibrations can be set up for some
        circumstances, such as running a beta version of SerialEM. It also provides for the arrangement described
        next.</P>
      <P>As the program administrator, you should start SerialEM with the shortcut in
        the UserSettings/Setup subfolder (copy this shortcut to the desktop if you want.) When you
        start SerialEM with this shortcut, you will access the settings in this
        folder that might differ significantly from what people use for production use.</P>
      <P>Whenever you start the program to do some calibrations, turn on 'Administrator
        mode' (in the Calibration menu). In this mode (which has nothing to do with
        running as Administrator in Windows 7), you will get extra output from
        some calibration procedures, and you will also be protected from exiting without
        saving calibrations.&nbsp; You can add a property &#39;StartAsAdministrator 1&#39; to do
        this automatically during initial program setup, then remove it when you are
        done.</P>
      <P>The procedures below refer to a number of entries to be made or modified in the
        properties file. Each entry has a mixed case keyword followed by one or more
        values. See <A href="about_properties.htm">Property File Entries</A> for more
        details.</P>
    <P>&nbsp;</P>
      <P><A name="setup_minimal"></A><B>A Minimal Setup Procedure</B></P>
      <P>Do you find the full setup procedures daunting? Do you want to do just enough
        to get the program usable and try taking a tilt series? If so, for a Thermo/FEI
        microscope, you can do the
        setup in two stages, first going through all of the items indicated as Priority
        1 below, then going back later and doing Priority 2 items. (It is strongly
        recommended that you not stop with Priority 1 items) When you read the
        explanation of some of the Priority 2 items, you may find that they are not
        relevant to your needs and can be skipped. In addition, there are some
        procedures documented below 'for the sake of completeness' which you can almost
        certainly skip.</P>
      <P>The initial minimal procedure would be:</P>
      <OL>
        <LI>
          If you started with a generic Properties file, insert appropriate camera and
          magnification table entries (<A href="#setup_generic">Starting with a Generic
          Properties File</A>).
        <LI>
          Adjust the camera settings in the Properties file (see<A href="#setup_camera">
          Initial Camera Setup</A>
          ), paying particular attention to 'GainNormalizeInSerialEM', the first 3 items
          in the general camera parameter section, and the parameters for each camera.
        <LI>
          If you did not get an initial Properties file appropriate for your voltage and
          configuration, you need to check and set up the
          magnification table (<A href="#setup_magtable">Checking the Magnification Table</A>
          ).
        <LI>
          Run a DigitalMicrograph script and a procedure in SerialEM to set the camera
          timing (<A href="#setup_timing">Tuning Gatan Camera Timing</A>
          )
        <LI>
          Calibrate image shift from the lowest M-mode magnification to the highest mag at
          which you want to try the program, following the procedures in <A href="#setup_pixelsize">
            Calibrating Image Shift and Pixel Size</A>
          indicated by 'if you just want to get the program running'.
        <LI>
          Calibrate autofocus (<A href="#setup_focuscal">Focus Calibration</A>
          ).
        <LI>
          If you have an energy filter, calibrate magnification-dependent energy shifts ( <A href="#setup_gifcal">
            Energy Filter Calibrations</A>
          ).
        <LI>
          Perform the tasks in <A href="#setup_final">Final Tasks</A> .</LI></OL>
      <P>After doing these items, you can work with the program and try doing a tilt
        series, but you will not be able to control the intensity during a tilt series
        unless you calibrate beam intensity for at least one spot size (see <A href="menu_calibration.htm#hid_calibration_beamintensity">
          Beam Intensity</A> ). Other specialized features will not work until the rest
        of the calibrations have been done.</P>
    <P>&nbsp;</P>
      <P><A name="setup_generic"></A><B>Starting with a Generic Properties File
        (Priority 1)</B></P>
      <P>If your properties file has not been configured for your scope yet, you can
        start with a generic file, but only on a Thermo/FEI scope.&nbsp; The generic file does
        not contain many essential entries for JEOL or Hitachi microscopes.&nbsp; If you
        download and unpack the GenericFramework.exe file, you should also download
        GenericProperties.txt from the Tools folder on the SerialEM download site
        (https://bio3d.colorado.edu/ftp/SerialEM/Tools), rename it to
        SerialEMproperties.txt, and replace the file from the framework. Then download
        and incorporate camera properties and magnification table files from the Tools
        folder.
      </P>
      <OL>
        <LI>
          At the place in the file that says 'INSERT CAMERA PROPERTIES', insert text from
          the most appropriate camera properties file in the Tools folder. Do this for
          each camera, increasing the number on the first line ('CameraProperties') by 1
          for each camera.
        <LI>
          At the place in the file that says 'INSERT MAGNIFICATION TABLE', insert text
          from the most relevant magnification table file in the Tools folder. If none is
          relevant, then follow the procedure in <A href="#setup_magtable">Checking the
          Magnification Table</A>
          when you get to that point in the procedures.
        <LI>
          For a Tecnai or Polara, search for the text 'SET TO' and change the values as
          appropriate for the KV or other features of your scope, as indicated in the
          comments. The values for 200 KV can be used for 120 KV.</LI>
    </OL>
      <p>
        If the program is running under Windows
        XP or Windows 2000, you need to make the
        following modifications.</p>
    <ol>
      <li>In the Properties file, change 'ProgramData' to 'Program Files' in the entries
        for GainReferencePath and LogBookPathName.</li>
      <li>In SEMsystemSettings.txt and UserSettings/Setup/SerialEMsettings.txt,
        change 'ProgramData' to 'Program Files' in the entry for SystemPath.</li>
      <li>In the SerialEM and the UserSettings/Setup folder, right click on the SerialEM shortcut and select
        properties.&nbsp; Change 'ProgramData' to 'Program Files' in the entry for the folder
        to 'Start in'.</li>
      <li>If there are any other settings files on your system with a SystemPath entry
        of C:\ProgramData\SerialEM, they should be changed similarly.&nbsp; Also, any other
        shortcuts that start in C:\ProgramData\SerialEM should be changed.</li>
    </ol>
      <p>
        If you have a Gatan camera with GMS 2.x
        or GMS 3.x, you need these modifications to the
        Properties file:</p>
    <ol>
      <li>Fix the entry for the DigitalMicrographReferencePath.&nbsp; It should be either
        'C:\ProgramData\Gatan\Reference Images' under Windows 7/8/10 and Server
        2008/2012, or 'C:\Documents
        and Settings\All
        Users\Application Data\Gatan\Reference Images' under Windows XP and 2000.</li>
      <li>Check the entries for DMGainReferenceName in the CameraProperties sections and
        make sure they end in '.dm4' instead of '.dm3'.</li>
    </ol>
      <p>
        &nbsp;</p>
    <p>
        <b><A name="FEI_Socket"></A>Connecting with a Thermo/FEI Microscope through Plugin and Server (Priority 1)</b></p>
    <p>
        Ordinarily SerialEM's
        Thermo/FEI scope plugin interacts with a Thermo/FEI microscope using a COM connection to the
        Thermo/FEI scripting adapter, but this is not possible when running SerialEM on a
        separate 64-bit computer, such as a Gatan K2/K3 or Direct Electron camera computer, or
        on older
        64-bit Thermo/FEI systems.&nbsp; A
        connection is possible in these cases by using a network socket connection to a small server
        (<nobr>FEI-SEMserver.exe or FEI-SEMserver-Win2k.exe</nobr>) on the Thermo/FEI computer.&nbsp; This server makes a
        COM connection to the scripting adapter.&nbsp; The server needs to be started
        every time that a user logs in.&nbsp; This server supports all interactions with
        the Thermo/FEI microscope, including acquisition from Thermo/FEI cameras (Eagle, Falcon, Ceta) and from STEM detectors.&nbsp;
        It uses three or four consecutive ports for communications.&nbsp; The server can
        also be used to run a 64-bit version of SerialEM on 64-bit microscope
        computers with older versions of Thermo/FEI software where a direct connection did not
        work.&nbsp; </p>
    <p>
        <a name="needNetwork"><i><b>Yes, You Need a Network Connection between the Computers</b></i></a>.&nbsp; SerialEM
        does not use DigitalMicrograph&#39;s serial-port based communication with the scope;
        it requires a network connection between the computers.&nbsp;&nbsp; These points
        may be helpful if you do not have a connection.</p>
    <ul>
      <li>Often the camera computer has a free network port, but if not, another gigabit
        network card needs to be added to it.</li>
      <li>If the scope computer is already connected to a support computer, the camera
        computer can join this local network.&nbsp; If that connection is already
        through a switch, the camera computer can be plugged in to that switch.&nbsp;
        Usually, however, the scope and support computers are directly connected with a
        crossover cable.&nbsp; In this case, you need to get a simple 4 or 5 port
        gigabit switch and three regular network cables.&nbsp; Connect each computer to
        the switch with the regular cables.&nbsp; Set up a new network connection on the
        camera computer and assign an IP address with the same first three numbers as
        the scope and support computers, but with a unique last number.</li>
      <li>If the scope computer is not connected to a support computer and does not have
        a free network port, a gigabit network card needs to be added to it.</li>
      <li>If the scope computer is not connected to a support computer, you can connect
        it directly to the camera computer through a crossover cable, or connect both
        computers to a switch with regular cables.&nbsp; Set up a new network connection
        on each computer with an IP address having the same first three numbers,
        different from any of the first three numbers for existing IP addresses on
        either computer.&nbsp; For example, you might make them 192.168.2.1 and&nbsp;
        192.168.2.2.</li>
    </ul>
    <p>
        <a name="pluginServer"><i><b>Setting Up the Plugin and Server</b></i></a>.&nbsp; These steps need to occur:</p>
    <ul>
      <li>The plugin FEIScopePlugin.dll needs to be copied from the package directory into
        the upper SerialEM directory.&nbsp; This will be done by the SerialEM installer
        either automatically, or if you answer &#39;Y&#39; to the question about whether to install the plugin.</li>
      <li>Determine the IP address of the Thermo/FEI computer.&nbsp; The properties file needs
        to have the lines<br />
&nbsp; SocketServerIP 1 IP_address<br />
&nbsp; SocketServerPort 1 48892</li>
      <li>You can choose a different port number if there is a problem with 48892.&nbsp;
        However, the server uses this port by default, so to use a different port,
        define an environment variable on the Thermo/FEI computer, FEISEMSERVER_PORT, with the
        value of the port number.</li>
            <li>Make sure that this port and the three following ones (48893-48895 by
        default) is open for communication between SerialEM and Thermo/FEI computer.&nbsp; Define an
        outgoing rule in the firewall on the SerialEM computer&nbsp;to allow the four ports
        to be connected to on the local domain. If there is any possibility of either
        machine being exposed to the internet, do not simply turn off the firewalls;
        open only these specific ports in the firewall, and allow access only by the
        other machine or the local subnet.&nbsp; The fourth port is used only if the property
              'BackgroundSocketToFEI 1' is set, so existing setups will run with just the
              three ports.</li>
      <li>Copy the server, FEI-SEMserver.exe, into some appropriate location on the Thermo/FEI
        computer from which it can be run by all users.&nbsp; (You can create C:\Program
        Files\SerialEM just for this purpose if no other place is preferred.)&nbsp; For 
        a Windows 2000 computer (yes there are still some!), copy 
        FEI-SEMserver-Win2k.exe instead.&nbsp; For a Windows XP system that is SP1 or 
        SP2, try FEI-SEMserver.exe first, and if that fails to run, use 
        FEI-SEMserver-Win2k.exe instead.</li>
      <li>Make a shortcut to the server in C:\Documents and Settings\All Users\Desktop</li>
      <li>If you are using STEM through the Thermo/FEI interface, also copy FocusRamper.exe
        and register-Ramper.bat onto the Thermo/FEI computer (into C:\Program Files\SerialEM or
        other preferred place).&nbsp; Click on register-Ramper.bat to run it (Run as Admin on
        Windows 7).</li>
    </ul>
    <p>
      When the server is started, a DOS window will appear with messages about
      connections as they occur.&nbsp; When SerialEM starts, there will be a message
      in its log about whether the plugin loaded successfully.&nbsp; If the connection
      fails, some debugging output is available in SerialEM by adding the property
      &#39;DebugOutput K&#39;.&nbsp; Debugging output is available in the server window by defining the
      environment variable FEISEMSERVER_DEBUG to 1 (for some output) or 2 (for very
      verbose output).&nbsp; If 4 is added to the value, the server will attempt to
      put output in a log file at C:\Program Files\SerialEM\FEIServerDebug.txt if that
      folder exists.</p>
    <p>
      <a name="movingTo64"><i><b>Moving an Existing Installation from a Thermo/FEI Computer to a 64-bit Computer</b></i></a>.&nbsp;
      If already have SerialEM running on a Thermo/FEI computer and want to run it on a
      64-bit computer instead, some steps are needed in addition to the ones
      listed above:</p>
    <ul>
      <li>Copy all the '.txt' files, the UserSettings folder and gain references if desired
        from C:\Program Files\SerialEM on the scope computer to C:\ProgramData\SerialEM
        on the 64-bit computer.</li>
      <li>Modify any paths in the properties file referring to C:\Program Files\SerialEM
        to be C:\ProgramData\SerialEM instead.</li>
      <li>Also modify DigitalMicrographReferencePath and DMRemoteReference path entries
        as appropriate.</li>
      <li>If moving to a Direct Electron server, change the 'DECameraServerIP' property
        to '127.0.0.1'.</li>
      <li>If moving to a K2/K3 camera computer and there are no Gatan cameras on the scope
        computer, you can continue to use the socket connection; change the
        &#39;GatanServerIP&#39; property to &#39;127.0.0.1&#39;.</li>
      <li>If moving to a K2/K3 camera computer and there <i>are</i> Gatan cameras on the
        scope computer, then the COM connection must now be used for the K2/K3 computer so
        that the socket connection is available for connecting with those other cameras.&nbsp;
        Change the &#39;UseSocket&#39; camera property for the K2/K3 and any other cameras on this
        computer from 1 to 0.</li>
      <li>If there are Gatan cameras on the scope computer, follow the instructions in
        the section <a href="#connectDMsocket"> <i>To</i> <i>connect to
                  DigitalMicrograph through a socket interface</i></a><i> </i>below to switch the socket connection to the DM on the scope computer.</li>
      <li>If any SerialEM shortcuts pointing to settings in 'UserSettings'
        were used, modify the shortcut (right-click and
        select properties) and change 'Program Files' to 'ProgramData' in the
        'Start in' folder.</li>
      <li>If some users ran directly from the C:\Program Files\SerialEM folder, using a
        SerialEMsettings.txt file there, then move that settings file to
        C:\ProgramData\SerialEM and create a shortcut for starting the program in that
        folder.&nbsp; (Right click on SerialEM.exe and drag into the folder, select
        'Create a shortcut here' when the menu pops up.)&nbsp; Modify the properties of
        the shortcut to change the 'Start in' folder to
        C:\ProgramData\SerialEM .&nbsp;
        This shortcut can then be copied elsewhere.</li>
      <li>Any settings file that is copied over from the other computer needs to be
        edited to change &quot;Program Files&quot; to &quot;ProgramData&quot; in the first line, the
        &quot;SystemPath&quot;. ProgramData\SerialEM</li>
    </ul>
    <p>
      <a name="upgradePlugServer"><i><b>Upgrading to the New Plugin and Server from SerialEM 3.4.</b></i></a>&nbsp;
      As SerialEM will inform you when you upgrade, you need to update the
      <nobr>FEI-SEMserver.exe</nobr> on the microscope computer.&nbsp;&nbsp; If you
      had to make a firewall opening for the one port before, open the additional
      three
      ports.</p>
    <p>
      <a name="run64bitFEI"><i><b>Running 64-bit SerialEM on a 64-bit Thermo/FEI Computer</b></i></a>.&nbsp; This is more
      straightforward.&nbsp; With a new system, first try to run the 64-bit version of
      SerialEM without the server.&nbsp; If you get a message about the &#39;dark field
      element&#39;, use the server with these steps:</p>
    <ul>
      <li>Make sure that FEI-SEMserver.exe is in the upper SerialEM folder (the
        installer should copy it there on a 64-bit system).</li>
      <li>Make sure these properties exist:<br />
&nbsp; SocketServerIP 1 127.0.0.1<br />
&nbsp; SocketServerPort 1 48892</li>
      <li>Make a shortcut to the server in C:\Users\All Users\Desktop</li>
    </ul>
    <p>
      <a name="upgradingK2toK3"><i><b>Upgrading from a K2 to a K3 camera</b></i></a>.&nbsp;This
    requires a few modifications of the SerialEMproperties.txt file and
    recalibrating SerialEM.&nbsp; There are three cases to consider:</p>
    <ol>
      <li>To move SerialEM from a K2 computer to the K3 computer, copy
        C:\ProgramData\SerialEM from the
        K2 to the K3 computer, as well as any settings files elsewhere that you wish to
        keep.&nbsp; Be sure to acquire these files before the K2 disappears!</li>
      <li>To move SerialEM from a microscope computer to the K3, first follow the
        instructions in <a href="#movingTo64">Moving an Existing
          Installation from a Thermo/FEI Computer to a 64-bit Computer</a></li>
      <li>To keep SerialEM on the microscope computer, just modify properties as
        described next</li>
    </ol>
    <p>
      In any case, install a new version of SerialEM, one that is up to date with K3
      support.</p>
    <p>
      &nbsp;When changing to a very different camera, it is usually a good idea to give the
      new camera a different number.&nbsp; This is probably not necessary for a K2 to
      K3 change, but all the camera parameter sets in settings files will have
      under-sized images and exposure times too long and will need to be adjusted
      appropriately.</p>
    <p>
      Change the properties file as follows:</p>
    <ul>
      <li>If you were running GMS 2 before, in any K2FilterName entries (usually just above the K2 CameraProperties
        section), remove the word &quot;Filter&quot; from the filter name (not from &#39;K2FilterName&#39;).</li>
      <li>In the CameraProperties section, change the Name from K2 to K3.</li>
      <li>Set the K2Type to 3.</li>
      <li>Fix the gain reference name to match what is in C:\ProgramData\Gatan\Reference
        Images.</li>
      <li>Set the SizeInX and SizeInY to 5760 and 4092, or vice versa for a camera with
        a 90 or 270 degree rotation.</li>
      <li>Correct the entries for RotationAndFlip and DMRotationAndFlip based on the
        settings for rotation and flip around Y axis in DM Camera Configuration dialog
        (switch to Power User mode to access the Camera menu in DM).&nbsp; See the table
        below.</li>
      <li>Comment out (put a # in from of)&nbsp; 'SizeCheckSwapped'.</li>
      <li>Change BasicCorrections to 1</li>
      <li>Change CountsPerElectron to 32.</li>
      <li>Add the line 'LinearToCountingRatio 300' below the 'CountsPerElectron' line.</li>
    </ul>
    <p>The section <a href="#setup_camera_gain">Measuring Camera Gain</a>
        describes procedures for determining LinearToCountingRatio and
        K3CDSLinearRatio (relevant with GMS 3.31.2336 or higher, which support
        correlated double sampling).</p>
        <p>If there is a rotation by 90 or 270 and a flip in the camera configuration, check
        if your version of DM still has the rotation bug described in
        <a href="about_camera.htm#k3problems">Remaining Problems with the K3</a> by taking an image
        without and with dose fractionation to see if they have the same orientation.&nbsp;
        (The bug is gone in 3.31.2336.)</p>
    <p>
      The required recalibrations are:</p>
    <ul>
      <li>Image shift and pixel size.&nbsp; For image shift, you may be able to
        calibrate image shift from scratch at one mag in each mag range (LM and nonLM)
        and allow the program to change all other calibrations in the range.&nbsp; (Turn
        on Administrator mode in the Calibration menu first.)&nbsp; Then you can check
        at one or more other mags to see if the adjustments were good.&nbsp; For pixel
        size, you may be able to measure several sizes, find the average ratio between
        the old and new pixel sizes at those mags, and apply the ratio manually to fix
        the sizes in the properties file.&nbsp; If these shortcuts do not seem feasible,
        follow the procedures described below.</li>
      <li>Calibrated absolute rotation angle(s) in the RotationAndPixel table.&nbsp; If
        images have rotated from their previous orientation with the K2, adjust the
        angles by this rotation before trying to calibrate stage shift.</li>
      <li>Focus calibrations.&nbsp; Again, in Administrator mode, the program will offer
        to change other calibrations based on the change in the first one that you do,
        and this may be&nbsp; adequate.</li>
      <li>Stage shift calibrations.</li>
    </ul>
    <p>
      &nbsp;</p>
      <P><A name="setup_camera"></A><B>Initial Camera Setup (Priority 1 and 2))</B></P>
      <P>You should set the basic properties of your camera(s) in the properties file
        before starting SerialEM. If you received a file configured for your scope, most
        of this should be set up already, but you should go through these lists of items
        to find the ones you do need to change and to become more familiar with the
        intricacies of camera setup. If you are going to set GainNormalizeInSerialEM to
        0, you do not need to specify UsableArea, BadColumns,or DMGainReferenceName.
        However, gain normalizing in SerialEM has several advantages for CCD cameras, including faster
        image acquisition, the ability to retain many dark references, and the ability
        to remove X rays from dark references. (DigitalMicrograph maintains only one
        dark reference per binning, which may force a lot of unneeded dark reference
        acquisitions when switching between parameter sets, unless dark references are
        coming from a file.)&nbsp; Newer Gatan cameras
        (K2/K3 and OneView/Rio) will always normalize in DigitalMicrograph.</P>
      <P><a name="cameraOrientation"><i><b>Camera Configuration for Image Orientation</b></i></a>.&nbsp; Before you start any calibrations, make sure that your camera is configured so
        that images acquired on the camera have the same orientation as images on the
        viewing screen. If you have a Gatan 4-port readout camera with First Light
        controller, the camera configuration should generally be set in DigitalMicrograph to flip
        images around the Y axis. If for some reason the image orientation cannot be
        made to match that on the viewing screen (e.g., the orientation cannot be
        changed, or other software or other users require the odd orientation), then you
        may need to set properties to compensate. If there is a rotation, you would need
        an ExtraRotation entry for that camera. If the image is flipped, you would need
        an entry for InvertStageXAxis, which is a global setting, and possible an
        ExtraRotation entry too.&nbsp; In any event, after you have settled on a camera
        configuration for a Gatan camera, add a &#39;DMRotationAndFlip&#39; property for each camera to get a
        warning if the configuration is changed from this setting.&nbsp; Having this
        entry can save a lot of time figuring out what is wrong when the configuration
        gets changed.&nbsp; The number to
        enter with the property is the rotation in DM divided by 90, plus 4 if there is
        flipping around the Y axis (e.g., typically 4 for an UltraScan).&nbsp; Here are
        all the possibilities:</P>
    <table class="style1">
      <tr>
        <td class="style4">
          Setting in DM Configure Camera</td>
        <td class="style6">
          DMRotationAndFlip</td>
        <td class="style8">
          RotationAndFlip&nbsp; for K2/K3</td>
      </tr>
      <tr>
        <td class="style10">
          No rotation, no flip</td>
        <td class="style5">
          <p class="style9">
          0</p>
        </td>
        <td class="style7">
          <p class="style9">
          0</p>
        </td>
      </tr>
      <tr>
        <td class="style10">
          90 degree rotation, no flip</td>
        <td class="style5">
          <p class="style9">
          1</p>
        </td>
        <td class="style7">
          <p class="style9">
          3</p>
        </td>
      </tr>
      <tr>
        <td class="style10">
          180 degree rotation, no flip</td>
        <td class="style5">
          <p class="style9">
          2</p>
        </td>
        <td class="style7">
          <p class="style9">
          2</p>
        </td>
      </tr>
      <tr>
        <td class="style10">
          270 degree rotation, no flip</td>
        <td class="style5">
          <p class="style9">
          3</p>
        </td>
        <td class="style7">
          <p class="style9">
          1</p>
        </td>
      </tr>
      <tr>
        <td class="style10">
          No rotation, Flip around Y</td>
        <td class="style5">
          <p class="style9">
          4</p>
        </td>
        <td class="style7">
          <p class="style9">
          4</p>
        </td>
      </tr>
      <tr>
        <td class="style10">
          90 degree rotation, Flip around Y</td>
        <td class="style5">
          <p class="style9">
          5</p>
        </td>
        <td class="style7">
          <p class="style9">
          5</p>
        </td>
      </tr>
      <tr>
        <td class="style10">
          180 degree rotation, Flip around Y</td>
        <td class="style5">
          <p class="style9">
          6</p>
        </td>
        <td class="style7">
          <p class="style9">
          6</p>
        </td>
      </tr>
      <tr>
        <td class="style10">
          270 degree rotation, Flip around Y</td>
        <td class="style5">
          <p class="style9">
          7</p>
        </td>
        <td class="style7">
          <p class="style9">
          7</p>
        </td>
      </tr>
    </table>
      <P><a name="generalCamParams"><i><b>General camera related parameters</b></i></a> (and a few other things that could be dealt
        with later, but you might as well attend to them now or be aware of them.)
        (First 3 are Priority 1):</P>
      <UL>
        <LI>
          MRCHeaderTitle: Set this to the title that you want to appear in your output MRC
          files
        <LI>
          ActiveCameraList: List the camera numbers
          of the available cameras. The camera number is the number on the 'CameraProperties' line,
          numbered from 0. Gatan cameras must be listed in the order in which the cameras
          appear in DM; other than this, cameras can be in any order.<LI>
          ReferenceMemoryLimitMB: This number, in MB, determines how many gain and dark
          references can be held in SerialEM at once. 160MB should be adequate for a 4K
          camera. If your system does not have much memory and you have only a 2K camera,
          the number can be smaller (50MB).
        <LI>
          GainRefInactivityLimit: This parameter tells SerialEM how often to check for new
          gain references in DM. It should be shorter than the minimum time that it would
          take for a user to take a good gain reference in Digital Micrograph. If you have
          a 1K camera, 60 would be appropriate.
        <LI>
          DarkRefAgeLimit: Set this time limit (in seconds) smaller if your camera needs
          new dark references frequently.
        <LI>
          DefaultCameraDivide16BitBy2: This parameter sets the default behavior with
          16-bit cameras; set it to 1 to have 16-bit images divided by 2. Dividing by 2 is
          appropriate when the last bit is noise, and will eliminate the problem of how to
          store 16-bit data. Users will have their own individual settings that they can
          change, but this property determines their initial setting.
        <LI>
          DefaultActAfterExposures: If this parameter is 1, then by default the program
          will perform actions during camera readout, such as tilting and changing image
          shift. This feature is not available for all camera types and requires that the
          &#39;StartupDelay&#39; property for each camera be either accurately measured or
          sufficiently long so that the actions do not start during the exposure.&nbsp; Do not try
          to use this feature with anything but a Gatan camera until the camera timing has been
          determined.
        <LI>
          BeamCalMaxCounts: The beam intensity calibration procedure may fail if this
          value is not appropriate for your camera. Set it to about 2/3 of the saturation
          limit for your camera. For a 16-bit camera, specify this in original counts
          before division by 2.
          </UL>
        <P>
          <I>Parameters for each camera</I> (many relevant only to Gatan cameras, all Priority 1):
          </P>
          <ul>
        <LI>
          Name: Pick a name for your camera that users will recognize.
        <LI>
          DMGainReferenceName:
          for a Gatan camera, find the gain reference in the DM Reference Images folder
          and copy the name exactly as it appears.
        <LI>
          Set CameraSizeX and CameraSizeY
        <LI>
          UsableArea: Insert the coordinates of the last good pixels on the edge, which
          are one pixel in from the rows and columns listed in the DM defect table.
        <LI>
          BadColumns: Uncomment if there are any bad columns and list them, separated by
          spaces, using the same numbers as in the DM defect table.
        <LI>
          Binnings: List the binnings that you know work and that you want the users to
          see (the supplied default should be OK).
        <LI>
          MakesUnsignedImages: set to 1 for a 16 bit camera.
        <LI>
          BeamBlankShutter:
          For Gatan cameras with two shutters, should be 1 if your scope is configured typically, but needs
          to be 0 if your beam shutter is connected to the standard instead of the
          alternate shutter.
        <LI>
          SetAlternateShutterNormallyClosed: Set this to 0 if for some reason you do not
          want SerialEM to set the beam shutter normally closed for this camera upon
          startup. Note that if your beam shutter is connected to the standard instead of
          the alternate shutter, this setting will still do what you want.
        <LI>
          OnlyOneShutter: Insert a line setting this to 1 if the camera is connected to
          only one shutter.
        <LI>
          If you have DigitalMicrograph 3.7.1.5, uncomment 'CanDriveDMBeamShutter 0' and
          'CanDriveDMSettling 0'; otherwise, the plugin should be able to determine these
          capabilities.
        <LI>
          Timings will be dealt with later.
        <LI>
          Check the settings for Retractable, GIF, and Order for appropriateness.
        <LI>
          If you have a GIF with a TV camera and older controllers, you may want 'InsertTVToUnblank' set to 1, as it
          allows both cameras to be maintained in the configuration of Alternate Shutter
          Normally Closed without special hardware.
        <LI>
          Set PixelSizeInMicrons
        <LI>
          Set CountsPerElectron when you have a good estimate of the camera gain (see
        <A href="#setup_camera_gain">Measuring Camera Gain</A>). These
          would be counts before division by 2 for a 16-bit camera. The program needs this
          value to compute electron dose, except for K2/K3 cameras. It also needs beam intensity calibrations and
          spot intensity calibrations. In addition, a daily dose calibration is required;
          this can now be done automatically when taking the gain reference.
        <LI>
          Leave 'RotationAndPixel' lines, if any, commented out.</LI></UL>
      <P><a name="forTietz"><i><b>For a Tietz camera</b></i></a>, attend to the following settings:</P>
      <UL>
        <LI>
          Set TietzCameraType according to the instructions in<A href="about_properties.htm#per_camera_properties">
            Properties for one camera</A>
        <LI>
          Set BuiltInSettling to 0.
        <LI>
          Set MinimumDriftSettling to 0.01 on a Thermo/FEI scope, 0.1-0.2 on a JEOL.
        <LI>
          ExtraBeamTime and StartupDelay will be set from a timing calibration.
        <LI>
          Set TietzCanPreExpose to 1 if the camera has a shuttering mode that allows
          pre-exposure of the specimen, using the film shutter and beam blanker.</LI>
        <LI>
          For newer CMOS cameras (F216, F416, XF416), it is possible to take images
          normalized in the Tietz software with flatfield images prepared there.&nbsp;
          This is especially helpful for the XF416.&nbsp; To use this feature, add the
          camera property &#39;TietzFlatfieldDir&#39; with the path to the
          Tietz gain references.&nbsp; The <A HREF="menu_camera.htm#hid_camera_normalizehere">Normalize
            Here</A> option in the Camera menu must also be turned off to
          enable normalization in the Tietz software.
        </LI>
        <LI>
          Frame alignment and saving using burst mode are enabled by default for XF416
          cameras; the property CanTakeFrames can be added and set to 1, 2, or 0 to hide
          the controls for aligning, saving, or both.&nbsp; For the older Fn16 cameras, if
          burst mode is available, you can make these features available by adding this
          property with a value of 3.&nbsp;
          Burst mode is well supported for a firmware version of at least 5.02 and may
          work for a firmware version between 2.36 and 5.02.</LI>
        <LI>
          Fast continuous mode using the Tietz live mode
          is enabled by default for all of these CMOS cameras and can be disabled with the
           property &#39;UseContinuousMode 0&#39;.&nbsp;
        </LI>
        <LI>
          Both burst mode and live mode images
           are taken in rolling shutter mode while single-frame images are taken in
          beam-blank shutter mode.&nbsp; These may require different gain references, and it may
          be preferable to use normalization through the Tietz software.&nbsp; See also the
          &#39;SubareasByCropping&#39; property, which allows Tietz flatfields to be taken only
          for full-sized images.
        </LI>
        <LI>
          To use a GPU for frame alignment, see <a href="#using_gpu">Setting Up to Use a
        GPU for Frame Alignment</a>, but ignore statements about the K2 or K3 and its card
          configurations.</LI></UL>
      <P><a name="connectDMsocket"><i><b>To connect to
        DigitalMicrograph through a socket interface</b></i></a> on the same or a different
        computer, <i>such as</i> <i>for a K2/K3 camera with SerialEM running on a Thermo/FEI microscope</i>, you need to do the following:</P>
    <ul>
      <li>Determine the IP address of the computer running DM on the network which that
        computer shares with the computer running SerialEM.&nbsp; If SerialEM and DM are
        running on the same computer, use &#39;127.0.0.1&#39; for the address.</li>
      <li>Set general property GatanServerIP to this address</li>
      <li>Set general property GatanServerPort to 48890 or another free port number if there is a problem
        with that number</li>
      <li>Set a property &#39;UseSocket&nbsp; 1&#39; for each camera being accessed through the
        socket interface.</li>
      <li>If DM and SerialEM are running on different computers, install the Shrmemframe package mentioned above for
      a K2/K3 camera, otherwise copy the appropriate SerialEMCDD plugin from the SerialEM_4-x-x folder to a
        Plugins folder on the other computer (the one running DM).&nbsp; Specifically:<ul>
          <li>If the other computer is running 64-bit Windows, copy&nbsp;
            SEMCCD-GMS2.31-64.dll,
            SEMCCD-GMS3.30-64.dll, or
            SEMCCD-GMS3.31-64.dll to C:\ProgramData\Gatan\Plugins</li>
          <li>If the other computer is running GMS2 on Windows XP or Windows 7 32-bit, copy SEMCCD-GMS2.0-32.dll
            or SEMCCD-GMS2.3-32.dll to
            C:\Program Files\Gatan\Plugins and rename it to SEMCCD-GMS2-32.dll</li>
        </ul>
      </li>
      <ul>
        <li>If the other computer is running GMS 1, copy SerialEMCCD.dll to
            C:\Program Files\Gatan\DigitalMicrograph\Plugins</li>
      </ul>
      <li>If DM and SerialEM are running on the same computer, the installer should have
        placed the right plugin in the right folder, but if not, follow the procedure
        just given.</li>
      <li>On the computer running DM, define a system environment variable SERIALEMCCD_PORT with the value 48890 or
        other selected port number, as described in the section above.</li>
      <li>Make sure that
        this port is open for communication between SerialEM and DM.&nbsp; If there is
        any possibility of either machine being exposed to the internet, do not simply
        turn off the firewalls; open only this specific port in the firewall, and allow
        access only by the other machine or the local subnet.&nbsp; Even if just this
        one port is exposed to the world, port scanners can interfere with communication
        and DM function.</li>
      <li>Restart DM.&nbsp; Note that no registration is needed for the plugin when
        using a socket interface.</li>
      <li>If the connection does not work, debugging output can be obtained on both
        sides by:<ul>
          <li>Adding a line to SerialEMproperties.txt: &#39;DebugOutput K&#39; (or adjusting an
            existing entry there to include &#39;K&#39;).</li>
          <li>Setting an environment variable SERIALEMCCD_DEBUG with the value of 1 or 2.&nbsp;
            2 will give more verbose output related to the socket operations.</li>
        </ul>
      </li>
    </ul>
    <p>
      <a name="K2details"><i><b>For a K2/K3 camera in particular</b></i></a>, there is more to do:</p>
    <ul>
      <li>The camera property
        &#39;RotationAndFlip&#39; (see <A href="about_properties.htm#per_camera_properties">Properties for one camera</A>)
        is needed to
        make sure that dose fractionation images are handled correctly and efficiently.&nbsp; You
        should be able to determine the value from the settings for &#39;Rotation&#39; and &#39;Flip
        around Y axis&#39; in the camera configuration in DM and the table above.&nbsp; The
        value is the same as the recommended &#39;DMRotationAndFlip&#39; property unless there is no flipping and
        the rotation is 90 or 270.</li>
      <li>Check what filters are available for aligning frames in dose fractionation
        mode in DM.&nbsp; Each filter should be listed with a general property
        &#39;K2FilterName&#39; and with the exact name shown in DM (including the &#39;(default)&#39; if
        any).&nbsp; </li>
      <li>It is possible to save Dose Fractionation frames in half the space by taking
        them without software gain normalization and applying this normalization in a
        post-processing step.&nbsp; Whenever counting or super-resolution frames are
        saved without gain normalization, the plugin to DM will copy the appropriate
        gain reference to the folder where the images are being saved. This used to
        require the general properties &#39;K2CountingReference&#39; and &#39;K2SuperResReference&#39;
        to be defined, but this would only work with a single K2/K3.&nbsp;
        Instead, make sure that the camera property &#39;DMGainReferenceName&#39; contains the
        correct name for an unbinned (&#39;x1&#39;) DM gain reference and that either the
        general property &#39;DigitalMicrographReferencePath&#39; or &#39;DMRemoteReferencePath&#39; is
        correctly set (presumably to &#39;C:\ProgramData\Gatan\Reference Images&#39;).</li>
      <li> TIFF files are saved as &#39;big TIFF&#39; so that
        files bigger than 4 GB can be written.&nbsp; This format cannot be read by
        version 3 of libtiff.&nbsp; If this causes a problem in some other software, you
        can override this behavior by setting an environment variable
        &#39;IMOD_ALL_BIG_TIFF&#39; to 0.</li>
      <li>To make frames be saved in packed format by default, add the general property
        &#39;K2PackRawFramesDefault&nbsp; 1&#39;.&nbsp;&nbsp; Users can have their own settings for this choice.</li>
      <li>Making counts match between linear and counting mode requires different
        procedures for K2 and K3 cameras, described in
        <a href="#setup_camera_gain">Measuring Camera Gain</a>.&nbsp; That section also
          describes how to make counts match in linear mode with correlated double
          sampling (CDS) on or off.</li>
      <li>To use frame alignment with the CPU when SerialEM is 32-bit on the K2/K3
        computer, or running on a different computer,&nbsp; you need to download and run
        Shrmemframe-GMSxxx.exe on the K2/K3 computer, where 'xxx' should be compatible
          with your
        version of GMS.</li>
      <li>To use a GPU for frame alignment, see <a href="#using_gpu">Setting Up to Use a
        GPU for Frame Alignment</a>.</li>
    </ul>
      <p>
        <a name="OneViewDetails"><i><b>To set up a OneView or Rio camera to save frames</b></i></a>,
        two camera property entries are needed and one or two others may be as well.&nbsp;
        Frame handling is done through the SEMCCD plugin to DigitalMicrograph, exactly
        as it is done for K2 and K3 cameras, so many of the same options are available.&nbsp;
        Specifically, the frame alignment is done with the same framealign module used
        for all direct detectors in SerialEM, which is designed for very low dose frames
        and can run on a GPU.&nbsp; For such frames, is likely to be better than the
        intrinsic drift correction in DigitalMicrograph, provided that the frames
        provided to the plugin are of similar quality to those used internally.&nbsp;
        However, for higher-dose images, this frame alignment will be slower and no
        better than drift correction.&nbsp; If you have no plans to try the alignment
        for low-dose work, it is probably best not to enable the interface, to avoid
        confusing users with two alignment methods.</p>
      <ul>
        <li>Add the camera property 'CanTakeFrames' with a value of 1 to enable the
          interface for frame-saving only, or a 3 to show the interface for frame aligning
          also.</li>
        <li>Add the camera property 'RotationAndFlip' (see <A href="about_properties.htm#per_camera_properties">Properties for one camera</A>)
          so that frame-based images are oriented correctly.&nbsp; You should be able to
          determine the value from the settings for 'Rotation' and 'Flip around Y axis' in
          the camera configuration in DM and the table above.&nbsp; </li>
        <li>You may need the camera property 'FrameTimeDivisors' if the number of frames
          obtained does not closely match the number shown in the Camera Setup dialog.&nbsp;
          There are default values in the program for the various camera types, based on
          the nominal frame rates, but they have been tuned only for OneView so far. When
          taking many frames, errors of 1 frame seem to be inevitable even after adjusting
          the times, but the times can be adjusted to reduce bigger errors.&nbsp; To
          refine the time for a binning, save 300-500 frames at the minimum frame time for
          that binning and multiply the default time listed for it in the description of
          'FrameTimeDivisors' by the ratio of the number of frames shown in the dialog to
          the number actually obtained.&nbsp; Add a 'FrameTimeDivisors' with the default
          or adjusted times for each binning.</li>
        <li>There is also a property 'MinimumFrameTimes' that can be set, if these times
          are longer than their respective frame time divisors.</li>
        <li>See the note on big TIFF files in the K2/K3 section above.</li>
      <li>To use frame alignment with the CPU when SerialEM is 32-bit on the camera
        computer, or running on a different computer,&nbsp; you need to download and run
        Shrmemframe-GMSxxx.exe on the camera computer, where 'xxx' should be compatible
          with your
        version of GMS.</li>
      <li>To use a GPU for frame alignment, see <a href="#using_gpu">Setting Up to Use a
        GPU for Frame Alignment</a>, but ignore statements about the K2 or K3 and its
        card configurations.&nbsp; It should be possible to fit a dual-height GeForce
        card in the camera computer, unless there are no available power connectors, in
        which case your choices are limited.</li>
      </ul>
      <p>
      <a name="DEdetails"><i><b>For a Direct Electron direct detection camera</b></i></a>, particularly if you are
      upgrading from a version before SerialEM 3.4, note these
      points:</p>
    <ul>
      <li>The camera name no longer defines the camera type but has to match the name in
        the server configuration file.&nbsp; Thus, you can set the camera property
        &#39;Name&#39; differently from &#39;DE12&#39; if you change the name in the server as well.</li>
      <li>Insertion and retraction are now properly managed by main camera module.&nbsp;
        The camera property &#39;Retractable&#39; should be set to 1.&nbsp; The camera has a
        good idea of when insertion and retraction are done, so the &#39;InsertionDelay&#39; and
        &#39;RetractionDelay&#39; properties can be set much lower, to 1 or 2 seconds.</li>
      <li>If you have the survey sensor defined as another camera in the properties
        file, add&nbsp; &#39;SamePhysicalCamera #&#39; to its camera properties, where &#39;#&#39; is
        the camera parameter set number of the main sensor.</li>
      <li>If you have a Gatan camera below the DE12 and it needs to be inserted in order
        for the blanking to work right, add &#39;AlsoInsertCamera #&#39; to the camera
        properties for the DE12 (and for the survey camera if that is configured too),
        where # is the camera parameter set number of the Gatan camera.</li>
      <li>It is a good idea to set the general property &#39;DEProtectionCoverDelay&#39; to the
        recommended value (possibly 800), so that one user&#39;s changes do not propagate to
        the next user.</li>
      <li>Drift settling (pre-exposure) is enabled and usable as long as the camera
        property &#39;OnlyOneShutter&#39; is not set to a non-zero value.&nbsp; If the shutter box
        controls two shutters, remove this setting.&nbsp; If you have a single shutter, you
        can also enable pre-exposure by removing this setting, but the beam will be on
        the chip during the pre-exposure and reduce its life accordingly.</li>
      <li>To use a GPU for frame alignment, see <a href="#using_gpu">Setting Up to Use a
        GPU for Frame Alignment</a>.</li>
    </ul>
      <p>
        <a name="FalconDetails"><i><b>For a Falcon 2 camera that can save
        intermediate frames, under original scripting interface</b></i></a>: </p>
    <ul>
      <li>Add the general property &#39;FalconFrameConfigFile&#39; with
        the full path and name of the XML configuration file that controls frame-saving.&nbsp;
        </li>
      <li>If there is a fast disk for saving these frames, or if there is a possibility
        that users can select network drives that the Thermo/FEI software will not save to, add
        the general property &#39;LocalFalconFramePath&#39; with a path for the initial saving
        of the frames.</li>
      <li>If the frames are not oriented the same as normal camera
        images, add the camera property &#39;RotationAndFlip&#39; with a value indicating the
        operation that needs to be applied to the frames to make them match (e.g., 1 or
        3 for 90 degrees counterclockwise or clockwise).&nbsp; If you find that the
        rotation takes too much time, you can leave this property out, but in that case
        you need the camera property &#39;AlignedSumRotFlip&#39; with the needed value so that
        the sum of frames aligned in SerialEM can be reoriented correctly.</li>
      <li>If the camera can save
        more than 7 frames, add the general property &#39;MaxFalconFrames&#39; with the maximum
        number that it can save.&nbsp;</li>
      <li>If the frame rate is 17 FPS instead of 17.9 FPS,
        add the general property &#39;FalconReadoutInterval 0.058824&#39;.</li>
      <li>If the system has a version of FalconConfig.xml that SerialEM assumes it can
        modify to enable frame-saving, you will see no line in the Camera Setup dialog
        about frame-saving being ON or OFF in the Thermo/FEI intermediate frame dialog, and
        frame-saving controls will all be enabled.&nbsp; Test this by having the
        frame-saving turned off in the Thermo/FEI dialog and taking an image with frame-saving
        through SerialEM.&nbsp; If it fails to work, add the general property
        &#39;SetModeInFalconConfig 0&#39;.</li>
      <li>Alternatively, if SerialEM thinks that modifying FalconConfig.xml will not
        work, there will be a line in the Camera Setup dialog saying whether
        frame-saving is enabled in the Thermo/FEI dialog.&nbsp; To test whether in fact it does
        work, turn off frame-saving in the Thermo/FEI dialog, close that dialog, then edit
        FalconConfig.xml to change &#39;Mode_4&#39; to &#39;Mode_8&#39;. Try to take an image with
        frame-saving in SerialEM.&nbsp; If it works, add the general property
        &#39;SetModeInFalconConfig 1&#39;.</li>
    </ul>
      <p>
        <a name="Falcon2NewDetails"><i><b>For a Falcon 2 camera under the new advanced scripting interface: </b></i></a>
    </p>
    <ul>
      <li>If the frame rate is 17 FPS instead of 17.9 FPS,
        add the general property &#39;FalconReadoutInterval 0.058824&#39;.</li>
      <li>If you select to do frame alignment in SerialEM and the aligned sum is not
        oriented the same as unaligned camera images, add the camera property
        &#39;RotationAndFlip&#39; with a value indicating the operation that needs to be applied
        to the aligned sum to make it match (e.g., 1 or
        3 for 90 degrees counterclockwise or clockwise).&nbsp; </li>
      <li>If SerialEM is not running on the microscope computer, it will not be able to
        create command files for aligning frames with IMOD unless it has direct access
        to the microscope computer file system.&nbsp; To enable this option, add the
        general property &#39;LocalFalconFramePath&#39; with the path to the top directory in
        which Falcon frames are stored by the Thermo/FEI software, as seen from the SerialEM
        computer.</li>
    </ul>
    <p>
      <i><a name="Falcon3Details"><b>For a Falcon 3 or 4 camera with the advanced scripting
      interface:</b></a></i></p>
    <ul>
      <li>For a <em>Falcon 3</em>, if the frame rate is not 40 FPS,
        add the general property &#39;FalconReadoutInterval&#39; with the inverse of the
        frame rate.&nbsp; The default readout interval for <em>Falcon 4</em> is 0.004021
        and should be correct, but can be adjusted with this property also.</li>
      <li>The options to do frame alignment in SerialEM or create command files for
        aligning frames with IMOD will not be available unless SerialEM has direct
        access to the storage server file system.&nbsp; To enable this option, add the
        general property &#39;LocalFalconFramePath&#39; with the path to the top directory in
        which Falcon frames are stored, as seen from the SerialEM computer (which might
        be the storage server).&nbsp; Do not include the subdirectory of that in which you
         might want to save frames.&nbsp; For <em>Falcon 4</em>, the property
        &#39;FalconReferenceDir&#39; must also be added with the path to the directory on the
        storage server to which EER gain references are copied, as seen from the
        SerialEM computer.&nbsp; This should be under &#39;OffloadData\ImagesForProcessing&#39;.</li>
      <li>For a <em>Falcon 3</em>, it may be possible with newer Thermo/FEI server versions to
        save to subdirectory trees under the storage server location, not just to a
        single level of subdirectory.&nbsp; Set the general property
        &#39;SubdirsOkInFalcon3Save&#39; to 1 to experiment with whether this works.</li>
      <li>If you select to do frame alignment in SerialEM and the aligned sum is not
        oriented the same as unaligned camera images, add the camera property
        &#39;RotationAndFlip&#39; with a value indicating the operation that needs to be applied
        to the aligned sum to make it match (e.g., 1 or
        3 for 90 degrees counterclockwise or clockwise).&nbsp; Check the need for this
        reorientation by aligning frames and comparing to an image with no frames 
        acquired.&nbsp;&nbsp; For a <em>Falcon 4</em>, only frames saved in EER files 
        need to be reoriented, so check aligning either with saving to an EER file or 
        with no saving of frames (in which case it saves to a temporary EER file).</li>
      <li>The camera property &#39;<a href="about_properties.htm#scalepower">Falcon3ScalingPower</a>&#39; can be set to control the scaling of
        images from the camera.&nbsp; It specifies the power of 2 to divide by, where
        positive or negative values set a power for dividing linear or counting mode counts,
        respectively, and scaling by floating point arithmetic is applied to the other
        mode to make its counts match for a given exposure.&nbsp; (See&nbsp; '<a href="about_properties.htm#scalepower">Falcon3ScalingPower</a>'
        for details).&nbsp; The two ways to scale were implemented in case it was
        significantly faster to divide by a power of 2 than to scale by a floating point
        value, but the difference in timing is minor.&nbsp; The default is 4, which will
        divide linear mode counts by 16 and make the counts per electron be ~40-50.&nbsp;
        You may find a different scaling preferable (e.g., if linear mode images
        saturate too easily).</li>
      <li>Making the counts match between counting and linear modes requires an accurate
        setting for the camera property 'LinearToCountingRatio'; procedures for setting
        this and the counts per electron later are described in
        <a href="#setup_camera_gain">Measuring Camera Gain</a>.</li>
      <li><em>Falcon 4</em> needs an additional property, 'FalconEventScaling', to make 
        counting mode images produced by aligning EER frames match the counts in other 
        counting mode images; this is estimated as described in
        <a href="#setup_camera_gain">Measuring Camera Gain</a>.</li>
      <li><a name="falcon4timing"><em>Adjusting timing for Falcon 4 camera:</em></a> 
        When saving frames from a Falcon 4, the routine that takes the exposure may have 
        to adjust the exposure time to get the expected number of camera readouts, which 
        is worth avoiding because it takes time and also results in slightly incorrect 
        exposure time and dose values in the mdoc file.&nbsp; There are 
        two parameters involved for getting the number of frames right when saving as 
        EER: 'AddToEERExposure' and 'ReadoutInterval'.&nbsp; To assess these parameters, activate debugging
        output either by setting DebugOutput to 'E' (when running directly on the scope computer) or 
        setting the environment variable FEISEMSERVER_DEBUG to 1 on the scope computer (when using 
        FEI-SEMserver).&nbsp; Be sure to remove or rename the environment variable when 
        you are done. </li>
      <UL>
        <li>First assess 'AddToEERExposure' by setting an exposure time of 0.06 sec and 
          saving frames as EER.&nbsp; Look for debugging output like <br />
          'Expected frames: 18  calculated #: 18'<br />
          Use a one-line script<br />
          SetCameraProperty 0 AddToEERExposure 0.01<br />
          to set the amount to add, take an exposure, and see if the numbers match in that output.

          Vary the value in steps of 0.005 and find the lowest value (going below 0 as 
          needed) and the highest value that give matching numbers.&nbsp; Set the property 
          to the midpoint of this range.</li>
        <li>To assess the 'ReadoutInterval', take a 30 second exposure and save frames as 
          MRC (e.g., 15 2-second summed frames).&nbsp; Look for the debugging output<br />
           'Changed exposure to xx.xx to get N instead of M frames'.<br />
           If this appears, multiply the existing readout interval by N / M and put this 
          number in a ReadoutInterval line in the camera's property section.&nbsp; To determine the existing value if there
          is no entry in the property file for this property or the general property 'FalconReadoutInterval',
          see the property help on 'FalconReadoutInterval' for the defaults, or 
          run the script command 'ReportCameraProperty 0 ReadoutInterval' or 'ReportProperty FalconReadoutInterval'.
        </li>
        <li>Restart the program, take a new exposure, and see if it still changes the 
          exposure to get the requested frames.&nbsp; It may be necessary to iterate this 
          process to settle on a readout interval that avoids the change.</li>
        </ul>
      
       <li>There are two things that can speed up frame alignment in SerialEM: most
        importantly, not reading the frames across a 1 gigabit network connection;
        secondly, using the GPU of an NVIDIA card for alignment.&nbsp; The simplest step
        is to run SerialEM on the storage server, but it may not be possible to install
        an NVIDIA card in that machine.&nbsp; The logical alternative, adding a 10G
        network interface and/or substituting an NVIDIA graphics card on the microscope
        PC, requires substantial modification that may not be acceptable to Thermo/FEI.&nbsp; A
        third solution would be to install SerialEM on a third computer with a 10G
        connection to the storage server and an NVIDIA card.</li>

    </ul>
    <p>
      <i><b>For a Falcon 3 camera with the standard scripting interface:</b></i> You will be
      able to take images in linear mode only, with no possibility of frame saving or
      alignment.&nbsp; SerialEM will scale images by their exposure times and adjust
      this scaling so that binning is done by averaging.&nbsp; The scaling can be
      adjusted by factors of 2 with the property &#39;<a href="about_properties.htm#scalepower">Falcon3ScalingPower</a>&#39;.&nbsp;
      The property &#39;RelativeGainFactors 1 0.25 0.0625&#39; is needed.</p>
      <p>
 <a name="Ceta2Details"><i><b>For a Ceta 2 camera (Ceta with speed enhancement option):</b></i></a></p>
      <p>You can save and/or align frames from a Ceta camera with the speed enhancement 
        option if you have microscope server version 7.8 or higher with Advanced Scripting 
        installed.&nbsp; These property settings are relevant:</p>
      <ul>
        <li>Camera property &#39;CanTakeFrames 1&#39; is required.</li>
        <li>General property &#39;LocalFalconFramePath&#39; or camera property 
          &#39;FalconLocalFramePath&#39; is needed if you want to align frames either in SerialEM 
          or in IMOD (by saving a command file for alignment).&nbsp; The property should 
          have the path to the location on the storage server where frames are 
          saved, as seen from the computer running SerialEM.&nbsp; The camera property is 
          preferable in general, or required if there is also a Falcon 3 or 4.&nbsp; The 
          path on the storage server is generally
          C:\OffloadData\TemScripting\BM-Ceta, so this property would be Z:\TemScripting\BM-Ceta if 
          C:\OffloadData is mounted as Z: on the SerialEM computer.</li>
        <li>General property 'AdvancedScriptingVersion 4' (or higher if appropriate) is 
          required to identify the Advanced Scripting version unless there is a Selectris 
          filter.</li>
      </ul>
         <p>
      <a name="FalconGPU"><i><b>To use a GPU for aligning frames in SerialEM with any of these Falcon
      configurations or the Ceta 2:</b></i></a></p>
    <ul>
      <li>The GPU currently works only with 64-bit SerialEM but could be available for
        32-bit SerialEM if there is enough need.</li>
      <li>You need to have a CUDA-capable NVIDIA card and appropriate NVIDIA drivers
        installed.&nbsp; Even modest cards should be somewhat effective, but more a powerful
        card will align faster up to a point.</li>
      <li>Follow the instructions in <a href="#using_gpu">Setting Up to Use a GPU for
        Frame Alignment</a>.</li>
      <li>If the property DebugOutput is set to 1, there will be a message on program
        startup about whether this GPU is available.&nbsp; If it is not, set DebugOutput
        to E for diagnostic output.</li>
    </ul>
      <p>
        <a name="JeolCamera"><i><b>For accessing a JEOL camera or STEM signals</b></i></a>,
        copy the file JeolCamPlugin.dll from the package directory to the main SerialEM
        directory.&nbsp; (The file could be placed in a 'Plugins' folder inside
        C:\Program Files\SerialEM instead, but this is no longer necessary and could
        fail on some computers.&nbsp; If there is already a copy of this file there,
        remove it.)&nbsp; If SerialEM is running on the JEOL PC, this is all that is
        needed, in addition to an appropriate set of camera properties.&nbsp; In this situation,
        the first time that you start SerialEM on Windows 7 or above, you need to run it as
        Administrator to guarantee that various JEOL DLLs can be copied to the SerialEM directory.
        <br />
        If
        SerialEM is running on a separate PC, it can still access these cameras by
        connecting to a server running on the JEOL PC.&nbsp; Copy either
        JEOL-SEMCamServer32.exe or JEOL-SEMCamServer64.exe to the JEOL PC, depending on
        whether it is running 32-bit or 64-bit JEOL software.&nbsp; Put it in some
        logical place (C:\Program Files\SerialEM could be created just for this purpose)
        and make a shortcut to it on the desktop so that it can be run easily.&nbsp; By
        default, this connection uses port 48896, although a different port can be used
        by defining the environment variable JEOL_SEM_SERVER_PORT with the port number
        on the JEOL PC. You also need to add the properties (with the appropriate port
        number)<br />
&nbsp;&nbsp;&nbsp; SocketServerIP 4 ip_address_of_JEOL_PC<br />
&nbsp;&nbsp;&nbsp; SocketServerPort 4 48896</p><br />
      On Windows 7 or above, the first time that you start this server, you need to run it
      as Administrator to guarantee that various JEOL DLLs can be copied to the folder where
      the server is located.
       <p>
        <a name="RemoteTietz"><i><b>For accessing a Tietz camera remotely</b></i></a>,
        copy the file Tietz-SEMServer.exe to the Tietz camera computer.&nbsp; Put it in
         some logical place and make a shortcut to it on the desktop so that it can be
         run easily. By default, this connection uses port 48897, although a different
         port can be used by defining the environment variable TIETZ_SEM_SERVER_PORT with
         the port number on the Tietz PC. You also need to add the properties (with the
         appropriate port number)<br />
&nbsp;&nbsp;&nbsp; SocketServerIP 5 ip_address_of_Tietz_PC<br />
&nbsp;&nbsp;&nbsp; SocketServerPort 5 48897</p>
        <P>After you have checked out these settings, you are finally ready to run
        SerialEM and try taking some pictures. Experiment with the different camera
        parameter sets, varying the binning, the area being acquired, and the shuttering
        selection if appropriate. You may have to take a gain reference in SerialEM
        before you can get a gain normalized image. If you run into problems, try taking
        unprocessed and/or dark subtracted images as well as varying the binning and
        image area to see under which conditions the problem occurs.</P>
<P>&nbsp;</P>
    <P><a name="badSizes"><b>Bad dialog sizes or bad program and font sizes</b></a></P>
    <p>As of SerialEM 3.8, the program fully supports scaling for the DPI of the
      monitor, and it should work properly without any property settings related to
      DPI.&nbsp; When you start SerialEM, you may discover that the control
      panels on the left are not all the same width, and that some text appears
      truncated in the control panels or dialogs.&nbsp; This happens when there is a
      mismatch between the actual DPI setting of the display and what the program
      thinks it is.&nbsp; You may also find the the whole program window and its fonts
      are too large or too small.&nbsp; If there is a sizing
      problem, check the properties file for the entry &#39;DisplayIsNot120DPI&#39; and try
      removing it if it is there; the property
      &#39;AssumeDPI&#39; can also be used to scale the program for a different DPI
      than the one that the system reports.&nbsp; See the description of these two
      properties in <a href="about_properties.htm#general_properties">Property File -
      General Properties</a>.&nbsp; Set the property &#39;DebugOutput&#39; to 1 to get a
      report on the detected DPI during program startup.&nbsp; </P>
    <P>&nbsp;</P>
    <P><A name="setup_hitachi"></A><B>Initial Actions and Other Special Features for Hitachi HT7700/HT7800
      (Priority 1)</B></P>
    <P>The Hitachi HT7700 has some design features that require special calibrations
      and particular care when first setting up SerialEM for it.&nbsp; A number of
      deflector setttings are remembered when you leave a particular state and
      reimposed when you return to it.&nbsp; This is a good thing if it maintains an
      alignment of some kind, such as to keep images aligned when changing
      magnification.&nbsp; However, it becomes a problem if the same deflector is used
      by SerialEM to control a feature like image shift.&nbsp; In such a case, it is
      necessary to record the values that the scope wants to reimpose, so that it is
      possible to make an appropriate change after the scope has reset the parameter.</P>
    <ol>
      <li>&nbsp;With SerialEM not running, check the alignment of the mags in LM mode
        and HR mode following the procedure described in full detail in
        <a href="menu_calibration.htm#hid_calibration_neutralisvalues">Neutral IS Values</a>.&nbsp;
        In brief, step through LM mode and make sure that the mags are fairly well
        aligned, adjusting the IA deflector as needed.&nbsp; Either IA or PA can be
        designated as the image shift deflector to be used by SerialEM.&nbsp; Step
        through HR mode and either adjust the deflector in question, if it is the one
        being used to align the mags, or make sure it is zero if the other deflector is
        being used for alignment.</li>
      <li>Return to HC mode before starting SerialEM.&nbsp; Run the
        <a href="menu_calibration.htm#hid_calibration_neutralisvalues">Neutral IS Values</a>
        calibration to record the deflector settings in LM and HR modes.</li>
      <li>Run the <a href="menu_calibration.htm#hid_focusautofocus_basefocusvalues">Base Focus
            Values</a> calibration to record the objective lens values that the scope
        imposes for each mag.&nbsp; Once this is run, the Defocus readout in SerialEM
        should not change with mag.</li>
    </ol>
    <p>
      Another consequence of the microscope&#39;s behavior is that operations using image
      shift in LM and HR modes will leave the mags misaligned after SerialEM exits,
      because SerialEM does not clear out the image shift before leaving a mag.&nbsp;
      If this is a problem, users can be told to run the       <a href="menu_calibration.htm#hid_calibration_restoreneutralis">Restore
          Neutral IS</a> routine before leaving SerialEM; this will put the deflectors
      back to their stored values.</p>
    <p>
      <b><i>Calibrating beam shift between spots.</i></b>&nbsp; When changing to a
      spot size, the microscope reimposes the last beam shift seen at that spot size.
      This interferes with SerialEM&#39;s shifting of the beam for various reasons.&nbsp;
      Thus it is necessary to calibrate the actual beam shifts needed to align the
      spots, which allows SerialEM to maintain a desired beam shift when changing
      spots.&nbsp; This should be done with
      <a href="menu_calibration.htm#hid_beamspot_spotbeamshifts">Spot Beam
            Shifts</a>&nbsp;in the &#39;Calibration-Beam &amp; Spot&#39; menu before aligning spot
      intensities.</p>
    <p>
      <i><b>Image shift, pixel sizes, relative rotations, and shift boundaries.</b></i>&nbsp;
      The effect of the image shift deflectors is nearly constant over some mag ranges
      in HC mode, but varies progressively at lower mags and has at least one jump in
      higher mags.&nbsp; Similarly, the effect of the IA deflectors in LM is nearly
      constant until the lowest mags.&nbsp; This makes the behavior unlike a Thermo/FEI
      scope, where image shift is invariant at the specimen, and much like a JEOL for
      those mag ranges.&nbsp; In consequence, the full calibration of image shift,
      pixel size, and relative rotations at all relevant mags is advised for the most
      reliable performance, although in principle the image shift calibration could be
      relied on for pixel size and rotation information in the portions of mag ranges
      where image shift is nearly invariant.&nbsp; Once calibrations are done for HC
      and LM modes and inserted into properties, the
      <a href="menu_calibration.htm#hid_calibration_listisvectors">List IS Vectors</a>
      command should be run to identify image shift boundaries, which should be
      specified in the OtherShiftBoundaries property.</p>
    <p>
      <b><i>HR mode</i></b>.&nbsp; Image shift in HR mode can be done with either the IA or
      PA deflectors, boh of which provide projector-like image shift, but neither
      provides the invariant image shift on the camera seen with projector shift on a
      JEOL.&nbsp; The program automatically identifies every mag in HR as an image
      shift boundary.&nbsp; It should be possible to do the usual spatial calibrations
      in HR mode, but there may be some other problems.&nbsp; It is not known whether
      beam crossover is consistently different in HR mode and would need to be stored
      separately.&nbsp; It is also possible that, even with a difference in crossover
      taken into account, beam intensity calibrations would need to be stored
      separately for HR mode.</p>
    <p>
      <i><b>Stage calibrations with waffle grating</b></i>.&nbsp; The stage on the
      HT7700 appears to have rather long-range backlash effects, so the default
      backlash correction for stage montages and calibrations is set rather high.&nbsp;
      However, cyclical variation in stage movement appears not to occur, and thus it
      is safe to do stage calibrations over an extent of only 40 microns.&nbsp; This
      means that the waffle grating can be used, provided that one starts in the very
      middle of a grid square.&nbsp;&nbsp; Such an extent is now the default for
      non-Thermo/FEI scopes.</p>
    <p>
      &nbsp;</p>
      <P><A name="setup_magtable"></A><B>Checking the Magnification Table and
        Calibrating Neutral IS Values (Priority 2 on
        Thermo/FEI scope, Priority 1 on JEOL)</B></P>
      <P>You should start with a properties file that has a magnification table but does
        not have any 'RotationAndPixel' lines in it.&nbsp; The procedure is to start SerialEM and run the 'List
        Mags' command from the 'Calibration' menu. Compare this listing with the
        magnification table in the properties file. If it matches, you are ready to go
        on. If not, you need to cut and paste the output of 'List Mags' into the
        properties file. On a Thermo/FEI scope, step through the mags with the screen down and
        type in the mag that the microscope user interface shows. On a JEOL, the third field
        can be left blank or filled with 0's.</P>
      <P>On a Thermo/FEI scope, now that you know the relation between mag index and mag, find
        out which is the lowest mag in M mode and verify that LowestMModeMagIndex is
        correct. On the JEOL, the routine will provide this value.</P>
      <P>On the JEOL, following this magnification table will be a table of camera
        lengths for using diffraction mode. This table should be inserted in the
        properties file if it is not already there. The first line added to the
        properties file should be 'CameraLengthTable nn', where 'nn' is the number of
        lines of camera lengths that follow.</P>
      <P>If you have a post-column energy filter, repeat these steps with EFTEM mode on.</P>
    <P>For a JEOL, it is very important to calibrate the neutral values of image or
      projector shift (whichever is being used in your setup), so that the program can
      maintain the actual image shift correctly between magnifications.&nbsp; Simply
      run
        <a href="menu_calibration.htm#hid_calibration_neutralisvalues">Neutral IS Values</a>
      in the Calibration menu.&nbsp; This calibration needs to be redone whenever there
      is a service alignment of the magnifications.</P>
    <P>&nbsp;</P>
      <P><A name="setup_gain_factors"></A><B>Measuring Relative Gain Factors for Thermo/FEI, Tietz CMOS, and other Cameras (Priority 1)</B></P>
      <P>The gain of some cameras varies with binning, and it is necessary to have a
        property indicating the change in gain in order for dose calculations and
        intensity-related operations to work properly, including the acquisition of a
        gain reference.&nbsp;&nbsp; For some newer cameras, the factors are predicable;
        for others, like the Thermo/FEI Eagle camera, OneView, Rio, and perhaps some EMSIS
        cameras, the factors must be assessed. To do this, set the 'Trial' parameters for a full-field image at the maximum binning.&nbsp;
        Use a dark-subtracted image if normalizing in SerialEM and there is no gain
        reference yet.&nbsp; Set the exposure time to 0.2
        second and adjust the beam intensity so that 'Trial' gives an image with counts
        between 1/2 and 3/4 of the saturation level. Take an image and use 'Ctrl-I' to get
        the mean counts in the image. Repeat at each binning down to 1, without changing
        the exposure time.</P>
      <P>For each binning 'n', compute the gain factor as
      </P>
      <P>(counts at binning n) / ((counts at binning 1) * n * n).
      </P>
      <P>Add a single line to the CameraProperties section of the properties file,
      </P>
      <P>RelativeGainFactors 1.0 f2 f4 f8</P>
      <P>Where f2, f4, and f8 would be the factors measured for binnings 2, 4, and 8.&nbsp;
        For the Eagle, these factors should be about 0.35, 0.16, and 0.13.&nbsp; </P>
    <P>Relative gain factors are also needed for the Tietz CMOS cameras: F816, F416, F216,
      and XF416 with their default setup, but here the factors are known and
      there should be no need to measure them.&nbsp; Simply take an image with binning
      4, then with binning 2 and 1 with the same exposure time.&nbsp; With the default
      setup, the images should have the same counts, and the camera properties would
      need the line</P>
    <P>RelativeGainFactors 1 0.25 0.0625</P>
    <P>It is possible to set the configuration for DE cameras to bin by averaging
      instead of summation, in which case the gain factors are needed there as well.&nbsp;
      If there are binnings of 1, 2, and 4, the line just above will work; if there is
      a binning 8, the line needs 0.015625 at the end.</P>
    <P>The Falcon 3 and Ceta 2 cameras also have relative gain factors to keep the
      number of counts constant with binning; the line above will work for Falcon 3,
      and for Ceta2 it needs 0.015625 at the end.&nbsp; With the new Thermo/FEI camera
      scripting interface, the same behavior can be imposed for Falcon 2 and Ceta 1
      camera by adding the camera property &#39;AutoGainFactors 1&#39;.</P>
    <P>Gain factors may also be needed for a Gatan OneView or Rio camera, so the relative
      gains should be measured as described above.&nbsp; Be sure to turn off &#39;Correct
      drift&#39; in the Camera Setup dialog before taking images without alignable
      features, since intensities will be wrong if some frames cannot be aligned.&nbsp; If a factor is not 1, it will be
      exactly the inverse of a power of 2.&nbsp; On some OneView cameras these factors
      have been &#39;1 0.25 0.125 0.0625&#39;;
      on others, no factors were needed.</P>
    <P>&nbsp;</P>
      <P><A name="setup_timing"></A><B>Tuning Timing of Gatan Camera with Two Shutters
        (Priority 1)</B></P>
      <P>Camera timing settings are important for proper function of SerialEM's 'Dual
        shuttering - minimum exposure' option, which is needed to minimize specimen
        exposure using the standard shutter and to provide a flexible range of drift
        settling times with older Gatan CCD cameras. Measuring them involves two steps: using a DigitalMicrograph
        script to estimate the BuiltInSettling, or clear time of the CCD chip; and using
        a procedure within SerialEM to determine the average delay for an exposure to
        start after SerialEM issues a request for one, and the variability in this
        delay.</P>
      <P>If the camera controls only one shutter, skip the DigitalMicrograph script and
        just follow the procedure described in the next section. It is not so important
        but it will to provide a check on the timing for performing tasks after an
        exposure.</P>
      <P>To estimate BuiltInSettling for a CCD camera, open the 'cleartime.s' script
        available from the Tools folder on the SerialEM download site. You can do this with the File - Open menu entry in DM, or just by
        clicking on the file. Run the script by pressing Ctrl-Enter. It will time a
        series of exposures and report the mean time. It will then recommend values for
        BuiltInSettling based on subtracting 0.155 second for large format one-port
        readout cameras (Megascan 795 and Ultrascan 890, 2Kx2K 30-micron pixel or 4Kx4K
        15-micron pixel) or 0.065 second for the four-port readout Ultrascan 895. These
        correction factors are based on the 4 cameras that I have been able to run the
        script with.&nbsp; The script is of no use with CMOS cameras like the K2/K3 and
        OneView.</P>
      <P>If you have more than one camera, change the 'cameraNumber' value at the top of
        the script and rerun it.</P>
      <P>Once you have entered a correct value for BuiltInSettling in the properties
        file, restart SerialEM. Change the 'Trial' camera parameters so that the
        exposure time is 0.4 seconds and set the binning to get a 1024x1024 pixel image.
        Take a 'Trial' picture without a specimen and adjust the beam to give an image
        with moderately high counts (between 1/3 and 3/4 of camera saturation). Then
        select <A href="menu_calibration.htm#hid_calibration_cameratiming">Camera Timing</A>
        in the Calibration menu and accept the default entries. This routine will take
        100 exposures with timing parameters that will allow it to estimate the delay
        time for the exposure to start from the image intensity. It will recommend
        values for StartupDelay, MinimumDriftSettling, and ExtraBeamTime, and it may
        also recommend a change in BuiltInSettling to keep StartupDelay from being
        negative. Insert these in the properties file entries for the particular camera.
        There will probably also be a recommended value for MinimumBlankingTime which
        you should insert along with other general camera-related properties near the
        top of the properties file. If you have more than one camera, repeat the
        procedure with the other camera.</P>
      <P>You should rerun the camera timing procedure and adjust your properties entries
        if there is a computer upgrade, a major software upgrade, or the addition of an
        energy filter. The timing may also depend on whether images are gain-normalized in DM or
        in SerialEM, so rerun the procedure if you change the GainNormalizeInSerialEM
        property.</P>
    <P>&nbsp;</P>
      <P><A name="setup_tietz_timing"></A><B>Measuring Camera Timing for Non-Gatan
        Camera or Gatan Camera with One Shutter (Priority 2)</B></P>
      <P>Calibration of the timing of other kinds of cameras, or a Gatan camera with only one
        shutter, is needed for two reasons: 1) in general, an approximately correct 
        value of stratup delay is needed for delays after image shift and other 
        drift-producing actions to be imposed correctly; 2) for some cameras, it will allow the program to takes actions (e.g., tilt and
        image shift) during image readout or frame-saving. For Thermo/FEI or
        DE cameras, these actions are not allowed because the timing is inherently more
        unpredictable. Change the 'Trial' camera parameters so that the exposure time is
        0.4 seconds and set the binning to get a 1024x1024 pixel image. Take a 'Trial'
        picture without a specimen and adjust the beam to give an image with moderately
        high counts (between 1/3 and 3/4 of camera saturation), except on a K2 or K3.&nbsp;
        The timing routine will use super-resolution mode for a K2, and does not need very
        high counts. Then select <A href="menu_calibration.htm#hid_calibration_cameratiming">
          Camera Timing</A> in the Calibration menu and accept the default entries. This
        routine will take 100 exposures with timing parameters that will allow it to
        estimate the delay time for the exposure to start from the image intensity. It
        will recommend values for StartupDelay and ExtraBeamTime. Insert these in the
        properties file. If the procedure measures a delay successfully, then you can
        set DefaultActAfterExposures to 1.&nbsp; For a K2, you will probably see output
        that suggests just using the default minimum startup delay.&nbsp; See <A href="menu_calibration.htm#hid_calibration_cameratiming">
          Camera Timing</A> for details on this and on the signs that the startup delay
        is too short.</P>
    <P>&nbsp;</P>
      <P><A name="setup_tietz_binning"></A><B>Setting Tietz and Eagle Camera Binning
        Offsets (Priority 1 for Eagle and some Tietz)</B></P>
      <P>Some Tietz F224 cameras have had a problem with gain-normalization of binned
        images, although F415 cameras have not shown this problem. The same problem has
        appeared on 4K and 2K Eagle cameras. Although the problem can be solved by making
        separate gain references for the different binnings, a more convenient solution
        (for the user) is to use 'BinningOffset' entries in the camera properties
        section. Here is a procedure that uses cross-correlation and does not require a
        trained eye to see the offsets:</P>
      <OL>
        <LI>
          Set camera parameters and the beam to take a dark-subtracted, unbinned 2Kx2K
          image of a blank field with a medium number of counts. For a 4K camera, take a
          center half image. For a 1K camera, take a full image and divide the sizes below
          by 2.
        <LI>
          Take the unbinned image and save it as unbin.st; close the file.
        <LI>
          Change to binning 2, reduce the exposure time appropriately, take an image, and
          save to bin2.st.
        <LI>
          Repeat this procedure for each binning, taking the same area of the camera and
          saving to a separate file.
        <LI>
          On an IMOD-capable machine, run:<BR>
          newstack -siz 2048,2048 -exp 2 bin2.st bin2x2.st<BR>
          newstack -siz 2048,2048 -exp M binM.st binMxM.st (for each higher binning M)<BR>
          newstack -siz 1024,1024 -exp 2 bin4.st bin4x2.st<BR>
          newstack -siz 1024,1024 -exp M/2 binM.st binMxM/2.st (for each higher even binning
          M, where M/2 is a single digit, m divided by 2)         <LI>
          You can now correlate each fully expanded binned image against the unbinned
          image with:<BR>
          clip corr -2d unbin.st bin2x2.st corr.tmp<BR>
          clip corr -2d unbin.st binmxm.st corr.tmp (for each higher binning m)
        <LI>
          Each correlation will end with a line like: 'Maximum at ( -0.00, 0.99),
          transformation ( 0.00, -0.99)'. The binning offsets are the values of the
          maximum coordinate, rounded to integers. For example, if this result was
          obtained for binning 4, you would need an entry 'BinningOffset 4 1 0 1' in the
          Properties file. The '4' refers to the binning of the image, the first '1'
          refers to the binning of the gain reference, and the next two numbers are the
          offsets in X and Y.&nbsp; However, for a 2K Eagle camera, it is possible to end
          up with an offset that is not close to an integer because the unbinned image is
          actually binned by 2 on the chip; for all comparisons with the Eagle 2K, follow
          the instructions in points 9 and 10 instead.<LI>
          At least one Eagle camera has been seen where two halves of the image had
          different alignment between different binnings; e.g., the top shifted up and the
          bottom shifted down between binning 1 and 2.&nbsp; Thus, even when the
          correlation gives an integer offset, you should look at the pair of images that
          you correlated in 3dmod (e.g., &#39;3dmod unbin.st bin2x2.st&#39;).&nbsp; Zoom up to at
          least 1 so that you will see subpixel shifts and toggle between the images to
          make sure they line up the same in all four quadrants.&nbsp; You could instead
          open them in midas (e.g., &#39;midas -r unbin.st bin2x2.st&#39;), use Ctrl-middle mouse
          button to set the center for correlation, and use &#39;Cross-Correlate&#39; to measure
          the shift in each quadrant.<LI>
          You can now correlate each higher even binning against the binned by 2 image:<BR>
          clip corr -2d bin2.st bin4x2.st corr.tmp<br />
          clip corr -2d bin2.st binMxM/2.st corr.tmp (for each higher even binning M)
        <LI>
          Again, the offsets are the values of the maximum coordinate, but only if they
          are close to integer values. If they are, then you would add an entry like
          'BinningOffset 4 2 0 1', where again the first number is the binning of the
          image and the second is the binning of the gain reference.&nbsp; Again, for an
          Eagle camera, make sure the offsets are uniform by opening in 3dmod or
          correlating in midas.<LI>
          If an offset is close to halfway between two integers, then it is not
          possible to synthesize a good gain reference for the given binning from a binned
          by 2 reference. In this case, you need an entry like 'BinningOffset 4 2 999 0'.
          The '999' tells the program not to make a reference for binning 4 from the
          binned by 2 reference.</LI></OL>
      <p>Binning offsets are also needed for Gatan 4-port readout cameras but these
        offsets are predictable and the program will set them up automatically.
    <P>&nbsp;</P>
      <P><A name="setup_standard_focus"></A><B>Assessing Standard Focus for Low Mag Mode
        (Priority 2)</B></P>
      <P>This assessment should be done before the low magnification image shift and
        pixel size calibrations needed to use the Navigator. The ill-defined nature of
        focus in Low Mag mode means that it would be easy for a user to set a focus that
        creates two problems: 1) image scale might be significantly different from the
        scale at the focus at which calibrations were done; 2) the image position might
        depend on beam position to an extent that makes localization of positions
        problematic when using the Navigator. The solution is to use a standard focus
        for the calibrations and for mapping in Low Mag mode. This standard focus should
        be one that minimizes beam-position dependent image movements. The procedure is
        this:</P>
      <OL>
        <LI>
          With a specimen in place, go to a mag near the top of the Low Mag range and set
          the focus to Eucentric focus (on a Thermo/FEI scope) or to the standard focus (on the
          JEOL).
        <LI>
          Move the beam and watch how much the image moves. Change the focus until you see
          substantial image movement; vary the focus until you can tell whether the
          standard focus is near the point where image movement is minimized. If so, on
          a Thermo/FEI scope, you are done; on the JEOL, return to standard focus and skip to step
          4.
        <LI>
          If image movement seems excessive at the standard/eucentric focus, adjust the
          focus to minimize the beam-dependent image movement.
        <LI>
          Select<A href="menu_calibration.htm#hid_calibration_standardlmfocus"> Standard Focus</A>
          in the Calibration menu to record this focus as the standard one for this
          magnification. It will be used at all low magnifications if it is the only such
          calibration.
        <LI>
          If different focus levels are needed at different magnifications, repeat this
          procedure at multiple magnifications. Or, on the JEOL, go to the standard focus
          at the various magnifications and record the calibration.</LI>
    </OL>
      <p>
        &nbsp;</p>
     <P><A name="setup_focuscal"></A><B>Focus Calibration (Priority 1)</B></P>
      <P>In principle, focus only needs to be calibrated at one magnification as long as there are
        image shift and/or other calibrations available to transfer the focus calibration accurately
        to other mags. Typically, this calibration should be at a mag in the range where
        data will be acquired.&nbsp; However, when using the procedures below for
        calibrating image shift and pixel size, it may also be helpful to have a focus
        calibration at the mag where these calibrations will be started. In addition, to 
        use the&nbsp; <A HREF="menu_tasks.htm#hid_eucentricity_eucentricitybyfocus">Eucentricity by Focus</A> 
        routine over a wide range of conditions,&nbsp;you may need to have an 'extended' 
        focus calibration instead of the regular one at the highest magnification, or an 
        extended calibration at a lower magnification to be used when focusing with the 
        View area in Low Dose mode.&nbsp; See <A href="#z_by_g_setup">Extended Autofocus and Non-reciprocity Calibration 
      for Using Eucentricity by Focus</A> below for details.</P>
      <P>Set up the
        Focus parameter set to give moderately good, quick pictures with a binning of at
        least 2. For a camera where smaller images come out significantly faster, wide quarter and center half are two possibilities; if you have a smaller
        format camera, use a center
        half area. </P>
    <P>Before calibrating focus, you should adjust the beam tilt so that the beam-tilt
      induced image shift is roughly 30 nm when defocused by 10 microns.&nbsp; Here is
      a procedure for this adjustment:</P>
    <ul>
      <li>Go to a magnification where the unbinned pixel size is about 0.5 nm for a CCD
        camera with pixels smaller than 20 microns at 200-300 KV, or 1 nm for all other
        situations (direct detector camera, voltage under 200 KV, or phosphor-based
        camera with pixels of 20-30 microns at 200-300 KV).</li>
      <li>Change focus by 10 microns.</li>

    <li>Run 'Report Shift &amp; Drift' in the Focus
        menu. Note the unbinned pixels of shift in X and Y that it reports.  Compute the
        total shift by the square root of the sum of squares.</li>
        <li>Adjust the beam tilt (in the Focus menu) by the amount that will make the total
        shift be 60&nbsp;unbinned pixels for a CCD camera with pixels smaller than 20
          microns at 200-300 KV, or 30 unbinned pixels for all other situations. (I.e.,
          the new beam tilt would be the current beam tilt times 60 (or 30) divided by
          the current total shift.)</li>
        <li> Restore the defocus to zero.</li>
        </ul>
        <p> Change to your chosen magnification and start the focus calibration procedure
        (see<A href="menu_calibration.htm#hid_calibration_autofocus"> Autofocus</A> for
        more details.) Accept the defaults to calibrate a nice big range of defocus.&nbsp;
          The image shift calibrations will be started at a mag where the field of view is
          about 3 microns.&nbsp; If this mag is far from the one where you calibrated
          focus (say, a factor of 2 or more), calibrate focus there as well.</P>
    <P>&nbsp;</P>
      <P><A name="setup_pixelsize"></A><B>Calibrating Image Shift and Pixel Size
        (Priority 1 and 2)</B></P>
      <P>The procedure described next involves calibrating the image shift at a series
        of magnifications and saving that information in the calibrations file, as well
        as taking a series of images and measuring the magnification and change in image
        rotation directly from them and entering this information into the properties
        file. How much of this you need to do depends largely on the type of microscope
        and on whether you intend to use the Navigator, as detailed in the table below.
        The goal here is to calibrate not just the image shift at each magnification but
        also the relationship between specimen and camera coordinates, specifically the
        pixel size on the specimen and orientation of the specimen axes on the camera.
        The basic principles underlying the calibration requirements are:
      </P>
      <OL>
        <LI>
          If image shift is calibrated at two magnifications and pixel size or axis
          rotation are known at one, the pixel size or rotation can be derived at the
          other, provided that the relationship between image shift and position on the
          specimen is the same at both magnifications.
        <LI>
          Image shift calibrations are intrinsically somewhat more accurate and convenient
          than direct measurements of pixel size and axis rotation as described below,
          although both pixel size and relative rotations can be obtained easily by automatic analysis of the
          cross-line grating.
        <LI>
          It is thus preferable to calibrate image shift thoroughly and derive pixel size
          and rotation where appropriate, rather than the converse.
        </LI>
      </OL>
      <P>The minimal requirement is to measure one pixel size in each magnification
        range where the relationship between image shift and movement on the specimen is
        constant, and to measure an absolute rotation angle somewhere plus the rotation
        of images between those magnification ranges. On Thermo/FEI scopes, there are 
        typically just two
        such ranges, LM mode and regular mag mode. However, some Talos microscopes have 
        show variations in the strength of image shift at the lowest few nonLM 
        magnifications, where additional measurements of pixel size and rotation angle 
        are required&nbsp; It is possible that Glacios would have the same problem.&nbsp; On JEOL and Hitachi scopes, there are
        often multiple ranges together with progressive changes in image shift strength
        within a range. In practice, it is recommended that redundant measurements be
        made, and the procedures have been refined to ease this task.</P>
      <P>________________________________________________________</P>
      <BR>
      <TABLE BORDER cols="3">
        <TR>
          <TD width="100%" colSpan="3" align="center">
            <P>Setup for Work at Regular Mags Only</P>
          </TD>
        <TR vAlign="top">
          <TD width="47%">Thermo/FEI scope</TD>
          <TD width="7%">&nbsp;</TD>
          <TD width="46%">JEOL and Hitachi</TD>
        </TR>
        <TR vAlign="top">
          <TD width="47%">Image shift from lowest nonLM-mode to highest mag needed</TD>
          <TD width="7%">&nbsp;</TD>
          <TD width="46%">Image shift from lowest non LM-mode to highest mag needed</TD>
        </TR>
        <TR vAlign="top">
          <TD width="47%">Minimal requirement: one pixel size, one absolute rotation angle
            in regular mag range if no image shift boundaries</TD>
          <TD width="7%">&nbsp;</TD>
          <TD width="46%">Minimal requirement: one pixel size in each image shift range,
            relative rotation across each boundary, one absolute rotation angle</TD>
        </TR>
        <TR vAlign="top">
          <TD width="47%">Recommended: Pixel size for all mags where data is likely to be
            taken and at image shift boundaries (rotations optional except across image 
            shift boundaries)</TD>
          <TD width="7%">&nbsp;</TD>
          <TD width="46%">Recommended: Pixel size and relative rotations between all mags
            from lowest non LM-mode to highest mag needed</TD>
        </TR>
        <TR vAlign="top">
          <TD width="100%" colSpan="3" align="center"></TD>
        </TR>
        <TR vAlign="top">
          <TD width="100%" colSpan="3" align="center">
            <P>Setup for Navigator Use in LM Mode</P>
          </TD>
        </TR>
        <TR vAlign="top">
          <TD width="47%">Thermo/FEI scope</TD>
          <TD width="7%">&nbsp;</TD>
          <TD width="46%">JEOL and Hitachi</TD>
        </TR>
        <TR vAlign="top">
          <TD width="47%">Check that eucentric focus in LM mode gives minimal image shift
            with beam movement, set a StandardLowMagFocus property if not</TD>
          <TD width="7%">&nbsp;</TD>
          <TD width="46%">Check that standard focus in LM mode gives minimal image shift
            with beam movement, set StandardLowMagFocus property
          </TD>
        </TR>
        <TR vAlign="top">
          <TD width="47%">Image shift for all LM mags down to lowest needed</TD>
          <TD width="7%">&nbsp;</TD>
          <TD width="46%">Image shift for all LM mags down to lowest needed</TD>
        </TR>
        <TR vAlign="top">
          <TD width="47%">Pixel size at highest LM mag</TD>
          <TD width="7%">&nbsp;</TD>
          <TD width="46%">Pixel size for all LM mags down to lowest needed</TD>
        </TR>
        <TR vAlign="top">
          <TD width="47%">Relative rotation from highest LM to lowest nonLM mag</TD>
          <TD width="7%">&nbsp;</TD>
          <TD width="46%">Relative rotations between all mags, from lowest LM needed to
            lowest non LM mag</TD>
        </TR>
        <TR vAlign="top">
          <TD width="47%">Stage calibration: lowest nonLM-mode mag, 2 or 3 mags in LM
          </TD>
          <TD width="7%">&nbsp;</TD>
          <TD width="46%">Stage calibration: lowest good non LM-mode mag, 2 or 3 mags in LM</TD>
        </TR>
        <TR vAlign="top">
          <TD width="47%">Image shift offsets from ~10-20K down to lowest LM mag may be needed</TD>
          <TD width="7%">&nbsp;</TD>
          <TD width="46%">Image shift offsets from ~10-20K down to lowest LM mag may be needed</TD>
        </TR>
      </TABLE>
      <BR>
      <P>
        ----------------------------------------------------------------------------------------</P>
      <P><B><I>Thermo/FEI</I>:</B> For work at regular magnifications, calibrate image shift
        from the lowest nonLM-mode mag up to the highest mag where tilt series might be 
        taken. It is recommended that you calibrate pixel size over the range of 
        magnifications where users would typically expect an accurate pixel size, using 
        the procedures described below, which will also yield relative rotations. For 
        Talos and Glacios, run that procedure down to the lowest nonLM magnification in 
        case image shift is not invariant at the lowest few maginfications.&nbsp; You 
        should definitely enter a calibrated rotation angle for one mag at which tilt 
        series are typically run, or a rotation angle from a stage calibration at a 
        lower nonLM magnification.</P>
      <P>To enable Navigator use, measure the pixel size with the calibration grating at the
        highest LM-mode mag. Switch to a non-periodic specimen suitable for
        lower mag work and calibrate image shift at all LM mags down to the lowest mag
        that might be needed for grid mapping. Do the other steps listed in the table,
        described in other sections.&nbsp; Use the stage calibration to obtain an
        absolute rotation angle in LM. </P>
      <P><B><I>JEOL:</I></B> Image shift shows discontinuities at a number of lower mags
        in the regular mag range and is not as constant as one might wish even within
        the ranges. Thus, it is necessary to calibrate image shift as well as measure
        pixel size and rotation between mags up to the highest mag at which tilt series
        might be run. A calibrated rotation angle is also needed for one mag at which
        tilt series are typically run.</P>
      <P>To enable Navigator use, image shift calibrations as well as pixel sizes and
        relative rotations are needed throughout LM mode, down to the lowest mag needed
        for mapping. Before following the procedure below for regular mags, start at the
        lowest LM mode mag needed, go to standard focus, and take and save pictures of
        the calibration grating at each mag. You may be successful at calibrating image
        shift with this grating, but it is more reliable to use a specimen suitable for
        low mag work instead.</P>
      <P>On a JEOL or Hitachi, the beam is not moved along with the image, so SerialEM needs to
        apply beam shift whenever it does an image shift. This will not happen until you
        do a beam shift calibration, which needs to be done after at least one image
        shift calibration. Thus, you need to spread the beam to at least twice the size
        of the CCD camera to get through the image shift calibrations successfully.</P>
    <P><a name="isPreliminaries"><b><i>Other preliminaries:</i></b></a> The image and stage shift calibrations are
      the ones that give the most trouble for inexperienced users (and sometimes for
      experienced ones too).&nbsp; There are several things you can do to minimize
      problems:</P>
    <ul>
      <li>Set aside your practices from doing high-resolution low-dose microscopy.&nbsp;
          These calibrations, like many others, other not meant to be done in Low Dose
          mode.&nbsp; In non-LM mode, <em><strong>use an objective aperture</strong></em>
          small enough to give good contrast when the replica grating is near focus.</li>
        <li><em><strong>Use enough dose</strong></em> to get good correlation coefficients.&nbsp; New owners of
        direct detectors are often reluctant to apply enough dose at this stage.&nbsp; If
        there is not enough dose, the procedure will likely fail, and you may have to
        redo it so many times that you will end up with more total dose than if you had
        used enough in the first place.&nbsp; The program will report the mean
        correlation coefficient in the procedure and warn if it falls below 0.4.</li>
      <li>Use the kind of cross-line grating with <strong><em>latex spheres</em></strong> and include enough
        spheres in the field of view to help protect against spurious correlations.&nbsp;
          Generally, the more spheres, the better, as long as they do not obscure the
          grating pattern.</li>
      <li>Do not use a grating with 2000 lines per mm if you can avoid it, it can cause
          many problems.&nbsp; Get the <strong>2160 line/mm grating </strong>with latex spheres, Ted Pella
          product #603.&nbsp; If you do use a 2000 line grating, set the property 'GridLinesPerMM'
        to 2000 and be sure to have latex spheres: these grids can be too close to
        perfect to give correct cross-correlations.</li>
      <li>We all like to try to run programs without reading the help, but the problem
        here is that you need to be able to recognize when one of the procedures is not
        giving the right result.&nbsp; It can be helpful to read through the
        instructions for the procedures in advance:
        <A href="menu_calibration.htm#hid_calibration_isfromscratch">
            IS from Scratch</A>,
        <A href="menu_calibration.htm#hid_calibration_imageshift">
            Image Shift Calibration</A>,&nbsp;
          <a href="menu_calibration.htm#hid_process_findpixelsize">Find Pixel Size</a>,
          <a href="menu_calibration.htm#hid_process_pixelsizefrommarker">Try Again with Marker</a>.</li>
    </ul>
    <P><a name="isMacro"><b><i>A script for image shift and pixel size calibrations:</i></b></a> Open a script
      editor for an unused script.&nbsp; For example, select 'Edit 10' in the Script
      menu and then click the right arrow if necessary until there is no text in the
      window.&nbsp; Select, copy, and paste the following:</P>
      <P>MacroName IS-Pixel<br />
        IncMagIfFoundPixel 1<br />
        Trial<br />
        AutoFocus<br />
        ShiftCalSkipLensNorm<br />
        CalibrateImageShift<br />
        ReportMagIndex<br />
        SetupWaffleMontage 5 wafflemont-$repVal1.mrc<br />
        If $repVal1 == 1
        <br />
&nbsp; Montage<br />
&nbsp; Copy B A<br />
        Else<br />
&nbsp; Record<br />
        Endif<br />
        FindPixelSize </P>
    <P>The script will change magnification only if pixel size has not been found yet
      (so it can be stopped and run again after changing conditions, for example).&nbsp;
      With the 1 after 'IncMagIfFoundPixel', it will increase mag; with a -1, it will
      decrease it.&nbsp; Then the script will take a Trial picture so that you can see
      right away if conditions are suitable.&nbsp; It will autofocus, then calibrate
      the image shift.&nbsp; It then obtains an image for measuring the pixel size
      that has at least 5 grating blocks in each direction.&nbsp; This will be a
      single image if possible; otherwise the program will open a file for a montage
      of the correct size and take a montage.&nbsp; Finally, it will find the pixel
      size.</P>
    <P>The script will open a montage file in the current directory, whatever that
      happens to be.&nbsp; To have the files opened in a defined location, add a
      complete path in front of the filename 'wafflemont...'.</P>
      <P><a name="isProcedure"><B><I>The procedure:</I></B></a> This section describes the operations on the
        microscope for calibrating pixel sizes and image shifts.&nbsp; The commands are
        all in the Calibration - Pixel Size submenu.</P>
    <P>To get set up for the procedure, do the following:</P>
      <OL>
        <LI>
          Place a standard cross-line grating
          with latex speeres in the scope (2160 lines per mm).
        <LI>
          Pick an area with a fairly high density of spheres (but not a large continuous
          clump that would obscure the grating lines).<LI>
          Make sure your chosen field of view is eucentric.
        <LI>
          Use a moderate objective aperture like 40 microns for contrast.
        <LI>
          For convenience, turn on whatever microscope feature keeps beam brightness
          constant across mag changes (intensity zoom on Thermo/FEI).
        <LI>
          Turn off 'Align on Save' in the Buffer control panel (in the options section).
          Also set the 'Roll Buffers' selector to M or N.<LI>
          Go to a magnification where the field of view is about 3 microns (at least 6
          grating squares visible).
        <LI>
          Set up the Trial parameter set to take full-field 512 x 512 images, or 1Kx1K
          images on a direct detector, and set the exposure time as well as the beam
          strength to get a nice clean picture. <LI>
          Set up the Record parameter set to take full-field 1K x 1K images with up to 4 times the
          exposure time as the Trial images.
        <LI>
          Turn on Administrator mode and open the Log Window.
        <LI>
          Run 'Autofocus'.<LI>
          Run <A href="menu_calibration.htm#hid_calibration_isfromscratch">
            IS from Scratch</A>. If this succeeds, the program should report that the
          result is 'good'.
        <LI>
          Run
          <a href="menu_calibration.htm#hid_process_findpixelsize">Find Pixel Size</a>. At
          the end, you will see an autocorrelation of the grid image with the brightest
          spot in the middle and a square lattice of bright spots. Make sure that the
          green cross is on a bright spot adjacent to the center spot along a lattice axis and not along a diagonal from the center point; see the
          help for this command for details.&nbsp; If the cross is not in the right place,
          mark the proper peak position and run
          <a href="menu_calibration.htm#hid_process_pixelsizefrommarker">Try Again with Marker</a>.<LI>
          Run
        <a href="menu_calibration.htm#hid_process_listrelativerotations">List Relative Rotations</a>
          to get a RotationAndPixel line in the log.<LI>
          Copy and paste this line into the CameraProperties section for this camera in
          the properties file, and save that file.<LI>
          Save the calibrations with the entry in the Calibration menu.
        <LI>
          Exit and restart the program; turn on Administrator mode.</OL>
      <p>
        Now that this pixel size is in place, the script can be used, because the program
        will be able to estimate correctly whether a montage is needed.</p>
    <p>
        Run the script repeatedly, going to progressively higher mags.&nbsp; Aside from
        watching for problems and adjusting the beam as needed, watch out for any large
        (90 to 180 degree) rotations from one mag to the next.&nbsp; </p>
    <p>
        The program is accumulating information about the relative rotation between
        successive mags, using the angles of the grid axes when finding pixel size.&nbsp;
        However, these angles, and thus the relative rotations, are only known to the
        nearest 90&nbsp;degrees, and it is up to you to make sure that they correspond to the
        actual rotation between mags.&nbsp; You can do this all at once at the end, as
        long as you keep track of which mags could be wrong, or you can fix each large
        rotation as it occurs.&nbsp; The procedure for fixing rotations is to run
        <a href="menu_calibration.htm#hid_process_listrelativerotations">List Relative Rotations</a>&nbsp;to
        see what the program thinks the relative rotation is (the second number on each
        line, after the mag index). Fix a value with the&nbsp;
        <a href="menu_calibration.htm#hid_pixelsize_add_to_rotation">Add 90*n to a Rotation</a>&nbsp;command
        and rerun <a href="menu_calibration.htm#hid_process_listrelativerotations">List Relative Rotations</a>
        to make sure it now shows an appropriate relative rotation.</p>
    <p>
        If you reach a mag where the montages seem impractical, but you want image shift
        calibrations and pixel sizes above that point, then you can start changing mag
        manually, autofocusing, and running
        <A href="menu_calibration.htm#hid_calibration_imageshift">
            Image Shift Calibration</A> from the menu.&nbsp; On a Thermo/FEI scope, fairly
        accurate pixel sizes will be derived from the image shift calibrations.&nbsp; On
        a JEOL or Hitachi, where image shift may not be invariant, you would have to
        take and save single frame images at each mag, starting with the last one where
        pixel size was measured, and follow the procedure below in <B><I>Measuring further relative rotations and pixel sizes
        by aligning images.</I></B>  Alternatively, you can use catalase crystals; see
        the&nbsp; <a href="menu_calibration.htm#hid_process_catalase_crystal">Catalase Crystal</a> command.</p>
    <p>
        When you have reached the highest feasible or needed mag, return to the starting
        mag, change the 'IncMagIfFoundPixel 1' to -1 in the script, and close any open
        montage files.&nbsp; Start running the script to go to lower mags.</p>
    <p>
        <b><i>On a Thermo/FEI scope</i></b>, you can stop running this procedure at the
        highest LM mode mag (or even the lowest non-LM mode mag, if you have no need for
        calibrations in LM mode.)&nbsp; To continue calibrating image shift throughout
        LM mode, it is best to switch to a non-periodic specimen, and preferably one
        with larger grid spacing suitable for calibrating stage shift.&nbsp; However,
        you can try to finish the image shift calibrations with the replica grating if
        that is more convenient.&nbsp; If you do, follow the procedures in the next
        section,
        <b><i>On a JEOL or Hitachi.</i></b></p>
    <p>
        There is one potential problem to watch out for on Titan microscopes, mostly at
        the top of LM mode.&nbsp; A very long settling time after lens normalization has
        been required on some microscopes.&nbsp; The need for this will be revealed by a
        poor result on the first image shift calibration at the top of LM mode.&nbsp; If
        this happens, first try running <a href="menu_calibration.htm#hid_imagestageshift_removeiscal">
            Remove IS Cal</a> to make the program forget the bad
        calibration, then run the script again.&nbsp; The &#39;ShiftCalSkipLensNorm&#39; command
        in the script will keep the calibration routine from normalizing lenses again and
        causing the problem.&nbsp; To continue calibrating image shift below this point,
        there are two options: </p>
    <ol>
      <li>&nbsp;Save your calibrations, exit the program, and add a general property
        <br />
        LowMagNormalizationDelay&nbsp; 12000<br />
        (put this after the one for LensNormalizationDelay).&nbsp; A value of
        10000-12000 seems to be needed (10-12 seconds).&nbsp; Restart the program and
        proceed with the calibrations.</li>
      <li>Set up a script<br />
&nbsp;&nbsp; Delay 9<br />
&nbsp;&nbsp;
        ShiftCalSkipLensNorm<br />
&nbsp;&nbsp; CalibrateImageShift<br />
        Change mag manually then run the script.</li>
    </ol>
    <p>
        <b><i>On a JEOL or Hitachi</i></b>, try to run the procedure in the script down to the lowest
        mag that might be used for mapping.&nbsp; There are several things to watch out
        for and changes that may be needed:</p>
    <ul>
      <li>When the grating size gets below about 6 pixels, decrease the binning of the
        Record images, and increase the exposure time or the beam intensity to
        compensate and give te same mean counts.</li>
      <li>If there are grid bars at the edges of the image, the image will be trimmed
        and the analysis of pixel size should succeed.&nbsp; However, as soon as any
        adjacent grid square appears at the edge of the image, reduce the size of the
        Record image, such as by selecting center half.</li>
      <li>Eventually, at around 300x (depending on camera) it will be impossible to
        analyze the pixel size from the grating pattern.&nbsp; However, it should then
        be possible to use the grid bars themselves as a pattern.&nbsp; Before switching
        to this, run <a href="menu_calibration.htm#hid_process_listrelativerotations">List Relative Rotations</a>,
        fix large angles if necessary as described above, and copy and paste into the
        properties file the values starting with the lowest magnification where the
        pixel size was measured reliably.&nbsp; Then select the <a href="menu_calibration.htm#hid_pixelsize_meshforgridbars">Mesh for Grid Bars</a>
        command, enter a 400, and run the <A HREF="menu_calibration.htm#hid_process_setbinnedsize">Set Binned Size</A>
        command and enter 512.&nbsp; Restore the Record parameters to a full field image.&nbsp;
        Try to run the pixel size routine with these parameters.&nbsp; You will
        definitely have to be careful that the measured pixel size is correct, you may
        have to shift the field of view to get it to work better, and you may have to
        use
          <a href="menu_calibration.htm#hid_process_pixelsizefrommarker">Try Again with Marker</a>.&nbsp;
        After getting pixel sizes by this method to the lowest mag needed, run <a href="menu_calibration.htm#hid_process_listrelativerotations">List Relative Rotations</a>.&nbsp;
        Copy and paste into properties the new lines at the lowest mags, excluding the
        line at the mag where you had a pixel size from the grating pattern.&nbsp;
        However, take the relative rotation from that line and substitute it for the 999
        in the corresponding line from the earlier listing.</li>
      <li>If you cannot get results from the grid bar spacing, you will have to take and
        save images from the lowest mag needed up to the lowest mag where pixel size was
        measured from the grating.&nbsp; Take the images in order from low to high mag.
        Follow the procedures in <B><I>Measuring further relative rotations and pixel sizes
        by aligning images.</I></B></li>
    </ul>
      <P><a name="isBoundaries"><b><i>Assessing and setting image shift boundaries: </i></b></a>This step is 
        routinely needed on JEOL and Hitachi scopes, and should be done for Talos and 
        possibly Glacios. After image shifts 
        are calibrated, run <a href="menu_calibration.htm#hid_calibration_listisvectors">List IS Vectors</a> 
        and examine both the lengths and angles of the vectors.&nbsp; (If you have IMOD 
        or a recent <a href="#addedPackages">3dmod package for Windows</a> installed, you can use ListISVectorsToGraph and 
        GraphPreStoredValues script commands to make graphs that are much easier to 
        interpret.)&nbsp; Places where there is 
        a consistent change of more than ~2% should have an image shift boundary 
        specified.&nbsp; For example, here is a vector listing from a Talos Arctica using calibrated pixel sizes 
        and rotations: </P>
      <pre>
   17    1250        1.001          1.016      -28.6        60.2
  18    1600        0.991          1.008      -28.7        60.3
  19    2000        0.991          1.008      -28.8        60.4
  20    2600        1.086          1.096      -30.8        59.1
  21    3400        1.084          1.096      -30.8        59.2
  22    4300        1.084          1.098      -30.8        59.2
      </pre>

      <P>There is a significant discontinuity between indexes 19 and 20.&nbsp;&nbsp; 
        The index to specify is the one <em>above</em> the discontinuity; thus 20 
        instead of 19 here.&nbsp; &nbsp; The line needed in the properties file would be:<br />
        &nbsp;&nbsp;&nbsp;&nbsp;OtherShiftBoundaries 20
        <br />If there is one magnification out of line with the 
        ones above and below, two indexes would be required.&nbsp; Such a case should be treated as
         a boundary only after seeing if the magnification is still off in a vector listing based on the nominal 
        magnifications and carefully checking both the image shift calibration and the pixel size for the aberrant 
        magnification.
      </P>
      <P><a name="isAlignImages"><B><I>Measuring further relative rotations and pixel sizes by aligning images:</I></B></a>
        This procedure is needed only under the two circumstance described above.&nbsp; Open a copy
        of the mag calibration spreadsheet. Set the binning and the size of the pixels
        on the CCD to the correct values. If necessary, adjust the magnifications listed
        in the first column. Take any unbinned pixel sizes printed in the log after
        running the<a href="menu_calibration.htm#hid_process_findpixelsize"> Find Pixel Size</a>
        routine and copy them into the 'Unbinned cal pixel' column (overwriting the
        formula that computes the pixel size from modeling measurements).</P>
      <P>Further processing is done in IMOD as follows. First use Midas to get a rough
        prealignment of the images:</P>
      <P>midas -b 0 filename.st filename.inixf</P>
      <P>For each image pair, change the magnification (Shift-right mouse button) so that
        they are close to matching, and shift and rotate as necessary to get into rough
        alignment. As long as they are aligned in the center, xfalign should be able to
        complete the job. If you can't match up a pair of images because the microscope
        is not well enough aligned, just skip the pair. Also, if you have good relative
        rotations from the pixel size routine, you could skip most of the images with
        pixel sizes: namely, from the second lowest mag up to the highest mag with a
        pixel size, you would not need to align the image with the one at eth lower mag.</P>
      <P>Save the transforms and run:</P>
      <P>xfalign -red 1 -bi -ini filename.inixf filename.st filename.xf</P>
      <P>(If for some reason you have 512x512 images instead of 1Kx1K, use '-red 0'
        instead of '-red 1'.) When it is done, restart Midas with:</P>
      <P>midas -b 0 filename.st filename.xf</P>
      <P>Look at each pair to make sure it is well aligned. Save the transforms. If you
        only have two images, you can skip the spreadsheet entries and proceed to
        putting two lines in the properties for this camera, e.g.:</P>
      <P>RotationAndPixel 16 999 999 10.5<BR>
        RotationAndPixel 17 158.17 999 9.90</P>
      <P>Where 10.5 and 9.90 are the pixel sizes measured for the two mags, 158.17 is
        the NEGATIVE of the rotation angle shown in Midas, and the 999's indicate
        unmeasured values. Skip to the section below to see how to enter the absolute
        tilt axis rotation.</P>
      <P>If you took a full set of images, copy the Midas rotation, magnification, and
        stretch values into the appropriate lines of the spreadsheet (the first image
        pair provides data for the second mag). The rotation is just there to keep a
        record of it, but the Midas mag and stretch are resolved into a single number,
        in the 'Midas delta mag' column. You may find it easier to run:</P>
      <P>xf2rotmagstr filename.xf</P>
      <P>This will list the rotation, magnification, and stretch values for each
        transformation in the file, as well as net magnification value on the right that
        you can put directly into the 'Midas delta mag' column. Unfortunately,
        xf2rotmagstr was broken and gave rotations with the wrong sign from IMOD 3.12.23
        through IMOD 4.2.25. so be sure to use an IMOD version where it was not broken
        or invert the sign.&nbsp; For the lower mags, you can compare the 'delta mag'
        values with the 'Delta pixel' values to see how accurate these two methods are.
        The real use of the delta mag's is to derive pixel sizes above the last mag
        where you could measure it directly.
      </P>
      <P>Suppose the last mag where you measured the pixel (or the last one where you
        trust the measurement) is on line 11.
      </P>
      <OL>
        <LI>
          Put a 1 on that line in the 'Cumulative delta mag' column (cell J11).
        <LI>
          Put a formula in the cell on next line to multiply the cell above by the 'Midas
          Delta mag' on that line (J11 * E12 in J12), or just copy this formula up from
          the cells below. Either way, fill the cells below with this formula.
        <LI>
          In the 'Derived pixel' column, put a formula to multiply the last measured pixel
          value by the cumulative delta mag on that line (H$11 * J11 in K11). Copy this
          formula down to the cells below.
        <LI>
          The 'Unbinned pixel' column takes its values from the 'Unbinned cal pixel'
          column for low mags and from the 'Derived pixel' column for high mags. Copy
          formulas down from the top or up from the bottom so that all of the values in
          this column are based on the correct pixel size.
        <LI>
          The film magnification and unbinned and binned pixel sizes are copied to a table
          below the main one. Adjust the formatting of the cells in this lower table to
          show the desired number of significant digits. Print this portion of the
          spreadsheet and post it for users.
        <LI>
          The last column, 'Ratio', shows the magnification from film to camera. Average
          these numbers, or leave a few out if they appear out of line, to obtain
          'FilmToCameraMagnification'.</LI></OL>
      <P>Enter the appropriate numbers from the spreadsheet in a series of
        'RotationAndPixel' lines in the properties file. Each line should have:</P>
      <P>RotationAndPixel &lt;Magnification index&gt; &lt;the NEGATIVE of the Midas rotation&gt; 999
        &lt;Pixel size&gt;</P>
      <P><a name="absRotAngle"><B><I>Absolute rotation angle:</I></B></a> The last number missing from the
        RotationAndPixel entries is an absolute calibration of the rotation of the tilt
        axis.&nbsp; The angles from stage calibration should be used at lower
        magnifications, where the stage calibration routine is robust.&nbsp; For medium
        to high magnifications, the angle is most reliably obtained from a fiducial alignment of a tilt series. &nbsp;However, the angle
        from fiducial alignment can be off by 180 whereas the angle from an accurate
        stage calibration will always be in the correct quadrant, so you should always
        consult the results from stage calibration when setting this angle from a tilt
        series alignment. In IMOD, the angle by which
        the tilt axis is rotated from the vertical is shown in the 'Rot' column of the
        alignment solution log. If the value varies through the series, use the value from near
        zero tilt, which is summarized at the top of the solution. Once this value is available, replace the 999 on the RotationAndPixel
        line for the relevant mag with this value plus or minus 90 degrees (depending on
        which direction makes the angle match that from stage calibration). If you only measured
        one or two pixel sizes, this angle will most likely be measured at a different
        mag, in which case you would add a line such as:</P>
      <P>RotationAndPixel 23 999 77.5 999</P>
      <P>Where 77.5 is the measured absolute rotation.</P>
    <P>In general, it is good to add to the RotationAndPixel lines the angles from
      stage calibrations done at the lowest non-LM mode mag and the highest LM mode
      mag.&nbsp; This is especially important if you do not enter an angle from a tilt
      series.</P>
      <P>You can also use the rotation angle from a stage calibration or tilt series alignment to adjust the
        entry for 'GlobalExtraRotation'. Both this entry and the 'ExtraRotation' for a
        particular camera are used as fallback values when there is no other source of
        an absolute rotation angle, but they both become irrelevant for a given
        camera once that camera has an absolute rotation value.&nbsp; However, it could be useful
        to refine the value of 'GlobalExtraRotation' for use with other cameras. The basic principle is that the sum of the rotation
        angle in the magnification table for this mag (which could be wrong for a JEOL
        or Hitachi scope), plus the
        GlobalExtraRotation, plus the camera's ExtraRotation value, should equal the absolute angle on the RotationAndPixel
        line.</P>
    <P>&nbsp;</P>
      <P><A name="setup_scopecal"></A><B>Other Microscope Calibrations (Priority 2)</B></P>
      <P><B><I>Assessing Cycle Length of Compustage Movement Errors:</I></B> In the
        SerialEM Tools is a file named cycleMacro.txt containing a script for assessing
        the error in stage movement over distances large enough to reveal the
        periodicity of these errors (this is described in more detail in <A href="menu_calibration.htm#hid_calibration_stageshift">
        Stage Shift Calibration</A>). You will need the specimen suitable for stage
        calibrations described there and in the next paragraph. Open a script editing
        window with an Edit command in the Script menu, and press the Load button to
        load this script into the window. It will move the stage 132 microns in X and Y.
        Position the specimen in the middle of an area large enough in extent for this
        movement, and run the script. The output in the log window will show the
        difference between the measured and requested movement as a percentage; the
        cumulative sum of these differences in microns, and the total sum of measured
        shifts in microns. If the error is more than a few percent, the periodicity
        should be apparent in either the percentage or the cumulative difference. If
        there is a repeatable pattern, determine the distance between the extreme points
        in the pattern over one or preferably two cycles, and divide by the number of
        cycles to get the cycle length. If these differ from the default values of 62
        microns for X or 41 microns for Y, add lines for 'StageCycleLengthX' and
        'StageCycleLengthY' to the property file. Do not bother if the percent error is
        only a few percent.</P>
      <P>This step is optional since the values reported by Pulokas et al. and also
        found on the Boulder Tecnais may be universal constants for the Compustage.&nbsp; 
        Moreover, the problem appears to be minimal on later Tecnai stages and on stages 
        in newer Thermo/FEI scopes.&nbsp;
        The JEOL and Hitachi stages do not have cyclical errors but require much greater backlash
        correction.</P>
      <P>
        <B><I>Low Magnification and Stage Calibrations:</I> </B>These calibrations are
        needed to do montaging with stage movement and to use the Navigator to acquire
        low and medium-mag maps. To calibrate stage shift, or image shift in Low Mag
        mode, you should have a specimen that is moderately rich in detail and that is
        either on a slot grid or on a grid with a very large mesh.&nbsp; It is tempting
        to use the same cross-line grating used for the pixel size calibrations.&nbsp;
        It can give reliable results, but only if these conditions are satisfied: 1) you
        do not have an older compustage with large cyclical errors that require
        traversing more than 40 microns; 2) the grid has a good supply of latex spheres;
        3) the calibrations are not being done on an energy filter with substantial distortions;
        and 4) you are familiar enough with the procedure so that you can tell when it
        is giving bad results.&nbsp; It is particularly challenging and quite likely a
        waste of time to do the procedure with a calibration grid lacking latex spheres.
        The option to use
        <a href="menu_calibration.htm#hid_calibration_whole_image_corr">Whole-Image
        Correlations</a>, which is important for finding the correct rotation angle, is
        also prone to create problems with the cross-line grating.&nbsp; The recommended
        procedure for using a grating would be:</P>
    <ol>
      <li>Leave this option on for the first stage calibration, making sure that it is
        giving accurate correlations.</li>
      <li>Insert the rotation angle from the procedure as the absolute calibrated
        rotation in the appropriate &#39;RotationAndPixel&#39; line in the camera properties.
      </li>
      <li>Save calibrations and restart the program..</li>
      <li>Turn off  <a href="menu_calibration.htm#hid_calibration_whole_image_corr">
        Whole-Image Corr</a> for further stage calibrations.</li>
    </ol>
    <p>
      Start at the lowest
        usable magnification in regular mag mode and find an area with good features.
        Run the <A href="menu_calibration.htm#hid_calibration_stageshift">Stage Shift</A>
        command from the Calibration menu (read that entry for details). Drop to the
        highest mag in Low Mag mode. Repeat the stage calibration here, and also run an
        image shift calibration. The program will automatically do the latter from
        scratch if it is the first calibration in LM-mode. The calibrations in LM-mode
        will be done at the eucentric focus, or at the standard focus setting if it
        has been calibrated. Continue going down in mag, doing the
        image shift calibration at each mag. Do 2 more stage calibrations, one at an
        intermediate mag and one near the lowest mag that might be used for mapping.</p>
      <P>In LM-mode, at least on the Tecnai with slot grids and coarse mesh grids,
        strange image effects sometimes occur at the higher magnifications. These can be
        eliminated by inserting the smallest objective aperture that does not occlude
        the image on the camera.</P>
    <P><i><b>Illuminated area limits and aperture sizes on Titan:</b></i> Before you do any of the
      following three beam-related calibrations on a Titan, you should run the
      <A href="menu_calibration.htm#hid_beamspot_illuminatedarealimits">Illuminated Area Limits</A>
      command in the Calibration - Beam &amp; Spot submenu to determine the
      limits of the illuminated area readout at different spot sizes in the two probe modes.&nbsp;
      Insert the largest condenser aperture before running the calibration.&nbsp; Once this calibration is in place, the program can adapt if those limits change
       because of a scope re-alignment.&nbsp; Without such a calibration, changes in either the
      property &#39;UseIlluminatedAreaForC2&#39; or the scaling of internal lens values that
      determines the illuminated area readout from the scope will invalidate crossover,
      beam and spot intensity calibrations and some other intensity-related items.&nbsp; See
      <A href="menu_calibration.htm#hid_beamspot_illuminatedarealimits">Illuminated Area Limits</A>
      for details.</P>
    <P>The following five calibrations will ask you to enter the C2 aperture size.&nbsp;
      You should first add a property &#39;C2ApertureSizes&#39; with the available sizes in
      microns (.e.g., &#39;C2ApertureSizes 50 70 100 150&#39;).</P>
      <P><B><I>Beam crossover calibration:</I></B> This calibration should be done
        before the beam or spot intensity calibrations. Go to a high magnification like
        100K, select <A href="menu_calibration.htm#hid_calibration_beamcrossover">Beam
        Crossover</A>
        in the Calibration menu, and adjust the beam to crossover at each spot size.</P>
      <P><B><I>Beam intensity calibration:</I></B> This calibration is best done with no
        specimen. It must be done outside Low Dose mode.&nbsp; The procedure must be done for each spot size that will be used for
        tilt series; if low dose is going to be used, this might mean spots up to 6 or
        8. In the latter case, try to calibrate up to whatever spot size gives 0.3
        nanoamp of current. Start the procedure one or two steps above the highest mag
        that might be used (~200K for low spot size numbers, lower mags for the spots
        that will only be used for low dose?). An intensity calibration will work on
        only one side of crossover. You can calibrate one side of crossover based upon
        the users' most common practice. Alternatively, you can calibrate both sides of
        crossover provided that you have done the beam crossover calibration. See <A href="menu_calibration.htm#hid_calibration_beamintensity">
        Beam Intensity</A> for more details.</P>
      <P><B><I>Spot intensity calibration:</I></B> This calibration measures the
        relative intensity of the spots and is needed to allow an electron dose
        calibration at one spot to be transferred to other spot sizes. It should be done
        at an intensity setting that is within the calibrated range for all spots of
        interest. It is best done with no specimen. As with the beam intensity
        calibrations, you can do it on one side of crossover, or on both. See <A href="menu_calibration.htm#hid_calibration_spotintensity">
          Spot Intensity</A> for more details.</P>
      <P><B><I>Beam shift calibration (Priority 1 on JEOL):</I></B> This calibration
        allows the user to shift the beam by a controlled amount by placing a point on
        an image. It is essential on the JEOL for getting the beam moved correctly when
        image shift is used. Separate calibrations can be done in regular and low
        magnification modes.&nbsp; On the JEOL, separate calibrations are also stored
        for GIF mode and for different magnification ranges defined by the
        &#39;OtherShiftBoundaries&#39; property. Beam shift calibrations are
        also alpha-specific for microscopes that have an alpha setting, so you will need
        a calibration for each alpha value that is used.&nbsp; (Older calibrations will
        still work at any alpha.) Follow the procedure in <A href="menu_calibration.htm#hid_calibration_beamshift">
          Beam Shift</A>.</P>
      <P><b><i>High-defocus magnification calibration: </i></b>This calibration is 
        fairly essential for making and using Navigator maps (especially montages) with 
        Low Dose View or Search images having a substantial defocus offset.&nbsp; See <A href="menu_calibration.htm#hid_calibration_high_defocus">High-Defocus Mag
          </A> for details.&nbsp; </P>
      <P><b><i>High-defocus image shift calibration: </i></b>This calibration is not as 
        essential as the last one but makes many things work more smoothly and 
        accurately with substantially defocused View or Search images, especially in 
        conjunction with the high-defocus mag calibration. 
        See <A href="menu_calibration.htm#hid_imagestageshift_high">High-Defocus IS
          </A> for details.&nbsp; </P>
      <P><B><I>Small screen factor:</I></B> This is needed to get the same current
        readout with the small screen in and out. Fill the main screen with a moderately
        bright, uniform beam (5-10 na). Note the current reported in SerialEM. Insert
        the small screen. Compute the ratio of the current now to the current on the
        main screen. Go to the properties file and multiply the existing
        SmallScreenFactor by this ratio. Restart SerialEM and check that the current
        corresponds adequately now.</P>
      <P>There is also a ScreenCurrentFactor that requires a Faraday cup measurement to
        calibrate. The screen current calibrations on Tecnais can be off by over 30%, so
        this is worth doing. If you determine the ratio between the current measured
        with a Faraday cup and the current reported by SerialEM, then multiply the
        existing ScreenCurrentFactor by this ratio.</P>
      <P><B><I>C2 factors:</I></B> This calibration is needed to make the C2 lens
        percentage for a Thermo/FEI scope reported in SerialEM correspond to the values shown in
        Microscope User Interface. To do this calibration, first add the C2 lens readout to your MUI
        workspace. Then select <A href="menu_calibration.htm#hid_calibration_c2factor">
        Set C2 Factor</A> in the Calibration menu and enter the C2 value at each spot
        size.&nbsp; Skip this for a Titan.</P>
      <P><B><I>Tilt axis offset:</I></B> This calibration is needed to shift the
        microscope image shifts so that they are centered on the tilt axis of the
        goniometer. Service engineers should be able to adjust the tilt axis to
        within about 1 micron of the optic axis, but if this has not been done, this setting
        will help to minimize movements in Y and Z when tilting. You need a specimen
        suitable for running the eucentricity routines with. Go to the center of the
        grid, run <A href="menu_tasks.htm#hid_eucentricity_both">Eucentric - Both</A> in
        the Tasks menu, then run <A href="menu_tasks.htm#hid_eucentricity_fine">
        Eucentric - Fine</A> in the Tasks menu 2-4 more times. If the numbers reported
        for the lateral displacement are
        consistent, enter their average as the TiltAxisOffset in the properties file.
        This value has an effect only if individual users turn on 'Center image shift on
        tilt axis' in the Image Alignment and Focus control panel. If you do calibrate
        this setting, check it after the stage is worked on, as it can easily change.
        Note that if you have this option selected and you measure the offset with the
        eucentricity routine, you need to ADD the measured offset to whatever value is
        already present.</P>
    <P>
      &nbsp;</P>
    <P><A name="z_by_g_setup"></A>
      <strong>Extended Autofocus and Non-reciprocity Calibration 
      for Using Eucentricity by Focus (Priority 2)</strong></P>
    <p> <em><strong>The need for an extended autofocus calibration:</strong></em> If the Eucentricity by Focus routine 
      is going to be used to find 
      eucentricity from a large distance away in Z, or with very large 
      defocus offsets, an autofocus 
      calibration over a wide range will be needed at least for efficient operation of 
      the routine and possibly even for the routine to work at all, because the 
      autofocus calibration becomes quite nonlinear over large focus ranges.&nbsp; Such a 
      calibration can be prepared with the <A href="menu_calibration.htm#hid_calibration_autofocus">Extended Autofocus</A> 
      command in the Calibration - Focus &amp; Tuning menu after setting the limits with the <A href="menu_calibration.htm#hid_focustuning_setextendedrange">Set Extended Range</A> 
      command.&nbsp; The needed range depends on both the range of Z changes to be 
      handled and the range of defocus offsets when measuring defocus.&nbsp; Here are 
      some recommendations for the different possibilities:</p>
      <ul>
        <li>Measuring defocus in Eucentricity by Focus with Focus images (i.e., at higher 
          magnification): Assuming that the autofocus offset will not be large, the 
          autofocus calibration should encompass the biggest Z changes that might be 
          encountered when using Focus.&nbsp; If the routine is not going to be used 
          except for periodic refinements of the eucentricity, with Z changes less than 30 
          microns, then the default calibration is adequate.&nbsp; Otherwise, the 
          autofocus calibration might need to extend to about +/-100 microns.&nbsp; The 
          recommendation is to make one or more extended calibrations that would be 
          accessed at the relevant magnifications.&nbsp; If the recommendation not to have 
          many autofocus calibrations is followed, then this might be just the one 
          calibration at the highest magnification.</li>
        <li>Measuring defocus with View in Low Dose mode using a small to moderate defocus 
          offset: The needed range is dominated by the highest Z change that might be 
          encountered but the defocus offset could require a larger underfocus range.&nbsp; 
          To cover defocus offsets up to -50 microns, the recommendation is to have an 
          extended autofocus calibration at the most likely View magnification from about -150 to +100 
          microns.&nbsp; You do not need calibrations at multiple magnifications as long 
          as the calibrated magnification is the closest one to other ones that may be 
          needed for View.</li>
        <li>Measuring defocus with View using a large defocus offset:&nbsp; The recommendation 
          is not to do this if it can be avoided, and to use an offset of not more than 
          -50 microns even when using much larger offsets for 
          mapping and other operations.&nbsp; This is based on the expectation that the defocus measurement will 
          work with much smaller offsets than are needed for seeing details and getting 
          reliable alignment of pieces in a montage overview.&nbsp; However, if 
          some cases do require a high offset, or if you want to protect users from 
          failing to set a more modest offset in the Eucentricity by Focus calibration, 
          then you would need to cover the range of defocus offsets that might be used for 
          measuring defocus.&nbsp; For example, to cover offsets up to -300 microns and Z 
          changes of ~100 microns, the recommendation is to have the autofocus calibration 
          used at the View magnification extend from -400 to +100 microns.</li>
      </ul>
    <p> <em><strong>Calibrating non-reciprocity for better predictability and 
      convergence:</strong></em>&nbsp; This calibration may be helpful if the routine 
      does not converge well when using a large defocus offset.&nbsp; Near the eucentric height and for small 
      defocuses, a change in Z height is equivalent to the same change in defocus; 
      this relationship is called reciprocity.&nbsp; Reciprocity breaks down badly at 
      high defocus offsets. On a Thermo/FEI Tecnai, the factor relating defocus to Z 
      change was found to be approximately the same as the ratio of the slope of the 
      autofocus curve at a given defocus offset to its slope at zero defocus. The 
      Eucentricity by Focus routine will thus try to determine this slope ratio and 
      use it to scale the Z change that is needed to compensate for a measured 
      defocus.&nbsp; Doing so requires an extended autofocus calibration.&nbsp; It is 
      not known whether this approximation holds generally or is specific to this kind 
      of microscope.&nbsp; If you find that the eucentricity routine requires more 
      than about 4 iterations and does not get within ~10 microns on the first 
      iteration, then you may need to calibrate the non-reciprocity directly.&nbsp; 
      You can do so with the following script and then insert the final line of output 
      with &quot;ZbyGFocusScalings&quot; into the properties file:</p>
    <pre>
# Measures non-reciprocity between defocus measurements
# and Z changes at a series of View offsets
# Adjust Z offset list to stay within range of the extended focus
# calibration
# Make sure the beam and specimen will give good focus
# measurements at the highest offset
offsetArr = { 0 -50 -100 -150 -200 -250 -300 }
zRange = 50
backlash = 3

SuppressReports
SetLowDoseMode 1
ReportUserSetting LowDoseViewDefocus offsetOrig
startZ = -1 * ( $zRange / 2. + $backlash)
MoveStage 0 0 $startZ
MoveStage 0 0 $backlash

loop $#offsetArr ind
   SetUserSetting LowDoseViewDefocus $offsetArr[$ind]
   Autofocus -1 1
   ReportAutoFocus
   if $ind == 1
      lowerArr = $repVal1
   Else
      lowerArr = { $lowerArr $repVal1 }
   Endif
EndLoop

MoveStage 0 0 $zRange
Loop $#offsetArr ind
   SetUserSetting LowDoseViewDefocus $offsetArr[$ind]
   Autofocus -1 1
   ReportAutoFocus
   factor = ROUND (  $zRange / ( $repVal1 - $lowerArr[$ind] )  3)
   if $ind == 1
      calArr = { $offsetArr[$ind] $factor }
   Else
      calArr = { $calArr $offsetArr[$ind] $factor }
   Endif
EndLoop
echo Add property:
echo ZbyGFocusScalings  $calArr

MoveStage 0 0 -$zRange / 2.

</pre>

      <P><A name="setup_xray"></A><B>Setting Up X Ray Removal from Dark References
        (Priority 2)</B></P>
      <P>The main task here is to determine the hot pixels and hot columns in the CCD so
        that these are not erroneously treated as X rays in a dark reference.
      </P>
      <OL>
        <LI>
          If you have a 16-bit camera, turn off division by 2 if it is on, or remember to
          double the absolute criterion that you determine when you enter it in the
          properties file.
        <LI>
          Set up a parameter set to take full-field unbinned 3 second exposures, and
          select the option to take a new dark reference every time.
        <LI>
          Open column values and spread the beam a lot (or select a high spot size) so
          that the beam will not saturate the camera.
        <LI>
          Take an exposure, then select 'Show Dark Ref' from the Camera menu. Save the
          dark reference to a file.
        <LI>
          Do this 3 times, saving all 3 images to one file.
        <LI>
          Remember to turn off the option for a new dark reference every time.</LI></OL>
      <P>Transfer this stack and findhotpixels.com to a machine with IMOD 3.9 or higher.
        Edit findhotpixels.com to provide the name of the image stack, the name of a
        model file to place points in, a threshold for hot pixel strength, and a list of
        any hot columns that appear in the images, numbered from 0. Number the hot
        columns from zero. With a Gatan US 4000 camera you will need to exclude a large
        number of columns near the edges, 20 or more. Enter subm findhotpixels.</P>
      <P>You will get a list of the hot pixels and their mean values in the log file.
        You can also look at the model on top of the images to verify that the program
        has found hot pixels. The log file ends with a series of lines of the form:</P>
      <P>HotPixels X Y X Y X Y ...</P>
      <P>Add these lines to your properties file. If you entered any hot columns, you
        will also see one or more lines listing them as:</P>
      <P>HotColumns Y Y Y ...</P>
      <P>Add these to the property file too. Uncomment all of the lines about DarkXRay...
        Set the DarkXRayAbsoluteCriterion to the threshold you set for Findhotpixels
        (but double it if images from a 16-bit camera were divided by 2). The
        MaximumXRayDiameter can be set to 6 for 15 micron pixels or 4 for 30 micron
        pixels, unless you want to analyze the situation further.</P>
      <P>You can assess the performance of the X-ray removal with different criteria by
        reading your dark reference images back into SerialEM. After reading one, copy
        it to Buffer A, then select 'Fix Dark X Rays' in the Process menu. You can then
        compare the images in A and B. Turn on Administrator mode and select 'Set
        Criteria' in the Process menu to change the criteria. Copy the image back to A
        and run the removal again.</P>
    <P>&nbsp;</P>
      <P><A name="setup_camera_gain"></A><B>Measuring Camera Gain (Priority 2)</B></P>
    <P>A camera property, CountsPerElectron, must be measured in order to calibrate
      dose to the specimen.&nbsp; One method of doing this is to add up the counts in
      an image that includes the whole beam and relate the counts to the screen
      current.&nbsp; It is only as accurate as the screen current reading itself, so
      ideally that should be checked with a Faraday cup.&nbsp; The following procedure applies to cameras generally; see the
      sections below for the procedures for a K2 Summit or K3 camera and for a Falcon
      3 camera.</P>
    <ol>
      <li>Turn off &#39;Divide by 2&#39; in the Camera menu before starting this procedure.</li>
      <li>To do this, you need to have a beam that falls entirely in the camera field of
        field and that is bright enough so that the screen current measurement is
        relatively accurate.&nbsp; Specifically, set the spot size so that the screen
        current is about 1 na (switch to a smaller condenser aperture if necessary).&nbsp;&nbsp;
      </li>
      <li>Then center the beam and adjust the beam size so that its diameter is at most
        80% of the camera field of view.&nbsp; </li>
      <li>Set the camera parameters for a full-field unbinned image and with an exposure
        time high enough so that it is accurate (say, at least 0.2 seconds) but not so
        high that the camera is near saturating.&nbsp; Once you are able to take an
        image, you can use <A href="menu_tasks.htm#hid_process_centerbeam">
        Center Beam</A> and <A href="menu_tasks.htm#hid_process_setintensity">
        Set intensity</A> in the Tasks menu to center the beam and adjust its size by small amounts.</li>
      <li>&nbsp;Lower the screen, record the screen current, take an image, and lower
        the screen again to check that the current is the same.</li>
      <li>Measure the mean counts in the image with <A href="menu_process.htm#hid_process_minmaxmean">Min/Max/Mean</A>
        in the Process menu (hot key Ctrl I)</li>
      <li>Compute countsPerElectron = meanCounts x imageSizeInX x imageSizeInY /
        (exposureTime * current * 6.242 x 10<sup>9</sup>)<br> where exposureTime is in seconds and current is in nanoamps.</li>
    </ol>
      <p>
        <i>For a K2 Summit camera</i>, the situation is complicated because counting
        mode gives a nonlinear response, and because counting mode only detects a
        fraction of the electrons
        (see <A href="about_camera.htm#directDetectors">Direct Electron Detectors, Especially the Gatan K2 and K3</A>).&nbsp;
        In SerialEM, dose rate estimates based on electron counting images are all
        'linearized' and should closely match the dose rate outputs in
        DigitalMicrograph. The program contains tables of image counts versus dose
        rate output observed in DM, for 200 and 300 KV, and for GMS 3.31 and higher the
        program will use a dose rate estimate directly from DM. As a result, counting mode
        images from a wide range of exposure levels give good dose rate estimates at the
        camera and can be used for calibrating electron dose at the sample, even if the
        counts per electron is not calibrated.&nbsp; Neverthless, it is recommended to
        measure the two gain-related properties as described here:</p>
    <ol>
      <li>&nbsp;The camera property CountsPerElectron is used to determine dose rate
        from linear mode images and when calibrating dose with a linear mode image. <b>&nbsp;It does not apply to counting mode counts
        and should never be set to a value near 1</b>.&nbsp; </li>
      <li>The general property ScalingForK2Counts sets the scaling of counting
        mode images to make them comparable to linear mode ones, although the
        CountsPerElectron value would be used if this scaling is not entered.&nbsp; <b>Again, it
        should never be set to a value near 1, or there will be a terrible loss of dynamic
        range in electron counting images</b>.&nbsp; A proper setting of this value is
        important if linear mode images are being used in conjunction with counting
        images, particularly when doing tilt series where the program monitors the image
        intensity for sufficient counts.</li>
    </ol>
    <p>
      Here is a procedure for determining the counts per electron and for setting the
      ScalingForK2Counts so that linear and counting mode counts match at 7.5
      electrons/physical pixel/sec, the middle of the useful range for counting mode.
    </p>
    <ol>
      <li>Add the general property ScalingForK2Counts and temporarily set it to 40.&nbsp; Restart SerialEM.</li>
      <li>Select the K2 and set up for a 1 second counting mode exposure.</li>
      <li>Adjust the beam to get a dose rate readout of 7.5 electrons/physical pixel/sec.
      </li>
      <li>Take 3-5 images and measure their means with &#39;Crtl-I&#39;.</li>
      <li>Switch to linear mode, take 3-5 images, and measure their means.</li>
      <li>Set ScalingForK2Counts to 40 * (average of linear mode
        means) / (average of counting mode means).</li>
      <li>Set CountsPerElectron in the K2 CameraProperties section to this value times
        0.950 for 200 KV or times 0.813 for 300 KV.&nbsp; These values were obtained by
        interpolating from the dose rate scaling factors measured in DM and incorporated
        into the tables in SerialEM; specifically between 0.8264 at 6.388 e/physpix/sec
        and 0.8104 at 7.699 e/physpix/sec for 300 KV, or between 0.9654 at 6.583
        e/physpix/sec and 0.9465 at 7.682 e/physpix/sec for 200 KV.</li>
    </ol>
    <p>
      This is at least the third version of these instructions.&nbsp; If you have
      values obtained with a previous version and you care to correct them, it is best
      just to redo the procedure.&nbsp; Again, your dose measurements with counting
      images will match those in DM even if you leave the values as they are.</p>
    <p>
      <i>For a K3 camera</i>: Here the situation for counting mode images is simple.&nbsp;
      These yield 32 counts per detected electron by design, and recorded counts are
      linearized with a table, so the CountsPerElectron property is 32 by default and
      should not need to be changed.&nbsp; However, it is necessary to determine the
      scaling factor needed to make linear and counting mode images have the same
      counts in SerialEM.&nbsp; The procedure for this is:</p>
    <ol>
      <li>Add the property LinearToCountingRatio to the K3 properties section if it is
        not already there, and temporarily set it to 300.&nbsp; Restart SerialEM.</li>
      <li>Select the K3 and set up for a 1 second counting mode exposure.</li>
      <li>Adjust the beam to get a dose rate readout of about 30 electrons/physical pixel/sec.
      </li>
      <li>Take an image and get the statistics and dose rate output with &#39;Crtl-I&#39;.</li>
      <li>Switch to linear mode, take an image, and get the statistics.</li>
      <li>Set LinearToCountingRatio to 300 * (linear mode dose rate) / (counting mode
        dose rate).</li>
      </ol>
    <p>
        If you have GMS 3.31.2336 or higher, which supports correlated double sampling
        (CDS), then there is an additional scaling factor needed, the ratio between
        linear mode counts with CDS on and CDS off.&nbsp; The default in the program is
        1.5.&nbsp; The procedure is:</p>
          <ol>
              <li>Check if the property K3CDSLinearRatio is present in the K3 properties section;
                  if so set it to 1.5 and restart SerialEM.</li>
              <li>Adjust the beam to get a dose rate readout of about 30 electrons/physical pixel/sec.</li>
              <li>With CDS off, set exposure to 0.04 sec and take an image, then get the image
                  mean with 'Ctrl-I'.</li>
              <li>Set exposure to 0.16 sec, take an image, and get the mean.</li>
              <li>Turn on CDS mode and get image means at the same two exposure times.</li>
              <li>The ratio is 1.5 * (CDSmean.16 - CDSmean.04) / (nonCDSmean.16 - nonCDSmean.04).&nbsp;
                  If the ratio differs from 1.5 by more than 1-2%, add the property
                  K3CDSLinearRatio or adjust it with the new ratio.</li>
          </ol>
          <p>
              <i>For a Falcon 3 or 4 camera:</i> The procedure for setting CountsPerElectron is simple.&nbsp; Take an image in counting mode with frame-saving
        turned on and open the .xml file.&nbsp; Take the inverse of the value for
        CountsToElectrons and use that for the CountsPerElectron (it is typically ~105 for 
              Falcon 3 and ~300 for Falcon 4).&nbsp;  It is not known whether there is loss in detecting electrons even at the lowest
-        dose rates such as there is
-        for the K2/K3; if this becomes established or you have measurements indicating that
-        it occurs, multiply the value by the efficiency factor (1 minus the fraction
-        lost).&nbsp; Note that this value for counts received from the Thermo/FEI software is 
              not the same as what applies to the images you see and the value placed in 
              &#39;.mdoc&#39; files, because it is adjusted for the scaling controlled by the property 
              &#39;Falcon3ScalingPower&#39;.</p>
        <p>For Falcon 4, a different property is needed for scaling raw electron counts when aligning frames being saved as EER, 
              or aligning without permanently saving (in this case frames are saved into 
          an EER file).&nbsp; This scaling factor is needed to make the counts in aligned 
          images match those in unaligned images (ones scaled by the Thermo/FEI software). 
          To estimate this factor, set Record parameters for unbinned, 2 second exposure, 
          no frame saving, and counting mode.&nbsp; Take an image without aligning, and an 
          image with aligning in SerialEM.&nbsp; Use Ctrl-I to get the mean counts of 
          each.&nbsp; Set the property FalconEventScaling to CountsPerElectron * (mean 
          without aligning) / (mean with aligning).</p>
    <p>
        It is also important for some purposes to make linear mode and counting mode
        give the same number of counts; this is achieved with the camera property
        'LinearToCountingRatio'.&nbsp; A procedure for estimating this for is:</p>
    <ol>
      <li>Add the property 'LinearToCountingRatio 8' if it is not already present.</li>
      <li>For Falcon 3, turn on Divide By 2 in the Camera menu so that linear mode measurements will
        not be biased by truncation at 0.</li>
      <li>Set Record parameters for unbinned, 2 second exposure, no frame saving.</li>
      <li>Set the beam intensity to give ~0.5 or ~3.5 electrons/physical pixel/sec for 
        Falcon 3 or 4, respectively.&nbsp; It is
        not necessary to set this to a very low value, where loss of counting efficiency
        is minimal, because the mean counts for counting mode will be linearized to
        account for this loss by a table built into SerialEM.</li>
      <li>Copy and paste this into a script window:<br />
      sumc = 0.
      <br />
      suml = 0.<br />
      num = 30<br />
      SetK2ReadMode R 1<br />
      loop 3<br />
&nbsp; R<br />
&nbsp; ReportMeanCounts A<br />
&nbsp; sumc = $sumc + $repVal1<br />
      EndLoop<br />
      cmean = $sumc / 3<br />
      SetK2ReadMode R 0<br />
      loop $num<br />
&nbsp; R<br />
&nbsp; ReportMeanCounts A<br />
&nbsp; suml = $suml + $repVal1<br />
      EndLoop<br />
      lmean = $suml / $num<br />
      adjust = round ( $lmean / $cmean 3 )<br />
      echo linear mean $lmean&nbsp;&nbsp; counting mean&nbsp; $cmean<br />
      echo Adjust by $adjust</li>
      <li>Multiply the value of LinearToCountingRatio by the adjustment factor.</li>
    </ol>
      <p>
        &nbsp;</p>
      <P><A name="setup_stretches"></A><B>Stage and Imaging Stretch (Priority 2)))</B></P>
      <P>These calibrations are important if the Navigator is going to be used to find
        marked locations after rotating the grid. Since the two stage axes do not behave
        identically, a calibration of the stretch in the stage coordinate system is
        needed to maintain accuracy when rotating the stage coordinates of marked
        locations. Having this calibration allows positions to be transformed accurately
        in the Navigator using only 2 or 3 registration points, and allows more accurate
        transformations when using the <A href="hidd_navrotalign.htm">Align with
        Rotation dialog</A>. The procedure for this calibration is described in <A href="menu_calibration.htm#hid_calibration_stagestretch">
        Stage Stretch</A>.</P>
      <P>When using the <A href="hidd_navrotalign.htm">Align with Rotation dialog</A>, a
        stretch in the image projection makes it harder to align images. This stretch
        can be corrected by entering a property 'RotationStretchXform' for one or more
        magnifications. The program will use the property for the nearest magnification
        in the same mode if one is available; thus you would need property entries for
        one magnification in low-mag and one in regular mag mode if you want to have
        corrections in both modes. The procedure for obtaining this entry is as follows:</P>
      <OL>
        <LI>
          Select a location with recognizable image features over a sufficient area to do
          alignment correlations with.        <LI>
          Pre-expose this area for a few minutes to stabilize it. Further shrinkage will
          not affect the calibration as long as it is isotropic.
        <LI>
          Take and save an image at one or more magnifications and make each one be a
          Navigator map (e.g., one near the bottom of regular mag mode, and one in low mag
          mode).
        <LI>
          Rotate the grid by about 90&deg; (rotations between 70 and 110&deg; should be useful).
        <LI>
          Center on the same region, take an image at each selected magnification, and
          save each as a map. You may wish to use the <A href="hidd_navrotalign.htm">Align
          with Rotation dialog</A>
          to center on the position of each previous map.
        <LI>
          Note the section numbers (numbered from 0) of each pair of images at the same
          magnification.
        <LI>
          Take the map file to a machine with IMOD. For one magnification, run
          <BR>
          &nbsp;&nbsp; newstack -sec before,after mapfile temp1.st<BR>
          where 'before' and 'after' are the section numbers before and after rotation,
          and 'mapfile' is the image file
        <LI>
          Run<BR>
          &nbsp;&nbsp; midas -b 0 temp1.st temp1.inixf<BR>
          Rotate the image with the middle mouse button and shift with the left mouse
          button until they are approproximately align. Save the transform and exit
        <LI>
          Run<BR>
          &nbsp;&nbsp; xfalign -bi -ini temp1.inixf temp1.st temp1.xf
        <LI>
          Check the alignment with<BR>
          &nbsp;&nbsp; midas -b 0 temp1.st temp1.xf
        <LI>
          Extract the transform with<BR>
          &nbsp;&nbsp; tail -n 1 temp1.xf
        <LI>
          Add a line to the properties file in the CameraProperties section for the camera
          used with<BR>
          &nbsp;&nbsp; RotationStretchXform&nbsp; &nbsp;mag_index&nbsp; &nbsp;# # # #<BR>
          Where mag_index is the magnification index (look this up the mag table in the
          properties file) and '# # # #' are the first four numbers of the transform
        <LI>
          Repeat steps 7 to 12 with each other pair of images, changing the numbering of
          the temp files if you wish to preserve those results.</LI></OL>
      <P><A name="setup_gifcal"></A></P>
    <P><B>Energy Filter Calibrations (Priority 1)</B></P>
      <P>Before even trying to calibrate mags for your energy filter camera, you may need to improve the
        EFTEM alignments that were supplied by Thermo/FEI so that the field of view does not
        shift too much when you change mags. This is a tedious and difficult procedure
        but is worth figuring out how to do it well.</P>
      <P>Once you have done that, you should do a separate calibration of image shifts
        and pixel sizes from the calibration on the upper camera (or at least do the
        image shifts and one pixel size.) SerialEM has some fancy logic for transferring
        calibrations from one camera to another, but I wouldn't rely on it except for
        test purposes. Do a calibration of autofocus at one mag first, because then you
        will be able to use autofocus to focus when you switch between mags. Then follow
        the procedure above for getting the image shift calibrations and grating
        pictures.</P>
      <P>In addition, you may need to calibrate the magnification-dependent energy
        shifts; i.e., this calibration may be
        needed so that various procedures can switch to lower mag when the slit is in
        and not lose the zero loss peak. Follow the procedures described in <A href="menu_calibration.htm#hid_calibration_magenergyshifts">
          Mag Energy Shifts</A>.</P>
      <P>&nbsp;</P>
    <P><A name="setup_gifprop"></A><B>Energy Filter Properties (For the Sake of Completeness)</B></P>
      <P>There are several properties for energy filters (see <A href="about_properties.htm#gif_properties">
          Energy Filter properties</A>.)  For a GIF, the most important to check is the
        BiggestGIFApertureNumber, which is used to make sure that there is no aperture
        in the way when images are taken. In addition, there are properties to specify
        delays when inserting or retracting the slit or changing energy offsets. These
        timings may be OK, but here are some notes on how they were obtained for a GIF.  All of
        the relevant properties can be set with the script command 'SetProperty'.
      </P>
      <P>For testing the adequacy of the delay on removing the slit:
      </P>
      <OL>
        <LI>
          You need to have a situation where the ZLP is misaligned by at least 10 ev.
          Perhaps align the ZLP at one mag, then turn off 'Mag-dependent energy shifts' in
          the Filter Control panel and switch to another mag where the ZLP is shifted by
          at least 10 ev. (This was easier before SerialEM detected ZLP alignment
          automatically.) The point is that you want to be able to take a picture at zero
          loss with a 5 ev slit and get very little beam through.
        <LI>
          Enter low dose mode. Set up View and Record/Preview to take pictures at this mag
          with the same intensity, and set the intensity and exposure time of view and
          preview to give thousands of counts. Make sure the shuttering being used gives consistent exposures.
        <LI>
          Set up Record with 5 ev slit in, 0 loss
        <LI>
          Setup up View with slit out
        <LI>
          Hit Preview to condition, then View to test, then Ctrl I for image mean.
        <LI>
          With the right delay, View will always come out right. If the delay is too
          short, the image mean will occasionally fall short.</LI></OL>
      <P>For testing the delay upon energy shift:</P>
      <OL>
        <LI>
          Set up Record/Preview and View in Low dose so that both are at the same mag and
          have the slit in.
        <LI>
          Get the ZLP aligned and set up Record/Preview and View for 10 ev slit, slit in.
        <LI>
          Make sure View gives good consistent pictures, and set the loss in Preview to
          the desired differential.
        <LI>
          Hit Preview to condition, then View to test and Ctrl I for image mean.
        <LI>
          Test this for energy shifts like 10, 20, 40, 80, 120, 160, 200.
        <LI>
          If there are problems, you may need to test more, or just increase the delays.
          Filter offset delay is specified by two linear equations, each having a base
          delay and an additional delay per ev of offset.  The units for the relevant properties are
          60th of a second for a GIF and 1 msec for other filters.
        </LI>
      </OL>
      <P>&nbsp;</P>
    <P><A name="STEM_setup"></A><B>Setting Up STEM</B></P>
    <P>All of the property file entries used to configure STEM usage are described in
      either the <b>STEM Camera Properties</b> section of
      <A HREF="about_properties.htm#per_camera_properties">Properties for one camera</A>
      or in <A HREF="about_properties.htm#stem_properties">STEM properties</A>.&nbsp;
      See those sections for full details on the properties that are mentioned below.&nbsp;
      The exception to this is for JEOL STEM: &#39;CameraPluginIndex&#39; is described in the
      <strong>Plugin Camera Properties</strong> section and must be set to 1 in the
      camera properties.</P>
    <P><b><i>Detector Property Entries</i></b>. The CameraProperties section for the
      STEM camera should list all of the detectors whose access can be controlled by
      the program.&nbsp; There should be a ChannelName entry for each detector; this
      is the name that will appear in the Camera Setup dialog.</P>
    <P>&nbsp;<i>For Thermo/FEI STEM, </i>there may also be DetectorName entries with the official
      names of the detectors, if you do not want those names to appear in the dialogs.&nbsp;
      For example, in some cases the official name of the HAADF detector is 'HAADF
      Detector' and properties 'ChannelName HAADF' and 'DetectorName 0 HAADF Detector'
      would be used to have the name appear just as 'HAADF'.&nbsp; In one case, an
      external switch was used to select between bright and dark field detectors, and
      whichever one was selected fed into the Thermo/FEI bright field channel.&nbsp; These
      detectors were listed together as the second channel with 'ChannelName BF/DF'
      and the entry 'DetectorName 1 Bright Field' was needed to access the signal
      correctly.</P>
    <P><i>For Thermo/FEI STEM,</i> there is no direct control over the insertion of
      detectors; the only way to get the HAADF detector inserted after coming into
      STEM mode is to take an image that uses that detector.&nbsp; The program will
      take an initial dummy picture to insert the detector if there is a
      'NeedShotToInsert' property that lists this detector; 'ShotTimeToInsertDetector'
      controls the delay between this dummy picture and the real acquisition.</P>
    <P><i>For DigiScan in JEOL</i>, unless DM itself manages the insertion and
      selection of detectors, the detectors must be managed through the JEOL
      interface.&nbsp; The ChannelName entries for such managed detectors must be
      placed before the entries for any unmanaged detectors.&nbsp; Their JEOL IDs must
      be listed with the ImageDetectorIDs property (in the same order as their
      ChannelName's appear).&nbsp; Needed delays are set with InsertJeolDetectorDelay
      and SelectJeolDetectorDelay.&nbsp; If one channel in DigiScan receives signals
      from more than one detector, depending on which one is selected, then this
      mapping should be described with a MappedToDSchannel property that gives the
      channel number in DigiScan followed by the detector numbers that feed into that
      channel. Also, if the detector number (in the ChannelName list) of any remaining
      detector does not match its channel number in DigiScan, then there needs to be a
      MappedToDSchannel entry with this detector number and DigiScan channel number.&nbsp;
      Even if each detector has its own channel, this could happen if the detectors
      managed by the JEOL appear after unmanaged ones in DigiScan.</P>
    <P>For either type of STEM, one can also declare that certain detectors cannot be
      used together by listing their numbers on a MutuallyExcludeDetectors entry.&nbsp;
      Detectors already listed in a MappedToChannel entry are automatically considered
      mutually exclusive so there is no need for another entry about them. Together,
      these two kinds of entries determine the number of detectors that can be used
      simultaneously and thus the number of channel combo boxes that appear in the
      Camera Setup dialog.</P>
    <P><i>For DigiScan in JEOL,</i> the DetectorBlocks entry should be used if a
      detector managed by the JEOL physically blocks other detectors; it will cause
      the blocking detector (listed first) to be retracted when any one of the other
      detectors is selected.&nbsp; Retraction is not done automatically just because
      some detectors are mutually exclusive, because this might not be needed.</P>
        <P><i>For JEOL STEM</i>, there should be a &#39;ChannelName&#39; entry for each detector, with
          whatever name is desired.&nbsp; If there is a multichannel interface, the entries must be in the same order that they
          are listed by the plugin or server upon initialization with JEOL camera debugging turned on
          (have DebugOutput set to &#39;j&#39;).&nbsp; If there is a single channel 
          interface with multiple detectors, i.e., if only one detector can be recorded at 
          a time (as in JEOL 2100plus), there should be a property &#39;MappedtoDSChannel 0 0 
          1&#39; to ensure that the plugin or server is initialized with a single-channel 
          interface (add &#39;2&#39;, etc if there are more than two detectors.)&nbsp; 
          &#39;ImageDetectorID&#39; properties are also required with multiple detectors.</P>
<P><i><b>Screen and Camera Management Properties.</b></i> Because of the diversity
  of STEM setups, there are a host of confusing properties to control the behavior
  of the screen and CCD cameras, which may be selected by preference or by
  necessity.&nbsp; These consist of LowerScreenForSTEM (which may be used either
  to lower or to raise the screen, depending on the sign), MustUnblankWithScreen,
  RetractCameraOnEnteringSTEM, and the Order settings in the CameraProperties
  sections.&nbsp; Here are some examples:</P>
    <ul>
      <li>If there is just a retractable lower camera that blanks the beam when it is
        inserted, this can be handled by either setting the Order of the STEM and CCD
        cameras the same to force the CCD to retract when a STEM picture is taken, or by
        setting LowerScreenForSTEM positive, which will make the program lower the
        screen instead.&nbsp; In the latter case, the user can select retraction instead with
        the 'Retract to stop camera blanking' in the STEM Control panel. </li>
      <li>If there is also a GIF camera that will keep blanking as long as it is still
        selected in DigitalMicrograph, then you would need the MustUnblankWithScreen and
        LowerScreenForSTEM entries together.&nbsp; </li>
      <li>If there are detectors under the screen, then you need to have a negative
        entry for LowerScreenForSTEM to get the screen raised when taking a STEM image.&nbsp;
      </li>
      <li>If there are detectors under the screen and the camera needs to be retracted
        as well, this can be handled by setting the Order of STEM and CCD cameras the
        same, by checking 'Retract to stop camera blanking' in the STEM Control panel,
        or by setting the property RetractCameraOnEnteringSTEM.</li>
      <li>If there are detectors under the screen and the microscope overrides the
        camera blanking automatically in STEM mode, then you would use
        RetractCameraOnEnteringSTEM to protect an inserted CCD camera from the beam.&nbsp;
        The beam will be blanked during the retraction.&nbsp; This provides no protection for
        a GIF camera, but presumably the beam scan is much more spread out after passage
        through the GIF.&nbsp; </li>
    </ul>
    <P><i><b>Magnification Table. </b></i>You should run <A HREF="menu_calibration.htm#hid_calibration_listmags">
              List Mags</A> in the Calibration menu even if you are starting with a
      property file containing a STEM magnification table.&nbsp; If you are inserting
      a table into the property file from scratch, precede is with line with
      &#39;STEMMagTable&#39; and the number of magnifications listed.&nbsp; If you are
      substituting one, be sure to change, be sure to adjust the number on the
      &#39;STEMMagTable&#39; line. &nbsp; <i>For a Thermo/FEI scope</i>,
      see the advice in <A HREF="menu_calibration.htm#hid_calibration_listmags">
              List Mags</A> about whether to turn on the 'Enable LMscan' option in the
      microscope STEM interface and include all of the LMscan magnifications.&nbsp; If
      you change your mind about this after doing calibrations and decide to change
      the magnification table, you would have to edit all of the relevant
      magnification indexes in the calibration and property files.&nbsp; <i>On a JEOL</i>,
      if you do not see a correct magnification readout in SerialEM after ensuring
      that the magnification table is correct, you may need the JeolSTEMmagUnitsAreX
      property.</P>
    <P><i><b>Binnings for DigiScan</b></i>. The DigiScan can take square, full-field
      images with almost any chosen number of pixels up to the maximum (8K by 8K).&nbsp;
      SerialEM uses the 'binning' selection to set the number of pixels.&nbsp; The
      binnings are obviously constrained to be integers, but otherwise they can be
      arbitrarily chosen to provide whatever selection of image sizes you find
      convenient.&nbsp; For example, if you have no use for 8K images, you could leave
      out binning 1, or you could set the camera size properties to 4096 instead of
      8192.</P>
        <P><em><strong>Sizes and binnings in multichannel JEOL STEM</strong></em>.&nbsp;
          The JEOL multichannel interface (on the F200 at least) can acquire 4096x4096
          images from one detector, 3072x3072 from two, and 1024x1024 from 3 or 4
          detectors simultaneously.&nbsp; The &#39;MinMultiChannelBinning&#39; property informs
          the program of these restrictions and the camera setup dialog can limit binning
          selections accordingly.&nbsp; If you are satisfied with taking no more than
          2048x2048 from two detectors, you can make the following entries:</P>
        <P>&nbsp;&nbsp;&nbsp;&nbsp; CameraSizeX 4096 <br />
          &nbsp;&nbsp;&nbsp; CameraSizeY 4096 <br />
          &nbsp;&nbsp;&nbsp; MinMultiChannelBinning 2 4 4<br />
          &nbsp;&nbsp;&nbsp; Binnings 1 2 4 8 16 32<br />
        </P>
        <P>However, it is possible to access the full 3072x3072 capability by defining the
          camera as 3 times larger with a minimum binning of 3:</P>
        <P>&nbsp;&nbsp;&nbsp;&nbsp; CameraSizeX 12288 <br />
          &nbsp;&nbsp;&nbsp; CameraSizeY 12288 <br />
          &nbsp;&nbsp;&nbsp; MinMultiChannelBinning 4 12 12<br />
          &nbsp;&nbsp;&nbsp; Binnings 3 4 6&nbsp; 8 12 16 24 32 48</P>
        <P>where you might not want all of those binning values.</P>
      <P><strong>Using the Tietz scan generator.</strong>&nbsp; This STEM interface is 
        identified with a &#39;TietzCameraType&#39; of -1 (the property &#39;STEMcamera&#39; is set 
        automatically).&nbsp; The scan generator uses an internal coordinate system with 
        a range of 65535.&nbsp; SerialEM scales the STEM coordinates that the user sees 
        into a subset of this range, determined by the property &#39;TietzScanRange&#39;.&nbsp; 
        The default is a range of 18500, which will produce full-field scans about the 
        same size as those produced by the native scan generators on Thermo/FEI scopes 
        and some JEOL scopes.&nbsp; General image distortions (i.e., ones other than a 
        distortion at the left size of the scan lines) may be caused by using too large 
        a value.&nbsp; The best way to assess such distortion is to take two images 
        overlapping by half, align them, and toggle between them.&nbsp; If this 
        distortion is a concern, assess it for different ranges and settle on a new 
        value before starting any calibrations.</P>
      <P>Because of this coordinate scaling, the number of pixels specified in 
        properties is somewhat arbitrary, although it must be the same in X and Y.&nbsp; 
        A size of 8192x8192 with binnings up to 32 would provide much flexibility, but 
        you can set it to 4096x4096 to avoid using such high binnings, or you could even 
        set it much higher, like 16384x16384, to have access to fine detail in very 
        small subareas.&nbsp; This is another item that must be settled before doing any 
        calibrations.</P>
      <P>Finally, take an image with recognizable features and compare it with the image 
        on the flu-cam, screen, or another camera.&nbsp; If it is flipped relative to 
        these projections (i.e., cannot be brought to the same orientation with rotation 
        alone), add the property &#39;InvertTietzScan&#39;.</P>
      <P>This is the only STEM interface that provides access to the scan before it is 
        complete and allows it to be aborted.&nbsp; For frame times longer than 0.5 sec 
        (or whatever minimum the property &#39;PartialScanThreshold&#39; specifies), SerialEM 
        will display the scan as it becomes available.&nbsp; If you are acquiring 
        multiple channels, it will let you toggle between them during the scan.&nbsp; 
        The STOP button will stop the acquisition.&nbsp; </P>
    <P><b><i>Camera Timing. </i></b>Run the <A href="menu_calibration.htm#hid_calibration_cameratiming">
      Camera Timing</A> command in the Calibration menu, accepting the default
      parameters for exposure, binning, and number of test images.&nbsp; At the end,
      it will indicate values to be entered for the properties AddedFlybackTime and
      StartupDelay in the CameraProperties section for the STEM camera.&nbsp; <i>For
      Thermo/FEI STEM,</i> the added flyback should be substantial, but applies only to these
      acquisition conditions.&nbsp; <i>For Digiscan,</i> the added flyback should be
      small but is important for keeping DM from crashing. </P>
    <P><i>For Digiscan, </i>as of SerialEM 3.3.1, it should not be necessary to adjust
      DigiScanExtraShotDelay to prevent crashes in DM, and it can be left at its
      default of 100 ms.</P>
    <P><b><i>Rotation angle properties for DigiScan and JEOL.</i></b>&nbsp; One or two
      properties should be set to ensure that future sessions are run under the same
      conditions as when calibrations were done.&nbsp; With a DigiScan, open the
      DigiScan Setup Dialog, and press <b>Advanced</b> to open the DigiScan
      Configuration dialog.&nbsp; There needs to be a general property entry<br />
&nbsp;&nbsp; DigiScanFlipAndRotation n d<br />
      where 'n' is 1 or 0 depending on whether 'Flip Horizontal Scan' is checked or
      not, and 'd' is the value in the 'Rotation Offset' text box.&nbsp; SerialEM
      cannot affect these setting in DigiScan but will warn on startup if they do not
      match the values in this property setting.&nbsp; On JEOL, there need to be a
      general property<br />
&nbsp;&nbsp; JeolSTEMrotation d<br />
      where 'd' is the setting for rotation angle in the JEOL STEM user interface.&nbsp;
      SerialEM will restore the rotation angle to this value when it starts.</P>
    <P><i><b>Initial Rotation Angle Setup.</b></i>&nbsp; SerialEM will assume that all
      images are taken with the scan parallel to the tilt axis, so that dynamic focus
      can be used effectively.&nbsp; One goal of the steps followed here is not just
      to measure the rotation angle of STEM images, but also to adjust it so that this
      assumption is satisfied.&nbsp; The RotationAndPixel and ExtraRotation camera
      properties are used to determine how to rotate the scan to make it parallel to
      the tilt axis.</P>
    <P><i>Rotating to the tilt axis, part 1.</i> If the direction of the scan is not
      somewhere near parallel to the tilt axis, it should be rotated first so that you
      can do the following steps correctly.&nbsp; </P>
      <ol>
      <li>Before you start, make sure that the
      camera properties contain 0 on the ExtraRotation line and on the ImageRotation and
        RotationAndFlip lines, if any, and do not have
      RotationAndPixel lines with non-zero rotations (at least at the magnifications
      you will use).&nbsp; </li>
          <li>Take a STEM image of an area with recognizable features at a
        low enough magnification so that you can move the stage by a few microns and see
        how the image moves.&nbsp; </li>
          <li>Move the stage in positive Y (use a script with
        MoveStage).&nbsp; </li>
          <li>Take another image and note the direction of movement of image
        features relative to the positive Y axis of the image.&nbsp;
        </li>
          <li>Place the the angle from the axis of movement to the Y axis (counterclockwise
        positive) into the &#39;Added rotation&#39; box of the STEM Control
      panel.&nbsp; </li>
          <li>Take another image, move the stage again, take another image, and
        verify that the movement is in the direction of the positive Y axis and along
        the Y axis within about 10 degrees.&nbsp; (Using the X axes instead for this
        measurement will produce the wrong result on a JEOL with omega filter).</li>
          <li>Place the <em>negative</em> of the final value of &#39;Added rotation&#39; into the
        ExtraRotation line of the STEM camera properties and restart the program.</li>
      </ol>
          <P>
      <em>Option 1: Refining tilt axis rotation with a stage calibration.</em> To use
          this method, you need to be at a magnification suitable for doing an accurate
          stage calibration in a few stage moves, have an image area with enough unique
          features, and give the program some idea of what the pixel size is.</P>
      <ol>
      <li> The
          easiest way to set the pixel size is to take an image of the cross-line grating and
          run <a href="menu_calibration.htm#hid_process_findpixelsize">Find Pixel Size</a>
          in the Calibration - Pixel Size submenu at the chosen magnification.&nbsp;
          <li> Run
      <a href="menu_calibration.htm#hid_process_listrelativerotations">List Relative Rotations</a>, copy and paste the RotationAndPixel line into the camera properties, replace
          the second 999 with a 0, and restart the program.&nbsp;
          <li> Then turn off &#39;Whole
          image correlations&#39; to minimize correlation problems, run the stage calibration,
          and make sure it aligns images correctly. The rotation angle that it reports
          should be within ~10 degrees of 0.&nbsp;
          <li> Place the <em>negative</em> of this
          angle in the &#39;Added rotation&#39; box and do another stage calibration to check that
          it produces an angle of essentially 0.&nbsp; You can refine the angle in the
          &#39;Added rotation&#39; box if necessary by <em>subtracting</em> a new reported angle
          from calibration.&nbsp;<li> &nbsp;<em>Subtract</em> the final angle in the &#39;Added rotation&#39; box
          from the value in the ExtraRotation line and restart the program. </li>
          </ol>
    <P><em>Option 2: Refining tilt axis rotation by comparison with another camera</em><i>.</i>
        To use this method, you need another camera at a magnification where you know
        the tilt axis angle, either from the angle in a file header or mdoc file, or
        from the RotationAndPixel relative and absolute angle entries for the
      camera.&nbsp; To get the angle from an absolute calibrated angle at a lower mag,
        <em>add</em> to the absolute angle the relative angles from the mag above the
        calibrated one through the one at the current mag.&nbsp; To get the angle from a
        calibrated one at a higher mag, <em>subtract</em> from the absolute value the
        relative angles from the calibrated mag down to the mag above the current one.&nbsp; </P>
          <ol>
        <li>Put the tilt axis angle into the &#39;Added rotation&#39; box.&nbsp; </li>
              <li>Take an image on
        the other camera and copy it to the Align buffer so that it can be compared
      easily with images in buffer A.&nbsp;</li>
              <li>&nbsp;Take a STEM image of the same area at a
      comparable scale (if you are using a cross-line grating, it is not necessary to
      find the same area).&nbsp; </li>
              <li>You can find the additional rotation that makes the STEM image
      match the other camera image in two different ways.&nbsp; You can estimate the amount
      that the STEM image needs to be rotated, <em>add</em> that into the 'Added rotation' box,
      take another image and use it to adjust the estimate, repeating until the images
      match adequately.&nbsp; Or, you can find two features to draw a line between in
      both images and get an angle for each image (press Shift, click and drag with
      the left mouse button; the angle will be reported in the status bar and in the
      log window).&nbsp; </li>
              <li>The angle to rotate (<em>add</em> to the &#39;Added rotation&#39;
        value) is the angle in the other camera image <em>minus</em> the
      angle in the STEM image.</li>
              <li>&nbsp;After you find the rotation that makes the images
      match, <em>subtract</em> the tilt axis angle of the other camera from the &#39;Added
        rotation&#39; value.&nbsp; The value should be within ~10 degrees of 0.&nbsp;</li>
              <li>&nbsp;Take another image
        to verify that it brings the tilt axis to horizontal.</li>
              <li>&nbsp;Adjust the
        ExtraRotation camera property by <em>subtracting</em> this &#39;Added rotation&#39;
        angle and restart
      SerialEM. </li>
</ol>
      <P>Whichever option you choose, you can test the result by moving the stage a few
          microns in Y: the move should produce a strict upwards movement in the image.</P>
    <P><i>Choosing whether to rotate..</i>&nbsp; You need to make an initial decision
      about whether to have STEM images rotated in SerialEM so that their orientation
      is approximately the same as that of images on the viewing screen or CCD camera.&nbsp;
      Such a rotation needs to be imposed before calibrations are done, because the
      calibrations are valid only if images are at the same orientation as when
      calibrations were done.&nbsp; If there are multiple users with different
      preferences in this regard, they would have to access different property and
      calibration files when running the program.</P>
    <P>If you choose to rotate images, then first take a CCD camera image at a
      magnification where the rotation is typical for your data acquisition.&nbsp;
      Next, take a STEM picture of the same area so that you can determine how much
      the STEM image needs to be rotated to match the orientation of the CCD image,
      rounded to the nearest 90 degrees.&nbsp; Then add a camera property:<br />
&nbsp;&nbsp; RotationAndFlip n<br />
     where 'n' is 1 for 90 degrees counterclockwise, 2 for 180 degrees, and 3 for
        270
      degrees (90 degrees clockwise).&nbsp; Also add the camera property:<br />
&nbsp;&nbsp; ImageRotation d<br />
      where 'd' is the number of degrees of
        counterclockwise rotation imposed by this operation.&nbsp; (You can enter -90
        instead of 270.)&nbsp; This entry is needed to set the tilt axis angle in image
        file headers correctly.&nbsp; That header angle is the sum of ImageRotation, the
        value in the &#39;Added rotation&#39; box (which should be zero after this initial
        setup), and +/-180 if the property &#39;RotateHeaderAxisBy180&#39; is set (which it
        should be for a JEOL with omega filter requiring &#39;InvertStageXAxis&#39; to be set).</P>
      <P><b><i>Pixel Sizes and Rotations.</i></b>&nbsp; Now you are ready to calibrate
      image shift, pixel size, and rotations for whatever range of magnifications you
      will need for taking tilt series and running relating tasks.&nbsp; Because image
      magnification and angle varies with binning, you should set up the Record
      parameters for whatever binning is going to be most typical for data acquisition
      (presumably this will be 1K or 2K images).&nbsp; Go to a magnification where the
      field of view is about 9 microns (20 blocks of the grid).&nbsp; Set the exposure
      time long enough to avoid significant image stretching due to a scan rate too
      high.&nbsp; Do this by taking an image with a long exposure (e.g. 8 seconds),
      putting it in the Align buffer for easy comparison, and then taking images with
      shorter exposure times to find the point at which stretching becomes obvious.&nbsp;
      On a Thermo/FEI the scan rate may need to be under 0.5 micron/msec; on a JEOL with
      DigiScan it can be higher.&nbsp; Then set up the Trial parameters for 512x512
      pixel images and set the exposure time to give a similar or lower scan rate.&nbsp;
      An alternative to this procedure is to set the property
      UseTrialBinningSTEMshiftCal to 1 and set up the Trial parameters for a 1Kx1K
      image, if it seems like a shift calibration from 1K images will be more
      representative.</P>
    <P>Use the cross-line grating and focus it.&nbsp; Start at the lowest
      magnification you want a pixel size for; it can be lower than the one used to
      set the exposure time. Do these steps at each magnification:</P>
    <ol>
      <li>If you are above the magnification where you first set the exposure time, you
        can reduce the exposure time for both Record and Trial to give a scan rate
        similar to the one used at that magnification.</li>
      <li>Calibrate image shift.&nbsp; The first time, it should do it 'from scratch'..</li>
      <li>Take a Record image.</li>
      <li>If you plan to analyze for pixel sizes smaller than can be determined with the
        Find Pixel Size routine, save the Record image once it gets down to about 3
        blocks in the field of view.</li>
      <li>Run <a href="menu_calibration.htm#hid_process_findpixelsize">Find Pixel Size</a>
        in the Calibration - Pixel Size submenu.&nbsp; Correct the result with
        <a href="menu_calibration.htm#hid_process_pixelsizefrommarker">Try Again from Marker</a>
        if necessary.&nbsp; Above a certain magnification, the peaks may become dim and you
        may need to use <a href="menu_calibration.htm#hid_process_setbinnedsize">Set Binned
        Size</a>
        and set the target size for the pixel size analysis to 512.</li>
    </ol>
    <p>
      At the end, run
      <a href="menu_calibration.htm#hid_process_listrelativerotations">List Relative Rotations</a>.&nbsp;
      This will put the relative rotation angles
      and pixel sizes into RotationAndPixel lines that can be inserted into the
      properties file, just as with a
      CCD camera.&nbsp; If you saved images for analyzing higher magnifications, then
      determine pixel sizes and relative rotations from them and complete the
      RotationAndPixel entries.</p>
    <p>
      Set the ExtraRotation to 0 and insert the value that was present there as an
      absolute calibrated angle on one of the RotationAndPixel lines (preferably the
      one for the magnification where you first determined that angle).</p>
    <p>
      In principle, you can refine these rotation angles later by analyzing a tilt
      series in IMOD.&nbsp; The rotation angle solved for by Tiltalign indicates the
      tilt axis angle in the images. (Alternatively, a stage calibration at the right
      magnification could yield an accurate enough value).&nbsp; Either insert this
      angle into the ExtraRotation line or add it to one absolute calibrated angle on
      a RotationAndPixel line. (<i>On a Thermo/FEI scope</i>, the latter should be done if
      you intend to calibrate microprobe mode too.)&nbsp; Run SerialEM in
      Administrator mode and recalibrate one image shift as carefully as was done
      above.&nbsp;&nbsp; Accept the offer to change all other image shift
      calibrations.</p>
    <P>In practice, this detailed calibration of angles is probably worth doing with
      Thermo/FEI STEM but is of questionable value on a JEOL with DigiScan.&nbsp; The problem
      is that the actual scan rotation changes in discrete steps of 1-2.5 degrees, not
      continuously.&nbsp; The calibrations above may correct some of the larger
      rotations between magnification steps but probably not the small ones.</P>
    <P><i><b>Focus-Related Calibrations.</b></i>&nbsp; The autofocus routine needs
      some idea of how fast the beam spreads as focus is changed. The relation between
      Z height and focus must also be calibrated for various purposes, particularly
      for dynamic focusing.</P>
    <P><i>On a JEOL, </i>you must first determine and set the property
      JeolSTEMdefocusFactor.&nbsp; In STEM mode, note the focus readout in the JEOL
      interface and press Reset to reset the defocus in SerialEM.&nbsp; Change the
      focus by about 20 microns.&nbsp; The needed factor is the change in readout in
      the JEOL interface divided by the focus readout in SerialEM.&nbsp; Insert this
      factor into the Properties file and restart SerialEM.</P>
    <P>Make sure the specimen is focused and the Focus parameter set takes good
      pictures.&nbsp; Then run the <A href="menu_calibration.htm#hid_calibration_autofocus">
      Autofocus</A>
      command in the Calibration menu. Accept the defaults for the two queries; if the
      routine reports a problem, check the help for that command.&nbsp; After this
      calibration is run, the autofocus routine should work.&nbsp; Verify this by
      changing focus by a few microns and autofocusing.<P>Next, run the
      <A href="menu_calibration.htm#hid_calibration_stemfocusvsz">STEM Focus Vs. Z</A>
      command in the Calibration menu, using default parameters unless some trouble
      arises.&nbsp; The program will step through Z and focus at each Z level.&nbsp;
      At the end it will indicate the slope of the relationship between Z and defocus
      over several portions of the range.&nbsp; Use this slope to set the property
      STEMdefocusToDeltaZ.&nbsp;
      <i>On a JEOL, </i>use either the value from the fit to the middle of the range,
      or the value over the whole range if the first and second halves give similar
      values (within a few percent).&nbsp; <i>On a Thermo/FEI scope,</i> use the value from
      the fit to the middle of the curve; note that the whole curve is saved as a
      calibration as well. This curve is specific to the current spot size.&nbsp; In
      order to have the correct slope and curve applied when using dynamic focus with
      Thermo/FEI STEM, you need to run this procedure at every spot size where dynamic focus
      might be used.
    <p>
      <i><b>Flyback Times for Thermo/FEI STEM.</b></i>&nbsp; To use dynamic focusing with Thermo/FEI
      STEM, you will need to calibrate the flyback time a number of times, because it
      depends on exposure time, binning, subarea size, and magnification.&nbsp; The
      flyback time is obtained from the camera timing routine, but it is run in a
      special mode with the <A href="menu_calibration.htm#hid_calibration_quick_flyback_time">
      Quick Flyback Time</A> command in the Calibration menu.&nbsp; In this mode, the
      number of pictures is kept to a minimum, and resulting flyback time is stored
      automatically in a file.&nbsp; See <A href="menu_calibration.htm#hid_calibration_quick_flyback_time">
      Quick Flyback Time</A> for more information, advice, and instructions on running
      this command with a script for a series of exposure times.</p>
    <p>
      <b><i>Microprobe mode on Thermo/FEI.</i></b>&nbsp; The magnifications, pixel sizes,
      image shift, and focus-related calibrations are all stored separately for
      microprobe mode and nanoprobe mode.&nbsp; If you are going to use microprobe
      mode, you need to repeat steps above starting with <i>Rotating to the tilt axis</i>
      and continuing with <b>Pixel Sizes and Rotations</b> and <b>Focus-Related
      Calibrations</b>.&nbsp; Note that the magnification indexes for microprobe mode
      are all higher than the ones for nanoprobe mode.&nbsp; The slope of the
      relationship between defocus and Z in microprobe mode is entered as a second
      number on the STEMdefocusToDeltaZ property.&nbsp; If you refine the rotation
      angle calibration with an angle from tilt series alignment or an accurate stage
      calibration, be sure to add the refinement to an absolute calibrated angle on a
      RotationAndPixel line instead of modifying the ExtraRotation entry.</p>
    <p>
      <i><b>MaximumScanRate entries</b></i>.&nbsp; If you add a property defining a
      maximum scan rate (see
      <A HREF="about_properties.htm#per_camera_properties">STEM Camera Properties</A>
      for details), there are two effects. 1) A button becomes available in the Camera
      Setup dialog to increase the exposure time to achieve this scan rate and thus
      obtain images with a predictably limited amount of distortion; 2) Exposure time
      will be increased if necessary in lower magnification tracking tasks in order to
      limit the scan rate to this maximum. It is not known whether the latter feature
      is important for accurate performance of tasks, or whether they will perform
      adequately with distorted images, so it is difficult to say whether this entry
      is needed.&nbsp; However, you should keep this in mind as a possible solution if
      tracking problems do occur with distorted images.&nbsp; You can assess the kind
      of scan rate needed by experimenting with, say, 1Kx1K images of different
      exposure times to see what scan rates give signification shifts and distortions.&nbsp;
      Usually such features begin to appear with rates in the range of 0.5-1
      micron/msec.</p>
    <p>
      &nbsp;</p>
      <P><A name="setup_final"></A><B>Final Tasks (Priority 1)</B></P>
      <P>When you are finished setting things up, check the settings in the system
        (default) settings file. Run 'Open' in the Settings menu and load the file
        SEMsystemSettings.txt from the C:\ProgramData\SerialEM or C:\Program
        Files\SerialEM folder. Check each of the camera parameter
        sets. If the capture areas are wrong (too big, too small, not centered), or the
        binnings are not appropriate for the camera, correct them. You can change any
        other settings that you think appropriate. Exit SerialEM, or just select Save
        in the Settings menu.</P>
    <P>If you only want to use one set of SerialEM settings, just use the
    shortcut provided in C:\ProgramData\SerialEM\ or C:\Program Files\SerialEM
    and copy it to the Desktop or whatever location works best for you.</P>
    <P>If you prefer to have different settings per user/application loaded
    automatically at SerialEM startup, create a subfolder for each set of
    settings (preferrably in C:\ProgramData\SerialEM\UserSettings\ or
    C:\Program Files\SerialEM\UserSettings\) and create shortcuts on the
    Desktop using these folders as described
    in <A HREF="#shortcutsArgs">Shortcuts, Command Line Arguments, and
    Administrator mode</A>.
    <P>&nbsp;</P>
      <P><A name="separate_kv"></A><B>Setting Up for a Separate Voltage</B></P>
      <P>Here is a procedure for setting up the program to be used extensively at a
        different voltage. It assumes you have a 300 kV scope and want to use it at 200
        kV.&nbsp; Note that this procedure was changed in version 3.3.1 so that multiple
        settings files are no longer needed.</P>
      <OL>
        <LI>
        Make a subdirectory "200KV" in the SerialEM folder and copy
        SerialEMproperties.txt and SerialEMcalibrations.txt there - they will both need
        modification but they will provide a starting point.
        <LI>
        Make a copy of your shortcut for starting SerialEM, and rename it, e.g.,
        'SerialEM-200KV'
        <LI>
          Right-click on the new shortcut and select &#39;Properties&#39;.&nbsp; In the &#39;Target&#39;
          box, after the program path in quotes, add a space and &#39;/200KV&#39; <i>without any
          quotes</i>.&nbsp; The forward slash is necessary to keep the system from
          thinking it is a filename and trying to act on it.&nbsp;&nbsp;
        <LI>
        Be sure to have an entry 'SeparateGainReferenceKVs 200' in both the new
        property file and the standard one.
        <LI>
        Also add an entry 'GainReferencePath C:\Program Files\SerialEM' to both
        property files so that all references will be kept in the upper directory. This
        will allow users who switch to another voltage temporarily to access the
        appropriate gain reference and prevent duplicate references from being created
        in both directories.
        <LI>
          You can also place 'WarnIfKVnotAt 300' in the main property file and
          'WarnIfKVnotAt 200' in the 200 kV property file, to keep people from running
          with the wrong properties.</LI></OL>
      <P>Now when you click on the new shortcut, the program will add the argument on
        the &#39;Target&#39; line to the system path entry in the settings file and access the properties and calibrations in the 200KV folder.
        Be sure to make an unbinned gain reference at the lower voltage before trying
        any calibrations. Then, you can calibrate image shift, stage shift, autofocus,
        etc. You will also need to adjust the pixel sizes and rotations in the property
        file.</P>
      <P>Each user who wants to use the program at that voltage will need to have the
        same separate shortcut, with &#39;/200KV&#39; added to the &#39;Target&#39; line. </P>
      <P>Be aware that the 'SeparateGainReferenceKVs' entry causes the kV to be added to
        the gain reference filename, so when you first add this entry any previous
        references will be unavailable (unless you rename them), and if you ever
        comment out the entry the kV-specific references will be unavailable (unless
        you rename them).
      </P>
    <P>&nbsp;</P>
      <P><A name="nanoprobe"></A><B>Setting Up to Use Nanoprobe TEM on a Thermo/FEI Scope</B></P>
      <P>The program can be used in nanoprobe as well as microprobe mode on a Thermo/FEI
        scope.&nbsp; The probe mode is recorded along with other illumination settings
        as part of the Low Dose parameters, in states saved in the Imaging State dialog,
        and as part of the acquisition state for Navigator maps.&nbsp; There are also
        script commands to set and report the probe mode. However, because illumination
        conditions are so different between the two modes, numerous SerialEM
        calibrations are kept track of separately for nanoprobe and microprobe mode.&nbsp;
        Some or all of these calibrations will need to be done in nanoprobe mode to use
        it effectively, depending on the application.&nbsp; The calibrations include:</P>
    <ul>
      <li> <A href="menu_calibration.htm#hid_calibration_beamcrossover">Beam Crossover</A></li>
      <li> <A href="menu_calibration.htm#hid_calibration_c2factor">Set C2 Factor</A> on non-Krios scopes</li>
      <li> <A href="menu_calibration.htm#hid_calibration_beamintensity">Beam Intensity</A></li>
      <li> <A href="menu_calibration.htm#hid_calibration_spotintensity">Spot Intensity</A></li>
      <li> <A href="menu_calibration.htm#hid_calibration_beamshift">Beam Shift</A></li>
      <li> <A href="menu_calibration.htm#hid_calibration_autofocus">Autofocus</A></li>
      <li><A href="menu_tasks.htm#hid_calibration_electrondose">Electron Dose</A></li>
      <li> <A href="menu_calibration.htm#hid_calibration_standardlmfocus">Standard Focus</A>
        if used to set eucentric focus in nonLM</li>
      <li><A href="menu_calibration.htm#hid_autofocusfocus_astigmati">Astigmatism Correction
        by BTID</A></li>
      <li><A href="menu_calibration.htm#hid_autofocusfocus_coma">Old coma-free Alignment
        by BTID</A></li>
      <li><a href="menu_focus.htm#hid_focustuning_comavs">Coma vs. Image Shift</a>
          </li>
    </ul>
    <P>When the microscope returns to one of the probe modes, it reimposes a number of
      settings that were present when it was last in that mode.&nbsp; This includes
      not just the illumination conditions (spot size and intensity) but also image
      shift, defocus and beam shift.&nbsp; Each of these is handled differently.</P>
    <ul>
      <li>SerialEM will simply restore the image shift that was present before the probe
        mode change.&nbsp; </li>
      <li>The net change in defocus is kept track of over the time when the scope is in
        one probe mode.&nbsp; After the scope reimposes the prior defocus when switching
        back to a mode, the program applies this net change to that defocus in two
        circumstances: when the option
        <a href="menu_tasks.htm#hid_specialoptions_adjustfocusonprobechange">Adjust Focus on Probe Mode Change</a>
        in the Tasks-Special Options menu is turned on; or when setting an imaging state with the Navigator or Image State
        dialog.&nbsp; (As of SerialEM 3.7, it no longer applies the change in Low Dose
        mode unless the option is on).</li>
      <li>The change in beam shift is kept track of over the time when the scope is in
        one probe mode.&nbsp; After the scope reimposes the beam shift last seen in a
        mode, the program will convert the change in beam shift to be appropriate for
        the new mode and apply this change in two situations: when switching between low
        dose areas; or when setting an imaging state with the Navigator or Image State
        dialog.&nbsp; </li>
    </ul>
    <p>
      Additional beam shifts can be set for low dose areas.&nbsp; These are handled by
      removing the beam shift for the current area before a probe mode change, then
      applying the shift for the new area after the change.&nbsp; (When there is no
      probe mode change, the change in additional shifts between the two areas is
      applied after all other changes, as usual.)</p>
    <p>
      To center the beam independently in the two modes, set up Trial parameters for a
      condensed beam that can be centered, turn on 'Continuous update of Mag and
      Beam', and change between the modes with a script or in the microscope interface.&nbsp;
    </p>
    <p>
      If you already have different Low Dose modes set up to use different probe
      modes, you can also adjust beam position in each probe mode by the
      following procedure: 1) Zero out the addition beam shift in each Low Dose mode.&nbsp;
      2) Center the beam on one Low Dose mode.&nbsp; 3) Change to the other probe mode
      with a script or in the microscope interface.&nbsp; 4) Go to the other Low Dose
      mode (by taking an image or by dropping the screen) and center the beam there.&nbsp;
      5) Switch back to the other probe mode.&nbsp; 6) Go back to the other Low Dose
      mode.&nbsp; After establishing the basic beam position in each mode with this
      procedure, you can then apply additional beam shifts as necessary.</p>
      <P>&nbsp;</P>
        <p><a name="apertures"></a><B>Controlling Apertures on Thermo/FEI Scopes &nbsp;</B><BR>
          <p>SerialEM can control apertures on Thermo/FEI scopes using Microsoft 'UI 
            Automation' instead of with Thermo/FEI scripting commands.&nbsp;For this to work, the 
            microscope software must be running on Windows 7 or above, the TEM user 
            interface must not be minimized, and the Apertures panel must be included on 
            some tab in the Workset area of the TEM user interface.&nbsp; The tab will be 
            switched to if that panel is not currently visible.&nbsp; The UI Automation alone 
            cannot change an aperture size in Windows 7, and in some Windows 10 systems.&nbsp; 
            In these cases, copy the compiled AutoIT program SEM-AutoIT.exe from the 
            SerialEM program package to either the directory with the SerialEM executable 
            (when running directly on the scope) or to the same location as 
            FEI-SEMserver.exe, when running through that.&nbsp; If desired, you can place 
            this file elsewhere and define the environment variable SEM_AUTOIT_DIR with the 
            full path to that location.</p>
      <p>When changing size fails on these systems, the TEM interface will show the 
        desired change.&nbsp; To assess whether this is happening on a Windows 10 
        system, go to a lower magnification where you can see the objective aperture in 
        an image, and use a script command 'SetApertureSize 2 X' to change the size to 
        'X'.&nbsp; Aperture control has been found not to work on more than one Glacios and 
        at least one Krios running Windows 10 when using the UI Automation.</p>
      <p>By default, SEM-AutoIT will select an aperture by its index on Windows 7 and by 
        its size on Windows 10, because selecting by index failed on some Windows 10 
        systems (the same ones where UI Automation fails).&nbsp; The disadvantage of 
        selecting by size is that if the size passed in does not match an available 
        size, either no change will occur or it will select an aperture with the same 
        starting digit, and no error message is generated.&nbsp; An environment 
        variable, FEISEM_APERTURE_BY_SIZE, can be set on the microscope computer to 1 to 
        make the program select by size on Windows 7, or to 0 to make it select by index 
        on Windows 10.&nbsp; As always, restart FEI-SEMserver.exe after changing any of 
        the relevant environment variables.</p>
      <p>The aperture operations, and 'ReportSlotStatus', will hang FEI-SEMserver.exe on 
        some Windows 7 systems, even though they work when SerialEM is running directly 
        on the scope computer. &nbsp; If this occurs, set the environment variable 
        FEISEMSERVER_AUTOMATION to 0 to prevent any automation-based operations from 
        being attempted.&nbsp; </p>
      <p>Finally, the UI Automation uses both a &quot;Select&quot; and an &quot;Invoke&quot; call to set the 
        aperture size because that works on most systems, but at least one site needed 
        to have only the Select call.&nbsp; Two environment variables can be set to 
        control whether it calls just one or both: FEISEM_NO_INVOKE_APERTURE to use just 
        Select, or FEISEM_NO_SELECT_APERTURE to use just Invoke.</p>
      <p>For Thermo/FEI server version 7.18.1 and higher, the new 
        UTAPI scripting can be used to control the apertures, provided that a license is 
        installed.&nbsp; Access to this 
        scripting is activated with a property 'UseUtapiScripting 1'.</p>
      <p>&nbsp;</p>
        <p><a name="alpha_beamshift"></a><B>Alpha and Beam Shift Calibration Issues on JEOL scopes &nbsp;</B><BR>
          </p>
      <P>
        Beam shift calibration is problematic on higher-end JEOL scopes because of two
        factors: the effectiveness of beam shift can be very different at different
        alpha values; and the effectiveness of beam shift can change abruptly between
        two magnifications, as well as change gradually within a magnification range.</P>
    <P>
      The initial movement of the beam in the
      <a href="menu_calibration.htm#hid_calibration_beamshift">beam shift calibration</a>
      should be at least 10 pixels to get an accurate enough estimate of the scaling
      for the second round of movements.&nbsp; Overall this movement is controlled by
      the property JEOLBeamShiftToMicrons, but this property actually sets the
      universal scaling of beam shift deflector values to the units used in the
      program, so it must not be changed after doing a successful calibration.&nbsp;
      Instead, the property BeamShiftCalAlphaFactors can be used to adjust the scaling
      for the initial movement independently for each alpha.&nbsp; (See the section on
      <a href="about_properties.htm#JeolBeamShift">JEOL beam shift properties</a> for
      more details).&nbsp;
    </P>
    <P>
      The problem of the beam shift calibration changing can be handled by defining
      one or more beam shift boundaries and calibrating beam shift separately in the
      magnification ranges defined by the boundaries.&nbsp; Ideally, you should
      calibrate beam shift in the middle of the magnification range where such a
      calibration applies and is to be used.&nbsp; Once you have a calibration, you
      can check how well it applies at other (typically lower) magnifications by the
      following procedure:</P>
    <ol>
      <li>Adjust beam size and position so that an edge of the beam is in the periphery
        of a camera image.</li>
      <li>Click with the left mouse button to set the marker on the edge of the beam</li>
      <li>Run Move Beam in the Tasks menu (hot key Shift-M).</li>
      <li>Take an image.&nbsp; The beam edge should be near the center of the image.&nbsp;
        Its distance from the center indicates the degree of inaccuracy in the
        calibration when used at that magnification.</li>
    </ol>
    <P>
      Errors up to about 10% are to be expected; at a beam shift boundary the error
      will typically be 20% or more.&nbsp; When you find a boundary, add a general
      property 'BeamShiftBoundaries' with the index of the magnification above the
      boundary and restart the program.&nbsp; You will now be able to calibrate beam
      shift around the middle of the magnification range where it applies (to minimize
      the inaccuracy at the ends of that range), and the appropriate magnification
      will be used for all magnifications in each range.</P>
    <P>
      When using image shift deflectors for image shift, you might be able to
      accomplish the same thing with an image shift boundary (defined with
      OtherShiftBoundaries), but these boundaries are not the same in general and are 
      not treated as beam shift boundaries in the program.&nbsp; Using a beam shift boundary
      guarantees that the right beam shift calibration is used regardless of where the
      image shift boundaries are.&nbsp; When using PLA for image shift, you can
      actually store a calibration at each magnification, but defining a beam shift
      boundary is the only way to make sure the program uses the calibration
      appropriate for a given magnification.</P>
    <P>
      If you <a href="menu_calibration.htm#hid_beamspot_refinebeamshift">refine the 
      beam shift calibration</a>, the calibration will be stored without removing 
      another calibration in the same magnification range, and will not be replaced 
      when the either the initial or refining calibration is done for a different 
      magnification in that range.&nbsp; Thus, there can be refined calibrations for 
      multiple magnifications in a range.</P>
    <P>
      &nbsp;</P>
    <P><A name="using_gpu"></A><B>Setting Up to Use a GPU for Frame Alignment</B></P>
    <P>Frame alignment can happen in two places: in the SerialEMCCD plugin to
      DigitalMicrograph for K2/K3 and OneView/Rio cameras, and in SerialEM itself for Falcon, DE, and Tietz
      cameras.&nbsp; The GPU of an NVIDIA card can be used if the module FrameGPU.dll
      and the matching CUDA libraries are found in the right place: in the same folder
      as the SerialEMCCD plugin or the SerialEM executable, respectively.&nbsp; To enable
      GPU use:</P>
    <ol>
      <li>Get FrameGPU-CUDA8.exe from the SerialEM download site.&nbsp; If this does not work, 
        next try the CUDA 6 version.&nbsp; The CUDA 4 version is still available in FrameGPU-CUDA4.exe, but can no longer be built
        after changes to make the framealign code compatible with CUDA 12, 
        so this package will become either out-of-date or unusable when there is a substantive change in 
        the module.&nbsp; Use it only if the CUDA 6 and CUDA 8 packages do not work, and let us know if that
        is the case.
        </li>
      <li>Run the package.&nbsp; Extract the files to
      C:\ProgramData\Gatan\Plugins\Shrmemframe for use with a Gatan camera, or to C:\Program Files\SerialEM
      or other SerialEM install location for DE, Falcon, and Tietz.</li>
      <li>Restart DigitalMicrograph for a Gatan camera. </li>
      <li>Restart SerialEM.&nbsp; There should be a message in the log that the
        GPU IS available for frame alignment for the relevant camera.&nbsp; For GMS 3.42
        and above, there may be a message in the DM Output window about failure to
        access the GPU directly; if so, this should be followed by a message that the
        GPU is accessible through the Shrmemframe program.&nbsp; This is slightly
        suboptimal because frames have to be passed through shared memory, but at least
        the GPU is then working.&nbsp; The GPU files are now placed in the Shrmemframe
        folder instead of the Plugins folder; that arrangement also allows direct GPU
        access by the plugin if that still works.&nbsp; In one site with GMS 3.53, the 
        CUDA 8 version was directly accessible while the CUDA 6 version was not, hence 
        the advice to try CUDA 8 first.</li>
      <li>To see debug output from frame alignment, get diagnostic information about a failure to connect to
        the GPU, or just to determine what CUDA version the Nvidia driver supports:</li>
        <ul>
        <li>For a Gatan camera, add or set the property &#39;StartCameraInDebugMode 1&#39;.&nbsp; Close
          SerialEM and DM. Restart
          DM then SerialEM.&nbsp; There will be several lines from the framealign module in the DM
          Output window as it looks for GPUs.&nbsp; To get timing output from the plugin
          during alignment, however, you need to set the environment variable
          SERIALEMCCD_DEBUG to 10.</li>
        <li>For Falcon, DE, and Tietz, set the property DebugOutput to 'E', 'D', or 'T', respectively,
          and restart SerialEM. The initial lines from framealign will appear in the
          SerialEM log, including the runtime version (the CUDA version of FrameGPU that 
          you installed) and the driver CUDA version.&nbsp; Timing output will also go into the log.</li>
        </ul>
    </ol>
    <P>The SerialEM install package comes with files named FrameGPU4.dll and
      FramGPU8.dll for the two CUDA versions.&nbsp; When you update SerialEM, the
      installer will update FrameGPU.dll as long as it can tell which CUDA version you
      have libraries for.&nbsp; This module MUST be named FrameGPU.dll to be loaded by
      the framealign module.</P>
    <P>&nbsp;</P>
    <P><A name="adding_nvidia"></A><B>Adding an NVIDIA card to a K2/K3 Computer</B></P>
    <P>If you are using the frame alignment module in the SerialEMCCD plugin to
      DigitalMicrograph for aligning K2 frames, you can speed up this processing by
      using the GPU of an NVIDIA card added to the computer.&nbsp; The K3
      computer by default comes with a low-end K2200 card, but much better
      performance will be obtained with a more powerful card.  Alignment with
      the GPU was considerably improved in SerialEM 3.7 by
      moving the initial processing from CPU to GPU, so the speedup from more
      powerful cards is more apparent.
      Because most of the
      processing is done as frames become available from DM, the speed gains
      from the GPU are somewhat limited with a K2 (where frames become available
      slowly).&nbsp; </P>
    <P>For example, with a&nbsp;
      Quadro P2000 in GMS 3.2, acquiring and aligning 14 super-resolution
      0.1 sec frames takes 10.0 sec
      with CPU and 6.8 sec with GPU; 14 counting mode frames take 5.5 sec with
      CPU and 5.0 sec with GPU.&nbsp; The optimized design of the K3 makes the
      gains from having a GPU be a larger fraction of the overall acquire
      time.&nbsp; With the GP100 included when the K3 comes with the MotionCor2
      option, acquiring and aligning 14 frames of 0.05 sec takes 10 sec on CPU
      and only 2.9 sec on GPU.
      Most of these gains can be achieved by mid-high range cards and it is not necessary
      to have one of the most powerful cards.&nbsp; Specifically, there is no need to
      have a dedicated GPU card, so in the K2 the NVIDIA card can serve as the
      graphics card and substitute for the ATI card that comes with the
      computer.</P>
    <P>With a K3, the situation is easy.  There should be two open spots for a
    double-height graphics card, plus space for a double-height card where the
    K2200 is.  It is probably better to add a card and leave the K2200 to run
    the display.  The frame alignment module will automatically pick the more
    powerful card.  A GTX 1080 Ti would be a good choice, or a mid-range
      GeForce card down to a 1060 if cost is an issue.</P>
    <P>With a K2, you have to choose between substituting a single-height card
    for the existing graphics card, and moving cards around to create space for
    a more powerful double-height card.
    A typical arrangement of cards in the K2 computer is:</P>
    &nbsp;
    <div dir="ltr">
      <div class="gmail_quote">
        <div lang="EN-US" link="blue" vlink="purple">
          <div>
            <table border="1" cellpadding="0" cellspacing="0"
              style="width:5.2in;margin-left:.75in;border-collapse:collapse;border:none"
              width="624">
              <tr>
                <td style="width:134.85pt;border:solid windowtext
                      1.0pt;padding:0in 5.4pt 0in 5.4pt" valign="top" width="225">
                  <p style="margin-left:0in">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">Slot 7: PCI-E 3.0 x8 </span>
                  </p>
                </td>
                <td style="width:85.65pt;border:solid windowtext
                      1.0pt;border-left:none;padding:0in 5.4pt 0in
                      5.4pt" valign="top" width="143">
                  <p style="margin-left:3.75pt;text-indent:4.5pt">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">Processor 2</span></p>
                </td>
                <td style="width:153.9pt;border:solid windowtext
                      1.0pt;border-left:none;padding:0in 5.4pt 0in
                      5.4pt" valign="top" width="257">
                  <p style="margin-left:0in;text-indent:12.6pt">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">SATA to eSATA Bracket</span></p>
                </td>
              </tr>
              <tr>
                <td style="width:134.85pt;border:solid windowtext
                      1.0pt;border-top:none;padding:0in 5.4pt 0in 5.4pt" valign="top"
                  width="225">
                  <p style="margin-left:0in">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">Slot 6: PCI-E 3.0 x8 </span>
                  </p>
                </td>
                <td style="width:85.65pt;border-top:none;border-left:none;border-bottom:solid
                      windowtext 1.0pt;border-right:solid windowtext
                      1.0pt;padding:0in 5.4pt 0in 5.4pt" valign="top" width="143">
                  <p style="margin-left:3.75pt;text-indent:4.5pt">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">Processor 2</span></p>
                </td>
                <td style="width:153.9pt;border-top:none;border-left:none;border-bottom:solid
                      windowtext 1.0pt;border-right:solid windowtext
                      1.0pt;padding:0in 5.4pt 0in 5.4pt" valign="top" width="257">
                  <p style="margin-left:0in;text-indent:12.6pt">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">&nbsp;</span></p>
                </td>
              </tr>
              <tr>
                <td style="width:134.85pt;border:solid windowtext
                      1.0pt;border-top:none;padding:0in 5.4pt 0in 5.4pt" valign="top"
                  width="225">
                  <p style="margin-left:0in">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">Slot 5: PCI-E 3.0 x8</span></p>
                </td>
                <td style="width:85.65pt;border-top:none;border-left:none;border-bottom:solid
                      windowtext 1.0pt;border-right:solid windowtext
                      1.0pt;padding:0in 5.4pt 0in 5.4pt" valign="top" width="143">
                  <p style="margin-left:3.75pt;text-indent:4.5pt">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">Processor 2</span></p>
                </td>
                <td style="width:153.9pt;border-top:none;border-left:none;border-bottom:solid
                      windowtext 1.0pt;border-right:solid windowtext
                      1.0pt;padding:0in 5.4pt 0in 5.4pt" valign="top" width="257">
                  <p style="margin-left:0in;text-indent:12.6pt">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">UPPER NIC</span></p>
                </td>
              </tr>
              <tr>
                <td style="width:134.85pt;border:solid windowtext
                      1.0pt;border-top:none;padding:0in 5.4pt 0in 5.4pt" valign="top"
                  width="225">
                  <p style="margin-left:0in">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">Slot 4: PCI-E 3.0 x16</span></p>
                </td>
                <td style="width:85.65pt;border-top:none;border-left:none;border-bottom:solid
                      windowtext 1.0pt;border-right:solid windowtext
                      1.0pt;padding:0in 5.4pt 0in 5.4pt" valign="top" width="143">
                  <p style="margin-left:3.75pt;text-indent:4.5pt">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">Processor 2</span></p>
                </td>
                <td style="width:153.9pt;border-top:none;border-left:none;border-bottom:solid
                      windowtext 1.0pt;border-right:solid windowtext
                      1.0pt;padding:0in 5.4pt 0in 5.4pt" valign="top" width="257">
                  <p style="margin-left:0in;text-indent:12.6pt">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">Graphics card</span></p>
                </td>
              </tr>
              <tr>
                <td style="width:134.85pt;border:solid windowtext
                      1.0pt;border-top:none;padding:0in 5.4pt 0in 5.4pt" valign="top"
                  width="225">
                  <p style="margin-left:0in">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">Slot 3: PCI-E 3.0 x8</span></p>
                </td>
                <td style="width:85.65pt;border-top:none;border-left:none;border-bottom:solid
                      windowtext 1.0pt;border-right:solid windowtext
                      1.0pt;padding:0in 5.4pt 0in 5.4pt" valign="top" width="143">
                  <p style="margin-left:3.75pt;text-indent:4.5pt">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">Processor 1</span></p>
                </td>
                <td style="width:153.9pt;border-top:none;border-left:none;border-bottom:solid
                      windowtext 1.0pt;border-right:solid windowtext
                      1.0pt;padding:0in 5.4pt 0in 5.4pt" valign="top" width="257">
                  <p style="margin-left:0in;text-indent:12.6pt">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">LOWER NIC</span></p>
                </td>
              </tr>
              <tr>
                <td style="width:134.85pt;border:solid windowtext
                      1.0pt;border-top:none;padding:0in 5.4pt 0in 5.4pt" valign="top"
                  width="225">
                  <p style="margin-left:0in">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">Slot 2: PCI-E 3.0 x8 </span>
                  </p>
                </td>
                <td style="width:85.65pt;border-top:none;border-left:none;border-bottom:solid
                      windowtext 1.0pt;border-right:solid windowtext
                      1.0pt;padding:0in 5.4pt 0in 5.4pt" valign="top" width="143">
                  <p style="margin-left:3.75pt;text-indent:4.5pt">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">Processor 1</span></p>
                </td>
                <td style="width:153.9pt;border-top:none;border-left:none;border-bottom:solid
                      windowtext 1.0pt;border-right:solid windowtext
                      1.0pt;padding:0in 5.4pt 0in 5.4pt" valign="top" width="257">
                  <p style="margin-left:0in;text-indent:12.6pt">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">MegaRAID</span></p>
                </td>
              </tr>
              <tr>
                <td style="width:134.85pt;border:solid windowtext
                      1.0pt;border-top:none;padding:0in 5.4pt 0in 5.4pt" valign="top"
                  width="225">
                  <p style="margin-left:0in">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">Slot 1: PCI-E 3.0 x8</span></p>
                </td>
                <td style="width:85.65pt;border-top:none;border-left:none;border-bottom:solid
                      windowtext 1.0pt;border-right:solid windowtext
                      1.0pt;padding:0in 5.4pt 0in 5.4pt" valign="top" width="143">
                  <p style="margin-left:3.75pt;text-indent:4.5pt">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">Processor 1</span></p>
                </td>
                <td style="width:153.9pt;border-top:none;border-left:none;border-bottom:solid
                      windowtext 1.0pt;border-right:solid windowtext
                      1.0pt;padding:0in 5.4pt 0in 5.4pt" valign="top" width="257">
                  <p style="margin-left:0in;text-indent:12.6pt">
                    <span style="font-family:&quot;Times New
                          Roman&quot;,&quot;serif&quot;">FireWire</span></p>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
    <P>Slots are numbered from the bottom as in this table. There are two basic
      options: 1) get a single-height card, which can be substituted in slot 4 without
      any other rearrangements; 2) get a more powerful or cost-effective double-height
      card, which must occupy slots 3 and 4 and requires having one free slot and
      rearranging other cards.&nbsp; If you have no free slots, you may find that one
      of the cards is a Firewire card with nothing connected, which you can remove to
      free up a slot.&nbsp; Slot 7 is too short to fit anything else useful. </P>
    <P>The constraints when installing an NVIDIA card are these:</P>
    <ul>
      <li>The NVIDIA card must go in slot 4; this is the only one with enough memory
        bandwidth.</li>
      <li>The Upper and Lower NIC cards must stay on separate processors.</li>
      <li>If a NIC card is moved at all, its configuration must be restored afterwards.</li>
    </ul>
    <p>
      1) If you get a single-height card and your graphics card is already in slot 4,
      the process is simple; just substitute the card.&nbsp; Unfortunately
      single-height cards have limited capability.&nbsp; The best ones available as of
      Jan. 2019 are all Quadro cards, which all have worse price/performance ratios
      than GeForce cards (typically around a factor of two worse). The choices are:</p>
    <table class="style11">
      <tr>
        <td class="style12">
          Card</td>
        <td class="style12">
          Price</td>
        <td class="style12">
          Cores</td>
        <td class="style12">
          Memory</td>
        <td class="style12">
          Mem. bandwidth</td>
        <td class="style12">
          Power</td>
      </tr>
      <tr>
        <td>
          P1000</td>
        <td>
          $300</td>
        <td>
          640</td>
        <td>
          4 GB</td>
        <td>
          82 GB/s</td>
        <td>
          47 w</td>
      </tr>
      <tr>
        <td>
          P2000</td>
        <td>
          $450</td>
        <td>
          1024</td>
        <td>
          5 GB</td>
        <td>
          140 GB/s</td>
        <td>
          75 w</td>
      </tr>
      <tr>
        <td>
          P4000</td>
        <td>
          $750</td>
        <td>
          1792</td>
        <td>
          8 GB</td>
        <td>
          243 GB/s</td>
        <td>
          105 w</td>
      </tr>
      <tr>
        <td>
          RTX4000</td>
        <td>
          $950</td>
        <td>
          2304</td>
        <td>
          8 GB</td>
        <td>
          ?</td>
        <td>
          160 w</td>
      </tr>
    </table>
    <P>Most likely these choices will evolve into a set of RTX cards.</P>
    <P>2) If you want to get more performance for the money with a double-height
      GeForce card, you must move a card out of slot 3, which will typically be a NIC.&nbsp;
      This NIC must stay on processor 1, not be moved to slot 6 if it is empty.&nbsp;
      Some possibilities are</P>
    <ul>
      <li>Slot 1 is empty: move the NIC from slot 3 to slot 1</li>
      <li>Move the FireWire from slot 1 to slot 6, move the NIC to slot 1</li>
      <li>Remove the FireWire card from slot 1 and move the NIC to slot 1</li>
      <li>Move the MegaRAID from slot 2 to slot 6 and move the NIC from slot 3 to slot 2</li>
    </ul>
    <p>
      In any case, you must reconfigure the NIC after moving it.&nbsp; Access the
      configuration with Control Panel - Device Manager - Network adapters, click on
      Myricom Myri-10G Ethernet Adapter and switch to the Advanced tab.&nbsp; Check
      the settings for each of the 4 adapters against this reference before moving the
      card.&nbsp; Afterwards, you will need to restore two of them:</p>
    <pre wrap="">IP Addresses:
- LOWER NIC:
192.168.211.1 (set name to 'K2 Base')
192.168.211.2 (set name to 'K2 Lower')
- UPPER NIC:
192.168.211.3 (set name to 'K2 Upper')

Device Settings:
   Adaptive Interrupt Moderation (AIM):		Disabled
   AIM Max Idle Time:				10
   AIM Max Period:				0
* Custom RSS Hash:				IPv4
   Degraded PCI-E Link:				Denied
   Flow Control:					Off
* Interrupt Coalescing Delay:			500
   IPv4 Checksum Offload:			Rx Enabled
   Large Send Offload v2 (IPv4):			Enabled
   Large Send Offload v2 (IPv6):			Enabled
   Locally Administered Address:		Not Present
   Log Link State Event:				Enabled
* MTU:						9000
* Receive Buffers:				16384
   RSS:						Enabled
* RSS Queues:				      8
   Strip VLAN Tags:				On
   TCP Checksum Offload (IPv4):		Rx &amp; Tx Enabled
   TCP Checksum Offload (IPv6):		Rx &amp; Tx Enabled
   UDP Checksum Offload (IPv4):		Rx &amp; Tx Enabled
   UDP Checksum Offload (IPv6):		Rx &amp; Tx Enabled
   VLAN ID:					0

* Denotes a parameter modified from default value.
</pre>
    <p>
      You also need to install NVIDIA drivers downloaded from the NVIDIA web site.&nbsp;
      You can do this either just before or just after the card swap.</p>
    <p>
      Unplug the computer after turning it off.&nbsp; You should use a grounding strap
      or other anti-static precautions while transferring the video card from its
      protective packaging to the computer.</p>
    <p>
      Follow the instructions in <a href="#using_gpu">Setting Up to Use a GPU for Frame Alignment</a>
      to install the FrameGPU.dll module and CUDA runtime libraries.</p>
    <P>&nbsp;</P>
      <P><A name="using_film_setup"></A><B>Using Film</B></P>
      <P>There are several script commands that allow taking pictures on film. One problem
        encountered on Tecnais is that the display may not recover from the automatic
        screen dimming unless you move the mouse. You can solve this by editing the
        registry. From the Start menu, select Run and enter 'regedit'. You want to find
        the key
        'HKEY_LOCAL_MACHINE\SOFTWARE\Thermo/FEI\BrickBox\Configurations\tem\default\MdlScreenDim\MdlScreenDimMgr\ScreenDim'
        You can use 'Ctrl-F' and F3 to search for the text 'ScreenDim' until you find
        an entry under 'MdlScreenDimMgr, although this is tedious. In Tecnai version 2
        (Windows 2000), the key 'PowerSaveSupported' already exists under 'ScreenDim':
        double click on it, or right click and select 'Modify', then change its value
        from 1 to 0. In Tecnai version 3 (Windows XP), you need to add the key. To do
        this, right click on 'ScreenDim' in the left panel (the tree display) and
        select 'New - DWORD value' Then change the name of 'New Value #1' to
        'PowerSaveSupported' and leave the value as 0.</P>
      <P>On the Tecnai, it is also possible to set a delay between the loading of the
        plate and the exposure, and to have a pre-exposure of the specimen before the
        film is exposed. To access these features, the server module 'adaexp.exe' must
        be installed. This module is used by Leginon, so if you have Leginon, you are
        all set. Otherwise, the right version of the module for your microscope needs
        to be obtained from Max Otten at Thermo/FEI. (The wrong version will do bad things
        like disable the HT until the computer is rebooted.)</P>
    <P>&nbsp;</P>
    <P><A name="package_files"></A><B>Files in the SerialEM Install Package</B></P>
    <P>The SerialEM_4-1-x.exe package will create a subfolder SerialEM_4-1-x under
      C:\Program Files\SerialEM with the following files (not all included in a 64-bit
      SerialEM package).&nbsp; The &#39;Microsoft.VC140&#39; folder and all of the DLL&#39;s above
      that line below are required for SerialEM to run.</P>
    <table class="style1">
        <tr>
          <td class="style2">
            SerialEM.DontRunHere.bin</td>
          <td class="style3">
            The SerialEM executable, which is renamed to SerialEM.exe for use.&nbsp; It will
            not run in this folder unless multiple scope plugins are removed.</td>
        </tr>
        <tr>
          <td class="style2">
            libifft-MKL.dll</td>
          <td class="style3">
            FFT library incorporating Intel Math Kernel Library FFT routines</td>
        </tr>
        <tr>
          <td class="style2">
            libctffind.dll</td>
          <td class="style3">
            Library based on Ctffind4, compiled in IMOD for better performance</td>
        </tr>
        <tr>
          <td class="style2">
            libmmd.dll</td>
          <td class="style3">
            Intel math libary</td>
        </tr>
        <tr>
          <td class="style2">
            libiomp5md.dll</td>
          <td class="style3">
            Intel OpenMP library</td>
        </tr>
        <tr>
          <td class="style2">
            hdf5.dll</td>
          <td class="style3">
            Library for HD5 files</td>
        </tr>
        <tr>
          <td class="style2">
            imodzlib1.dll</td>
          <td class="style3">
            Library needed by hdf5.dll</td>
        </tr>
        <tr>
          <td class="style2">
            msvcp120.dll</td>
          <td class="style3">
            Library needed by libctffind.dll and ctfplotter.exe, compiled with Visual Studio 2013</td>
        </tr>
        <tr>
          <td class="style2">
            msvcr120.dll</td>
          <td class="style3">
            Library needed by libctffind.dll and ctfplotter.exe</td>
        </tr>
        <tr>
          <td class="style2">
            Microsoft.VC140</td>
          <td class="style3">
            Folder with DLL&#39;s for running the program compiled with Visual Studio 2015</td>
        </tr>
        <tr>
          <td class="style2">
            SerialEM.chm</td>
          <td class="style3">
            The help file</td>
        </tr>
        <tr>
          <td class="style2">
            ctfplotter.exe</td>
          <td class="style3">
            Ctf fitting program from IMOD</td>
        </tr>
        <tr>
          <td class="style2">
            ctfplotter.adoc</td>
          <td class="style3">
            Options file for this version of Ctfplotter</td>
        </tr>
        <tr>
          <td class="style2">
            svml_dispmd.dll</td>
          <td class="style3">
            Intel library needed by Ctfplotter</td>
        </tr>
        <tr>
          <td class="style2">
            FEIScopePlugin.dll</td>
          <td class="style3">
            A plugin for communicating with a Thermo/FEI microscope locally or remotely</td>
        </tr>
        <tr>
          <td class="style2">
            FEI-SEMserver.exe</td>
          <td class="style3">
            A server that is copied to a remote Thermo/FEI microscope computer and run there</td>
        </tr>
        <tr>
          <td class="style2">
            FEI-SEMserver-Win2K.exe</td>
          <td class="style3">
            A server version that will run on Windows 2000 and may be needed for some scopes 
            on Windows XP before SP3.</td>
        </tr>
        <tr>
          <td class="style2">
            SEM-AutoIT.exe</td>
          <td class="style3">
            A compiled AutoIT script for controlling apertures on Thermo/FEI scopes running 
            Windows 7 or 10 where built UI automation does not work</td>
        </tr>
        <tr>
          <td class="style2">
            JeolScopePlugin.dll</td>
          <td class="style3">
            A plugin for communicating with a JEOL microscope</td>
        </tr>
        <tr>
          <td class="style2">
            HitachiPlugin.dll</td>
          <td class="style3">
            A plugin for communicating with a Hitachi HT7700/HT7800 microscope</td>
        </tr>
        <tr>
          <td class="style2">
            ShMemSEMserver.exe</td>
          <td class="style3">
            A server for shared memory values that is copied to the HT7700 /HT7800 computer when
            running on another computer</td>
        </tr>
        <tr>
          <td class="style2">
            SerialEMCCD.dll</td>
          <td class="style3">
            The plugin to DigitalMicrograph for GMS 1.x</td>
        </tr>
        <tr>
          <td class="style2">
            SEMCCD-GMS2.0-32.dll</td>
          <td class="style3">
            The plugin to DigitalMicrograph for 32-bit GMS 2.0 - 2.2</td>
        </tr>
        <tr>
          <td class="style2">
            SEMCCD-GMS2.3-32.dll</td>
          <td class="style3">
            The plugin to DigitalMicrograph for 32-bit GMS 2.3 and above</td>
        </tr>
        <tr>
          <td class="style2">
            SEMCCD-GMS2.31-64.dll</td>
          <td class="style3">
            The plugin to DigitalMicrograph for 64-bit GMS 2.31 - 3.2</td>
        </tr>
        <tr>
          <td class="style2">
            SEMCCD-GMS3.01-64.dll</td>
          <td class="style3">
            The plugin to DigitalMicrograph for GMS 3.01 - 3.30</td>
        </tr>
        <tr>
          <td class="style2">
            SEMCCD-GMS3.31-64.dll</td>
          <td class="style3">
            The plugin to DigitalMicrograph for GMS 3.31 - 3.3x</td>
        </tr>
        <tr>
          <td class="style2">
            SEMCCD-GMS3.42-64.dll</td>
          <td class="style3">
            The plugin to DigitalMicrograph for GMS 3.4</td>
        </tr>
        <tr>
          <td class="style2">
            SEMCCD-GMS3.50-64.dll</td>
          <td class="style3">
            The plugin to DigitalMicrograph for GMS 3.5</td>
        </tr>
        <tr>
          <td class="style2">
            SEMCCD-GMS3.60-64.dll</td>
          <td class="style3">
            The plugin to DigitalMicrograph for GMS 3.6</td>
        </tr>
        <tr>
          <td class="style2">
            SerialEMCCDps.dll</td>
          <td class="style3">
            A&nbsp;DLL for communicating with the plugin for GMS 1.x</td>
        </tr>
        <tr>
          <td class="style2">
            SEMCCDps-GMS2-32.dll</td>
          <td class="style3">
            A&nbsp;DLL for communicating with the plugin for both 32-bit and 64-bit GMS 2-3</td>
        </tr>
        <tr>
          <td class="style2">
            SEMCCDps-GMS2-64.dll</td>
          <td class="style3">
            A&nbsp;DLL for communicating with the plugin for 64-bit GMS 2-3</td>
        </tr>
        <tr>
          <td class="style2">
            Shrmemframe</td>
          <td class="style3">
            A folder with shrmemframe.exe and its needed libraries from older Microsotf and Intel
             compilers.&nbsp; This is a program that the plugin to 64-bit DM uses for frame 
            alignment with the CPU or GPU, with data passed through shared memory.
        </tr>
        <tr>
          <td class="style2">
            FrameGPU4.dll</td>
          <td class="style3">
            A DLL for using the GPU of an NVIDIA card for doing frame alignment in the
            plugin to DM or in SerialEM itself, built with CUDA 4</td>
        </tr>
        <tr>
          <td class="style2">
            FrameGPU6.dll</td>
          <td class="style3">
            A DLL for using&nbsp; the GPU of an NVIDIA card for doing frame alignment in the 
            plugin to DM or in SerialEM itself, built with CUDA 6</td>
        </tr>
        <tr>
          <td class="style2">
            FrameGPU8.dll</td>
          <td class="style3">
            A DLL for using&nbsp; the GPU of an NVIDIA card for doing frame alignment in the
            plugin to DM or in SerialEM itself, built with CUDA 8</td>
        </tr>
        <tr>
          <td class="style2">
            register-GMS1.bat</td>
          <td class="style3">
            A batch file for copying the plugin and registering both DLL's for GMS 1.x</td>
        </tr>
        <tr>
          <td class="style2">
            register-GMS2-32.bat</td>
          <td class="style3">
            A batch file for copying the plugin and registering both&nbsp;DLL's&nbsp;for 32-bit GMS 2-3</td>
        </tr>
        <tr>
          <td class="style2">
            register-GMS2-64.bat</td>
          <td class="style3">
            A batch file for copying the plugin and registering two or three&nbsp;DLL's&nbsp;for 64-bit GMS 2-3</td>
        </tr>
        <tr>
          <td class="style2">
            b3dregsvr32.exe</td>
          <td class="style3">
            Program run by the batch file for registering the plugin for 32-bit and 64-bit GMS 2-3</td>
        </tr>
        <tr>
          <td class="style2">
            b3dregsvr64.exe</td>
          <td class="style3">
            Program run by the batch file for registering the plugin for 64-bit GMS 2-3</td>
        </tr>
        <tr>
          <td class="style2">
            FocusRamper.exe</td>
          <td class="style3">
            A COM executable for doing dynamic focus on a Thermo/FEI scope</td>
        </tr>
        <tr>
          <td class="style2">
            register-Ramper.bat</td>
          <td class="style3">
            A batch file for registering the FocusRamper on a remote microscope</td>
        </tr>
        <tr>
          <td class="style2">
            JeolCamPlugin.dll</td>
          <td class="style3">
            A plugin for accessing a JEOL camera or JEOL STEM signals on some scopes</td>
        </tr>
        <tr>
          <td class="style2">
            JEOL-SEMCamServer32.exe</td>
          <td class="style3">
            A server that is copied to a remote JEOL PC for accessing JEOL camera or STEM
            signals</td>
        </tr>
        <tr>
          <td class="style2">
            JEOL-SEMCamServer64.exe</td>
          <td class="style3">
            A camera server that is copied to a remote JEOL PC running 64-bit JEOL software</td>
        </tr>
        <tr>
          <td class="style2">
            TietzPlugin.dll</td>
          <td class="style3">
            A plugin for accessing Tietz (TVIPS) cameras</td>
        </tr>
        <tr>
          <td class="style2">
            Tietz-SEMServer.exe</td>
          <td class="style3">
            A camera server that is copied to a remote PC running a Tietz camera</td>
        </tr>
        <tr>
          <td class="style2">
            DEcamPlugin.dll</td>
          <td class="style3">
            A simple wrapper plugin for accessing Direct Electron cameras without linking
            the DE DLL into SerialEM</td>
        </tr>
        <tr>
          <td class="auto-style1">
            DE.Win32.dll or DE.Win64.dll</td>
          <td class="auto-style2">
            A DLL from Direct Electron for connecting with the DE server</td>
        </tr>
        <tr>
          <td class="style2">
            INSTALL.bat</td>
          <td class="style3">
            A batch file for copying appropriate files to the folder above and registering
            needed items</td>
        </tr>
        <tr>
          <td class="style2">
            SerialEM_Snapshot.txt</td>
          <td class="style3">
            Guenter Resch's script for collecting a snapshot of the SerialEM installation 
            and configuration</td>
        </tr>
        <tr>
          <td class="style2">
            Copyright.txt</td>
          <td class="style3">
            Describes the MIT-style license covering SerialEM and the copyright and license
            terms for associated components</td>
        </tr>
        <tr>
          <td class="style13">
            GPL.txt</td>
          <td class="style14">
            GPL license covering the SerialEMCCD plugin to DM and Ctfplotter</td>
        </tr>
        <tr>
          <td class="style2">
            LGPL.txt</td>
          <td class="style3">
            LGPL licence covering libcfshr, libiimod, libimod, and libifft libraries
            from IMOD</td>
        </tr>
        <tr>
          <td class="style2">
            Mini-XML.txt</td>
          <td class="style3">
            License covering the libimxml library from IMOD</td>
        </tr>
        <tr>
          <td class="style2">
            Janelia.txt</td>
          <td class="style3">
            License covering the libctffind library from IMOD</td>
        </tr>
        <tr>
          <td class="style2">
            HDF5.txt</td>
          <td class="style3">
            License covering the HDF5 library</td>
        </tr>
    </table>
  </BODY>
</HTML>
